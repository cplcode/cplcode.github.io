<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  <title>CPL Reference Manual</title>
  <meta name="author" content="Paolo Luchini">
  <meta name="copyright" content="Copyright 2001-2020 Paolo Luchini">
  <meta name="description" content="Language reference manual for CPL, a programming language designed and developed by Paolo Luchini during 1993-2022. CPL has bounds-checked arrays, subarray selections transparent to structure fields, overloaded functions, optional parameters, structured arrays, parentheses, brackets and braces used like in mathematics. Offered for download are an incremental, extensible compiler, interactive interpreter and ide text editor. Extensions include matrix operations, gnuplot graphics and symbolic math manipulation.">
  <meta name="keywords" content="cpl, CPL, cplcode, CPLcode, statement, declaration, control statement, module, function, subroutine, optional parameter, bounds-checked, array, subarray, structure, structured array, matrix, symbolic math, symbolic manipulation, gnuplot, plotting, numerical, scientific, computation, computational, code, program, programmer, programming language, incremental, extensible, source-to-source, compiler, compiler-compiler, interpreter, compiler-interpreter, ide, text editor, fri, FRI, make, interactive, edit">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="author" href="https://CPLcode.net/Paolo.Luchini">
  <link rel="author" href="https://scholar.google.com/citations?user=thlSP34AAAAJ">
  <link rel="stylesheet" href="../singlecol.css">
  <style>
    .page {
      display:none;
    }
    .page:target {
      display: block;
      white-space: pre-wrap;
      }
    th {
      text-align:left;
    }
    td:first-child {
      padding-right:0.5em;
    }
    .filter {
      width:1.6em;
    }
    tr:first-child:not(:nth-last-child(n+12)) th input {
      display:none;
    }
</style>
<script>
  function tsearch() {
    // Declare variables
    var target, input, filter, table, tr, td, i, txtValue;
    target=document.getElementById(location.hash.substring(1));
    table = target.getElementsByTagName("table")[0];
    if(table) {
      input = table.getElementsByTagName("input")[0];
      filter = input.value.toUpperCase();
      tr = table.getElementsByTagName("tr");
    
      // Loop through all table rows, and hide those that don't match the search query
      for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[0];
        if (td) {
          txtValue = td.textContent || td.innerText;
          if (txtValue.toUpperCase().indexOf(filter) == 0) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        }
      }
    }
  }
  // ensure that Top page is loaded
  if (document.location.hash == "") {document.location.hash="#Top";}
</script>
<link rel="canonical" href="https://CPLcode.net/Documentation/editor.html">
</head>
<body translate="no"><a href="../"><img id=seal src="../images/CPL-logo.png" alt="CPL"></a><div>

</div><div class=page id="Top">
Page: (editor)Top, Next: <a href="#readline">readline</a>,  Up: <a href="cpl.html#cpl-i">(cpl)cpl i</a> <a style="float:right" href="cpl.html#Keyword-Index">Index</a>
<hr>
 <h1>cpl-embedded line and full-screen editor</h1>
cpl includes a powerful console screen editor. It serves a double purpose as a GNU readline look-alike, providing command completion and command history to cpl interactive input, and as a full-screen editor for program development, equipped with CPL word and syntax completion. Interactive cpl and the editor are actually a single integrated environment (IDE): programs can be run from within the editor, and the cpl and editor screens can be swapped at the touch of a key. Both tools display in a console, which makes for a terse graphical appearance but in exchange allows equally swift use in local and remote terminals, as well as in a terminal-only environment like the Windows subsystem for Linux, and even in a smartphone's ssh client if one feels the need for it.

Bash-like command completion and command history are traditionally provided by the GNU readline library, which supplies the familiar Tab and Up Arrow commands, input logging and more. The purpose of readline is to allow the user  to edit each command line before committing it, and to keep a history of previous commands for rapid reuse. cpl readline accepts cursor-movement and other commands in one of three equivalent ways: dedicated editing keys, vi-like single-letter commands, and the mouse. Single-letter command mode is toggled in and out of by the Esc key. Full-screen mode is toggled in and out of by F1 or Esc `. Any cursor movement while Shift is pressed (or mouse movement with left button pressed) selects text. For single-letter functions which admit an inverse (such as undo - redo or search forwards - search backwards), the corresponding capital letter or the right mouse button selects its inverse.

With the exception of those control characters that already have their own meaning (such as Ctrl-i, which is Tab, and Ctrl-h which is Backspace), Ctrl-&lt;key&gt; also works as an alternative to Esc followed by the same lower-case key. As a further alternative, Alt-&lt;key&gt; in most terminals sends the sequence Esc &lt;key&gt;, and thus produces the same effect as switching command mode on or off and then pressing &lt;key&gt;.

If full-screen mode is toggled on with no other file opened, the command history shows up in the full-screen editor, and the Enter key is now entered as a regular newline. On return to readline mode (when F1 or Esc ` is pressed again), the modified command history is replayed through interactive cpl as if this list of commands had been given afresh when it was launched. Other editing keys work just as in readline mode, except that history lines are now edited in place.

<nav><table>
<tr><th>Menu: <input autocomplete="off" class="filter" type="text" onkeyup="tsearch()" onfocus="this.value='';tsearch()" placeholder="a-z" title="Filter menu items by initials"></th><th></th></tr>
<tr><td colspan="2"> </td></tr>
<tr><td><a href="#readline">readline</a>:</td><td>flexible input-line editing with history and completion</td></tr>
<tr><td><a href="#full-screen">full-screen</a>:</td><td>editor with CPL word and syntax completion</td></tr>
<tr><td><a href="#character-set">character set</a>:</td><td>utf-8</td></tr>
</table></nav>

</div><div class=page id="readline">
Page: (editor)readline, Next: <a href="#full-screen">full-screen</a>, Prev: <a href="#Top">Top</a>, Up: <a href="#Top">Top</a> <a style="float:right" href="cpl.html#Keyword-Index">Index</a>
<hr> <h3>Readline assisted console input</h3>
Most used editing keys:

 - Left (Esc h), right arrow (Esc l): previous, next char
 - Home (Esc ^), end (Esc $): beginning, end of line
 - Ctrl-Home (Ctrl-^), Ctrl-End (Ctrl-$, Esc A): beginning, end of file
 - Backspace: erase left
 - Delete (Esc d): erase right
 - Shift-delete (Esc D): erase line
 - Up (Esc j), down arrow (Esc k): previous, next command in history. If a
   partial line is entered, only lines containing it become visible. Previous
   commands are immutable; when a character is added or deleted in a previous
   command, this is copied to the most recent position before being modified.
 - Tab: autocomplete keyword or identifier. Successive tabs move forward along
   the list of available completions; Shift-Tab moves backwards.
 - Enter: submit line.
 - F1, Esc `: switch to full-screen mode.
 - F2, Esc -, Ctrl-: repeat last command.
 - Esc u, Esc U: Undo, respectively redo, the last modification. (<a href="#Undo">Undo</a>)
 - Esc \, Ctrl-\: add next (special or control) character verbatim 
</div><div class=page id="full-screen">
Page: (editor)full-screen, Next: <a href="#character-set">character set</a>, Prev: <a href="#readline">readline</a>, Up: <a href="#Top">Top</a> <a style="float:right" href="cpl.html#Keyword-Index">Index</a>
<hr>
 <h3>Full-screen editor</h3>
The full-screen editor is accessed by pressing F1 or Esc ` or by the <q>edit</q> command in interactive cpl, as <q>cpl edit</q> in the shell, or also as <q>edit</q> in the shell if no other <q>edit</q> command takes precedence.

Most used editing keys:

 - Left (Esc h), right arrow (Esc l): previous, next char
 - Home (Esc ^), End (Esc $): beginning, end of line or of selection
 - Ctrl-Home (Ctrl-^), Ctrl-End (Ctrl-$, Esc A): beginning, end of file
 - Backspace: erase left; Delete (Esc d): erase at cursor
 - Shift-Delete (Esc D): erase line
 - Up arrow (Esc j), down arrow (Esc k): previous, next line.
 - PgUp (Esc p), PgDn (Esc n): move to prev or next paragraph of the same or
   lesser indentation.
 - Esc f (Ctrl-f, Esc /), Esc F (Esc ?): Find forwards, respectively backwards.
 - Tab: autocomplete keyword or identifier. Successive tabs move forward along
   the list of available completions; Shift-Tab moves backwards.
 - Enter: Enter new line, and trigger possible autocompletion of CPL syntax
 - Esc =: Autoindent current line or selection (<a href="#Indent-and-complete">Indent and complete</a>)
 - F1, Esc `: switch in and out of command-line mode.
 - F2, Esc -, Ctrl-: repeat last command.
 - Esc u, Esc U: Undo, respectively redo, the last modification. (<a href="#Undo">Undo</a>)
 - Esc \, Ctrl-\: add next (special or control) character verbatim.

Selection is achieved by Shift-arrow keys (<a href="#Select">Select</a>), or by moving the mouse with its left button pressed. The center mouse button copies the current selection if the mouse is moved to a new position, or deletes it if the mouse sits on it. The right mouse button moves (cuts and pastes) the current selection.

Clicking the mouse on the bottom left corner, or pressing Esc followed by any unassigned key (say, Esc Space), opens up a menu of editor commands. Clicking the mouse on the bottom right corner opens context-sensitive help (through the info program), about the word where the cursor is, or this info page if the cursor is outside any word. Clicking the right mouse button does the same at the position where the mouse is clicked.

The full-screen editor can work on multiple screens, in addition to the session log (command history). Simultaneously open buffers are rotated into view by clicking the mouse menu, which shows them as tabs, or by pressing Esc &lt;digit&gt;.

A file is opened in a new screen with the <q>edit</q> iteractive cpl command (also available in the menu, or as Esc e, or as the <q>edit</q> symbolic link from a unix shell), and closed with the <q>close</q> menu command (aka Esc c or Ctrl-c or Esc q or Ctrl-q). Capitalized <q>Edit</q>, or Esc E, or right-clicking the <q>edit</q> menu button, opens the file to be edited in a separate terminal window. The optional +&lt;linenumber&gt; parameter at the end of the <q>edit</q> or <q>Edit</q> commands opens the file at the given line number. The bottom status line contains the name of the currently displayed file and the current line number. A star trailing the file name denotes whether the in-memory buffer has been modified since last saved (and warns that changes would be lost if not saved again). Closing an unsaved file elicits a prompt asking for confirmation before exit.

<q>load</q> and <q>save</q> (Esc a and Esc s) respectively load (insert) a file at the current cursor position and save the current in-memory buffer to a file, with the original file name as a default. Ctrl-s immediately saves the in-memory buffer to the original file name. In case some text was just selected, Esc s instead opens a <q>save selection as</q> prompt which saves the current selection to a file.

<q>run</q> (Esc r) runs the current screen as a CPL program, after saving all unsaved screens so that other possibly USEd files are up to date. By contrast, switching into line mode always runs the session log, independent of which screen is currently in view.

<q>options</q> (Esc o) opens a menu of editor options.

Most prompts and menus can be aborted by pressing Esc &lowast;twice&lowast;.

<nav><table>
<tr><th>Menu: <input autocomplete="off" class="filter" type="text" onkeyup="tsearch()" onfocus="this.value='';tsearch()" placeholder="a-z" title="Filter menu items by initials"></th><th></th></tr>
<tr><td colspan="2"> </td></tr>
<tr><td><a href="#Select">Select</a>:</td><td>text selection, insertion and deletion</td></tr>
<tr><td><a href="#Indent-and-complete">Indent and complete</a>:</td><td>CPL syntax-sensitive indentation and completion</td></tr>
<tr><td><a href="#Find">Find</a>:</td><td>find and replace functionality</td></tr>
<tr><td><a href="#Undo">Undo</a>:</td><td>and redo</td></tr>
<tr><td><a href="#options">options</a>:</td><td>editor options</td></tr>
</table></nav>

</div><div class=page id="Select">
Page: (editor)Select, Next: <a href="#Indent-and-complete">Indent and complete</a>, Prev: <a href="#full-screen">full-screen</a>, Up: <a href="#full-screen">full-screen</a> <a style="float:right" href="cpl.html#Keyword-Index">Index</a>
<hr> <h4>Select, Insert and Delete</h4>
Selection of a text area is achieved either by keeping the left mouse button pressed while sweeping, or by pressing shift together with arrow keys. Selection can apply to the text enclosed between the starting and ending selected positions or to a rectangular tile with the given corners (a.k.a. selection by columns). Esc t toggles in and out of tile mode. Esc w or double-clicking the mouse selects the word under the cursor; if applied to an opening or closing bracket, Esc w or double clicking selects the entire parenthesis. Esc # or triple clicking selects the line under the cursor. Esc <q>s</q>, or clicking save, when some text is selected saves the current selection rather than the entire file.

When some text is selected, the character count of the selection is displayed in the status line in place of the current line number. At the same time the Home and End keys, or their equivalent command letters, lead to the begining and end of the selection.

Whenever text is selected, the Insert key (or Esc i, or Ctrl-v for those who are accustomed to it) inserts (pastes) the selected text at the current cursor position; no <q>copy</q> operation is needed as buffer coincides with selection. The Backspace and Delete keys (also aliased to Esc d, Esc x, Ctrl-x) erase the selected text if pressed immediately after a selection. At any other time these keys erase a single character, the preceding one for Backspace. Deleted text remains buffered and can be re-inserted after its deletion. Typing a new character, or pressing Insert, immediately after a selection without any intervening cursor movement replaces the current selection. In this case the function of Insert changes to inserting the butlast selection. Esc m moves (cuts and pastes) the butlast onto the last selection. Pressing the middle mouse button achieves the same purpose as Esc i; the right mouse button the same purpose as Esc m.

The CPL editor features a multiple-selection buffer: right after an insertion, pressing Esc i or Insert again replaces the current selection by the historically former selection. Pressing Esc i or Insert multiple times cycles through the last three selections. In case you want to insert the same selection more than once, exit Esc mode or press End in between.

In the way of example, in order to:

 delete:           select, delete;
 overtype:         select, type;
 copy and paste:   select, move cursor, insert;
 cut and paste:    select, delete, move cursor, insert;
 copy and replace: select, move, select, insert;
 cut and replace:  select, delete, move, select, insert.
 type again:       type something, move, insert;
 type and replace: type something, move, select, insert.
 insert the former selection: select, move, select, move, insert, insert.

If so many rules look complicated, just remember that you can recall and insert anything that you have recently selected, written or deleted; just try pressing Insert, and if what you see is not what you want, press Insert again.

The copy-and-paste functionality of the underlying xterm-compatible terminal is also available, and necessary if you want to copy some text to/from other windows. This is accessed by pressing Shift together with the corresponding mouse button (left button to select, center button to paste). Shift-Insert also pastes from the clipboard at the current cursor position. Notice that when the editor is run remotely, involved is the one of the two clipboards that resides on the machine where the terminal is running, which probably is what you want anyway. In addition, if the xsel program is installed, Esc ' copies the current selection to the clipboard (on the remote machine, unfortunately, when not the same; for those who know, this feature to be done properly would require OSC 52 support; writing only would be enough).

Esc !, respectively Esc @, turns the current selection to all uppercase or to all lowercase letters. 
</div><div class=page id="Indent-and-complete">
Page: (editor)Indent and complete, Next: <a href="#Find">Find</a>, Prev: <a href="#Select">Select</a>, Up: <a href="#full-screen">full-screen</a> <a style="float:right" href="cpl.html#Keyword-Index">Index</a>
<hr> <h4>CPL syntax-sensitive indentation and completion</h4>
When a .cpl file is being edited, pressing Enter at the end of a freshly modified line automatically:

 1) indents the new line according to the contents of the previous line;
 2) if the line is the opening of a new program block, like a subroutine, loop
    or IF statement, it inserts the corresponding closing statement and the
    appropriate indentation for the block's contents;
 3) it converts to upper case some CPL keywords when they are recognized as
    having been entered in lower case;
 4) open brackets are automatically provided with a matching closing bracket;
    typing of the closing bracket is optional, and silently ignored if brackets
    match;
 5) since CPL allows the usage of the three kinds of brackets like in
    mathematics (<a href="cpl.html#Parentheses">(cpl)Parentheses</a>), the editor automatically alternates
    the three kinds even if only one kind is typed in.

Where needed, the following explicit indentation commands are available:

 Esc ) : indent the current selection one more space to the right,
 Esc ( : unindent the current selection by one space to the left,
 Esc = : even the margin of the current selection, or indent as to CPL syntax.

In addition, word completion using the Tab key is available in full-screen just as well as in readline mode. Successive tabs move forward along the list of available completions; Shift-Tab moves backwards. A hint is shown under the cursor at the end of the current line, foreshowing in faint type the completion that pressing Tab would currently produce.

Parentheses and quote completion also operates, automatically adding closed parentheses and quotes at the time they are opened. 
</div><div class=page id="Find">
Page: (editor)Find,  Next: <a href="#Undo">Undo</a>,  Prev: <a href="#Select">Select</a>,  Up: <a href="#full-screen">full-screen</a> <a style="float:right" href="cpl.html#Keyword-Index">Index</a>
<hr> <h4>Find and replace</h4>
<q>find</q> (Esc f or Ctrl-f or Esc /) and <q>goto</q> (Esc g or Esc +) seek the cursor to a given string or to a given line number. Esc F (or Esc ?, or clicking <q>find</q> with the right mouse button) seeks backwards. The search is caseinsensitive if the first character of the search string is a lowercase letter, case-sensitive otherwise. The found string is automatically selected. If some text is selected when one of this keys is pressed, the selected text will appear as a proposed search string.

Esc , (lowercase &lt;) repeats the last find backwards. Esc . (lowercase &gt;) repeats the last find forwards. Finding with an empty argument also repeats the last find, possibly changing its direction.

In order to find and replace, find a given text, exit Esc mode, and start typing the replacement. Esc &gt; is a shortcut for pressing Insert and Esc . one after the other, and thus serves as replace-and-find-again. Keeping  Esc &gt; pressed is a means to perform multiple replacements, possibly to the end of file. Esc &lt; likewise replaces-and-finds backwards.

Esc Enter repeats whatever the last command was, possibly the last (forward or backward) find or the last replace-and-find-again. 
</div><div class=page id="Undo">
Page: (editor)Undo, Prev: <a href="#Find">Find</a>, Next: <a href="#options">options</a>, Up: <a href="#full-screen">full-screen</a> <a style="float:right" href="cpl.html#Keyword-Index">Index</a>
<hr> <h4>Undo and redo</h4>
Unlimited undo and redo functionality is supported, activated by Esc u and Esc U respectively (or Esc z and Esc Z as alternates, or Ctrl-z and Ctrl-y, but with the variation detailed below). As a distinctive feature of this editor (shared by emacs, with some distinctions, but almost no others), memory of the undone edits is retained even when further edits take place after an undo.

A standard editor allows the following pitfall to occur: you undo several times with the purpose of inspecting how your text was at an earlier stage, but with the intention to return to the present, and then before redo-ing, you accidentally hit a key (for example, redo is Ctrl-y and you hit y without Ctrl); now your redo buffer is gone forever, and all you typed in the meanwhile is gone with it.

Emacs and its kin keep memory of the complete history of commands including undo's. You do not <q>redo</q> in emacs, you undo an undo. You never lose anything, if no cap is posed on the length of the history, but once you start to <q>undo an undo an undo</q> the interface may become confusing, and the distance to any given past command increases rapidly.

In the CPL editor you can think of undo and redo commands as not changing anything, just scrolling backwards and forwards along what you did before. It is when you start typing again (or save) that actual changes take place, and they are recorded with no loss. The next time you undo, you will roll back the time series of changes without again seeing your past undo's, and roll forward when you redo. If you redo all the way to the present nothing is remembered, but otherwise the state of the document when you resume typing is. Save for undo's and redo's, and for characters corrected with backspace immediately after being written, the complete history of changes since the file was opened remains available, and is never overwritten when you resume editing after undoing your previous edits. Its lifespan is, nevertheless, finite and coincides with the editing session; contrary to full-fledged version-control systems, no history is preserved after the file is closed.

For added flexibility, Esc z or Ctrl-z provides the traditional undo with no repetition of previously undone edits, while Esc u or Ctrl-u provides the full undo. History is not lost with either, and redo is always full.

Multi-line movements (PgUp, PgDn, Ctrl-Home, Ctrl-End, find and go to line) can also be undone, using the Esc b (back) key. Memory is only kept up to the most recent text modification. Esc U, Esc Z, Esc B and  Ctrl-y redo (reverse undo) whatever was undone interchangeably. 
</div><div class=page id="options">
Page: (editor)options, Prev: <a href="#Undo">Undo</a>, Next: <a href="#character-set">character set</a>, Up: <a href="#full-screen">full-screen</a> <a style="float:right" href="cpl.html#Keyword-Index">Index</a>
<hr> <h3>Editor options</h3>
<q>options</q> (Esc o) opens a submenu of editor options. Lines can be selected by up and down arrows or by the mouse, and activated/deactivated by pressing y or left arrow for yes, or n or right arrow for no, or toggled by the space bar. Enter exits the menu. As a quick shortcut, the initial of each option toggles it and exits the menu at once.

<nav><table>
<tr><th>Menu: <input autocomplete="off" class="filter" type="text" onkeyup="tsearch()" onfocus="this.value='';tsearch()" placeholder="a-z" title="Filter menu items by initials"></th><th></th></tr>
<tr><td colspan="2"> </td></tr>
<tr><td><a href="#hex-editor">hex editor</a>:</td><td>The <q>show bytes</q> option toggles hex editor mode.</td></tr>
</table></nav>

</div><div class=page id="hex-editor">
Page: (editor)hex editor, Prev: <a href="#options">options</a>, Next: <a href="#character-set">character set</a>, Up: <a href="#options">options</a> <a style="float:right" href="cpl.html#Keyword-Index">Index</a>
<hr> <h4>Hex editor mode</h4>
The <q>show bytes</q> option toggles hex editor mode. In this mode individual bytes are displayed (non-printing ones as □), instead of being interpreted as UTF-8 Unicode, and at the same time a sliding window shows the hex representation of the line under the cursor. Typing in hexadecimal digits modifies the byte under the cursor. Space adds a new byte. Other alphanumeric keys are inactive. 
</div><div class=page id="character-set">
Page: (editor)character set,  Prev: <a href="#full-screen">full-screen</a>,  Up: <a href="#Top">Top</a> <a style="float:right" href="cpl.html#Keyword-Index">Index</a>
<hr> <h2>Character set</h2>
The cpl editor is 8-bit safe, and correctly aligns UTF-8 Unicode characters displayed by the underlying console. Double-width Unicode characters are handled as well. The hex representation of a binary file can be obtained in alternative by the <a href="#hex-editor">hex editor</a> toggle. 
</div></body></html>
