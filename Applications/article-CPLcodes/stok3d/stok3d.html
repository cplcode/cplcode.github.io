<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>article-CPLcodes/stok3d/stok3d.cpl</title><meta name="description" content="CPL listing"><base href="https://CPLcode.net/Documentation/"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>pre{font-family:ui-monospace,monospace,sans-serif;font-size:1em;} .comment{color:HotPink;} a:link,a:visited{color:MediumBlue;text-decoration:none} a:hover,a:active{text-decoration:underline}</style>
<script type="application/ld+json">{
"@context":"http://schema.org",
"@type":"SoftwareSourceCode",
"name":"article-CPLcodes/stok3d/stok3d.cpl",
"programmingLanguage":{
"@type":"ComputerLanguage",
"name":"CPL",
"disambiguatingDescription":"Compiler and Programming Language Conceived by Paolo Luchini",
"url":"https://cplcode.net"}
}</script></head>
<body translate="no"><pre>
<a href="cpl.html#USE">USE</a> mg3d.cpl
<span class=comment>!  USE rtchecks.cpl</span>
<span class=comment>! stok3d</span>
<a href="cpl.html#FILE">FILE</a> ALTEZZE
ALTEZZE=<a href="cpl.html#CREATE">CREATE</a>('sto')
nx=2&lowast;8
ny=nx&lowast;6
<span class=comment>!     nz=nx&lowast;3 DIV 2 </span>
nz=2&lowast;nx

hmax=1.
<span class=comment>! valore massimo di h compatibile con la memoria prevista</span>

<a href="cpl.html#INTEGER">INTEGER</a> ny0
ny0=<a href="cpl.html#FLOOR">FLOOR</a>(2&lowast;nx&lowast;hmax) +5
<span class=comment>!   ny0=nx&lowast;2</span>

pi=<a href="cpl.html#Builtin">ATAN</a>(1)&lowast;4 
pfo=0.5
<span class=comment>! parametro formula</span>
pbc=2
protra = 2
<span class=comment>! protra1 =lamina; protra2 = e5; protra3 = profilo a v;protra4=coseno </span>
prolo = 3
<span class=comment>! prolo1 =2d;  prolo2 = profilo iperbolico; prolo3=BE </span>

inco=1
<span class=comment>! inco0 =senza correzione; inco1 = con correzione</span>

<a href="cpl.html#REAL">REAL</a> fx0

<a href="cpl.html#IF">IF</a> protra=1 <a href="cpl.html#IF">THEN</a>
  fx0 =0
<a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> protra=2 <a href="cpl.html#IF">THEN</a>
  fx0= 0.05
<a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> protra=3 <a href="cpl.html#IF">THEN</a>
  fx0= 0.25
<a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> protra=4 <a href="cpl.html#IF">THEN</a>
  fx0= pi/2
<a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a> 

<a href="cpl.html#INTEGER">INTEGER</a> it,js,wp,btm(-1..nx+1,-1..nz+1),btf(0..nx,0..nz)
<a href="cpl.html#REAL">REAL</a> ad(0..nx,0..ny0,0..nz),al(0..nx,0..ny0,0..nz),ar(0..nx,0..ny0,0..nz), \
ab(0..nx,0..ny0,0..nz),af(0..nx,0..ny0,0..nz),rhs(0..nx,0..ny,0..nz)
<a href="cpl.html#REAL">REAL</a> up(0..nx,0..ny0,0..nz),right(0..nx,0..ny0,0..nz),down(0..nx,0..ny0,0..nz),\
left(0..nx,0..ny0,0..nz),back(0..nx,0..ny0,0..nz),forw(0..nx,0..ny0,0..nz)
<a href="cpl.html#REAL">REAL</a> bcu(0..nx,0..ny0,0..nz),bcr(0..nx,0..ny0,0..nz),bcd(0..nx,0..ny0,0..nz), \
bcl(0..nx,0..ny0,0..nz),bcb(0..nx,0..ny0,0..nz),bcf(0..nx,0..ny0,0..nz)
<a href="cpl.html#REAL">REAL</a> coenoto(0..nx,0..ny0,0..nz)
<a href="cpl.html#REAL">REAL</a> m1(-1..nx+1,0..ny,-1..nz+1),m2(-1..nx+1,0..ny,-1..nz+1), \
m3(-1..nx+1,0..ny,-1..nz+1),fi(-1..nx+1,0..ny,-1..nz+1)


<a href="cpl.html#REAL">REAL</a> vzn(1..1500),vsalfa(1..1500),vcalfa(1..1500),vdel(1..1500),vk1(1..1500),vk2(1..1500)
<a href="cpl.html#REAL">REAL</a>  zn,salfa,calfa,del,k1,k2,c2,c4,c6,c2l
<a href="cpl.html#INTEGER">INTEGER</a> nid(0..nx,0..ny0,0..nz)
<a href="cpl.html#REAL">REAL</a> fill,fillm,fils,deno,rapp,hlon,htra,dh,prec,ka 
<a href="cpl.html#REAL">REAL</a> denx,deny,denz,ris(1..50,1..50)
<a href="cpl.html#REAL">REAL</a> ax0,axl,axr,ay0,ayd,ayu,az0,azf,azb
<a href="cpl.html#INTEGER">INTEGER</a> datof    <span class=comment>! datofalso per interrompere con READ</span>
jsta=9
numh=1
numk=1
numf=16
k0=1
delth=0.200
deltf=0.050
fil0=0.10-deltf
rap0=0.300- delth
lx=1.

h=lx/nx/2
ly=ny&lowast;h
lz=nz&lowast;h&lowast;4.
eps=h/100
dcor=2.05&lowast;h


<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> tanh( <a href="cpl.html#REAL">REAL</a> xx)
  <a href="cpl.html#RESULT">RESULT</a>=(<a href="cpl.html#Builtin">EXP</a>(xx)-<a href="cpl.html#Builtin">EXP</a>(-xx))/(<a href="cpl.html#Builtin">EXP</a>(xx)+<a href="cpl.html#Builtin">EXP</a>(-xx))
<a href="cpl.html#END">END</a> tanh 

<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> fx( <a href="cpl.html#REAL">REAL</a> xx)
  <a href="cpl.html#REAL">REAL</a> xs
  xs=0.
  <a href="cpl.html#IF">IF</a> protra = 1 <a href="cpl.html#IF">THEN</a>
    <span class=comment>!   Lamina</span>
    <a href="cpl.html#RESULT">RESULT</a>=1
    <a href="cpl.html#IF">IF</a> xx &gt; xs  <a href="cpl.html#IF">THEN</a> <a href="cpl.html#RESULT">RESULT</a>=0
  <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> protra = 2 <a href="cpl.html#IF">THEN</a> 
    <span class=comment>!   e5</span>
    <a href="cpl.html#RESULT">RESULT</a>=(1-xx&lowast;4)<a href="cpl.html#compound-index">**</a>5
    <a href="cpl.html#IF">IF</a> xx&gt;0.25 <a href="cpl.html#IF">THEN</a> <a href="cpl.html#RESULT">RESULT</a>= 0
  <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> protra = 3 <a href="cpl.html#IF">THEN</a> 
    <span class=comment>!   v</span>
    <a href="cpl.html#RESULT">RESULT</a>=1-xx&lowast;4
    <a href="cpl.html#IF">IF</a> xx&gt;0.25 <a href="cpl.html#IF">THEN</a> <a href="cpl.html#RESULT">RESULT</a>= 0
  <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> protra = 4 <a href="cpl.html#IF">THEN</a> 
    <span class=comment>!   coseno</span>
    <a href="cpl.html#RESULT">RESULT</a>=<a href="cpl.html#Builtin">COS</a>(2&lowast;pi&lowast;xx)
    <a href="cpl.html#IF">IF</a> xx&gt;0.25 <a href="cpl.html#IF">THEN</a> <a href="cpl.html#RESULT">RESULT</a>= 0
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a> 
  <a href="cpl.html#IF">IF</a> <a href="cpl.html#RESULT">RESULT</a> &lt;0 <a href="cpl.html#IF">THEN</a> <a href="cpl.html#RESULT">RESULT</a>=0
<a href="cpl.html#END">END</a> fx

<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> gz(<a href="cpl.html#REAL">REAL</a> zz)
  <a href="cpl.html#REAL">REAL</a> l1,l2,l3,l4,zr,a1,a2,a3,b1,b2,y1
  nr=4
  <a href="cpl.html#IF">IF</a> prolo =1 <a href="cpl.html#IF">THEN</a>
    <span class=comment>!  2d</span>
    <a href="cpl.html#RESULT">RESULT</a>=rapp
  <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> prolo=2 <a href="cpl.html#IF">THEN</a>
    <span class=comment>!  Profilo iperbolico</span>
    <a href="cpl.html#RESULT">RESULT</a>=rapp&lowast;(1.+tanh(ka&lowast;2./rapp&lowast;(fill&lowast;lz/2.-zz)))/2
  <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> prolo=3 <a href="cpl.html#IF">THEN</a>
    
    <span class=comment>!  BE </span>
    
    tal=1
    cal=1/(1+tal<a href="cpl.html#compound-index">**</a>2)<a href="cpl.html#compound-index">**</a>0.5
    sal=tal&lowast;cal
    r0=0.347826
    <span class=comment>!   r0=0.7</span>
    <span class=comment>!     l0=0.5108695 </span>
    l0=fill
    l2=(rapp-r0+tal&lowast;l0+r0&lowast;(1+tal<a href="cpl.html#compound-index">**</a>2)<a href="cpl.html#compound-index">**</a>0.5)/tal
    l1=l2-(rapp-r0+r0/(1+tal<a href="cpl.html#compound-index">**</a>2)<a href="cpl.html#compound-index">**</a>0.5)/tal
    y1=rapp-r0+r0&lowast;cal
    l1=r0&lowast;sal+l0
    l2=l1+y1/tal
    <span class=comment>!     WRITE 'z,y1,l0,l1,l2',zz,y1,l0,l1,l2 </span>
    l3=l1+(rapp-2&lowast;r0&lowast;(1-cal))/tal
    l4=l3+r0&lowast;sal
    b1=(l2-fill+0.125-(nr+1)&lowast;rapp)/(l2-fill+0.125)<a href="cpl.html#compound-index">**</a>nr
    b2=(nr&lowast;rapp-l2+fill-0.125)/(l2-fill+0.125)<a href="cpl.html#compound-index">**</a>(nr+1)
    
    <a href="cpl.html#IF">IF</a> zz &lt;l0 <a href="cpl.html#IF">THEN</a>
      <a href="cpl.html#RESULT">RESULT</a> =rapp
    <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> zz &lt;l1 <a href="cpl.html#IF">THEN</a> 
      <a href="cpl.html#RESULT">RESULT</a>=rapp-r0+(r0<a href="cpl.html#compound-index">**</a>2-(zz-l0)<a href="cpl.html#compound-index">**</a>2)<a href="cpl.html#compound-index">**</a>0.5
    <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> zz&lt;l2  <a href="cpl.html#IF">THEN</a> 
      <a href="cpl.html#RESULT">RESULT</a> = y1+tal&lowast;(l1-zz)
    <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> zz&lt;lz-l2  <a href="cpl.html#IF">THEN</a> 
      <a href="cpl.html#RESULT">RESULT</a>=0
    <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> zz&lt;lz-l1  <a href="cpl.html#IF">THEN</a> 
      <a href="cpl.html#RESULT">RESULT</a> = y1+tal&lowast;(zz-lz+l1)
    <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> zz&lt;lz-l0  <a href="cpl.html#IF">THEN</a> 
      <a href="cpl.html#RESULT">RESULT</a>=rapp-r0+(r0<a href="cpl.html#compound-index">**</a>2-(zz-lz+l0)<a href="cpl.html#compound-index">**</a>2)<a href="cpl.html#compound-index">**</a>0.5
    <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> zz &lt;lz  <a href="cpl.html#IF">THEN</a>
      <a href="cpl.html#RESULT">RESULT</a> =rapp
    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a> 
    
    <a href="cpl.html#IF">IF</a> <a href="cpl.html#RESULT">RESULT</a>&lt;0  <a href="cpl.html#IF">THEN</a> <a href="cpl.html#RESULT">RESULT</a>=0
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a> 
  
  <span class=comment>!(
    <span class=comment>! Profilo arrotondato superiormente e con retta</span>
    IF zz&lt; l0 THEN
      RESULT=rapp
    ELSE IF zz&lt;l1 THEN
      zr=(zz-l0)/(l1-l0)
      a1=(rapp-y1)&lowast;nr/(l1-l0) -tal
      a2=nr&lowast;(nr-1)&lowast;(rapp-y1)/2/(l1-l0)&lowast;&lowast;2 -a1&lowast;nr/(l1-l0)
      RESULT= rapp + zr&lowast;&lowast;nr&lowast;(y1-rapp+a1&lowast;(zz-l1)+ a2&lowast;(zz-l1)&lowast;&lowast;2)
    ELSE IF zz &lt; l2 THENJ    RESULT=tal&lowast;(l2-zz)
  ELSE IF zz&gt; l2 THEN
    RESULT=0
  END IF   
  !)</span> 

<span class=comment>!(    profilo continuo
  
  IF zz&lt;= fill-.125  THEN RESULT=rapp
  IF zz&gt;fill-.125  THEN 
    zr=(zz-fill+0.125)
    RESULT=rapp+b1&lowast;zr&lowast;&lowast;nr+b2&lowast;zr&lowast;&lowast;(nr+1)
  END IF
  !)</span>
<span class=comment>!(   Raccordo inferiore o
  IF zz&gt;l1 THEN
    a3=(-y1+l2-l1-a2&lowast;(l2-l1)&lowast;&lowast;2)/(l2-l1)&lowast;&lowast;3
    RESULT=y1-(zz-l1)+a2&lowast;(zz-l1)&lowast;&lowast;2+a3&lowast;(zz-l1)&lowast;&lowast;3
  END IF
  !)</span> 
<span class=comment>!     IF zz&gt;l3 THEN RESULT=r0-(r0&lowast;&lowast;2-(zz-l4)&lowast;&lowast;2)&lowast;&lowast;.5</span>
<span class=comment>!     IF zz&gt;l4 THEN RESULT =0</span>

<a href="cpl.html#END">END</a>    gz


<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> fondo(<a href="cpl.html#REAL">REAL</a> xx,zz)
  <a href="cpl.html#RESULT">RESULT</a>=fx(xx)&lowast;gz(zz)+fx(0.5-xx)&lowast;gz(lz/2.-zz)
<a href="cpl.html#END">END</a> fondo



<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> vert(<a href="cpl.html#REAL">REAL</a> yy,x1,x2,zz)
  <a href="cpl.html#REAL">REAL</a> f1,f2,xm,fm,x1c,x2c
  f1=fondo(x1,zz)-yy
  f2=fondo(x2,zz)-yy
  <a href="cpl.html#IF">IF</a> f1&lowast;f2 &gt; 0 <a href="cpl.html#IF">THEN</a>
    <a href="cpl.html#IF">IF</a> <a href="cpl.html#ABS">ABS</a>(f1)  &lt;  <a href="cpl.html#ABS">ABS</a>(f2)  <a href="cpl.html#IF">THEN</a>
      <a href="cpl.html#RESULT">RESULT</a>=x1
    <a href="cpl.html#ELSE">ELSE</a>
      <a href="cpl.html#RESULT">RESULT</a>=x2
    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
    <a href="cpl.html#EXIT">EXIT</a> vert
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  x1c=x1
  x2c=x2
  <a href="cpl.html#DO">DO</a>
    xm=(f2&lowast;x1c-f1&lowast;x2c)/(f2-f1)   
    fm=fondo(xm,zz)-yy
    <a href="cpl.html#IF">IF</a> fm&lowast;f1 &gt; 0 <a href="cpl.html#IF">THEN</a>
      x1c=xm
      f1=fm
    <a href="cpl.html#ELSE">ELSE</a>
      x2c=xm
      f2=fm
    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#UNTIL">UNTIL</a>  (<a href="cpl.html#ABS">ABS</a>(fm) &lt; 0.0001) <a href="cpl.html#OR">OR</a> (<a href="cpl.html#ABS">ABS</a>(x2c-x1c)) &lt; 0.00005 
  <a href="cpl.html#RESULT">RESULT</a>=xm
<a href="cpl.html#END">END</a> vert

<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> vertz(<a href="cpl.html#REAL">REAL</a>  yy,z1,z2,xx)
  <a href="cpl.html#REAL">REAL</a> f1,f2,zm,fm,z1c,z2c
  f1=fondo(xx,z1)-yy
  f2=fondo(xx,z2)-yy
  <a href="cpl.html#IF">IF</a>(f1&lowast;f2 &gt; 0) <a href="cpl.html#IF">THEN</a>
    <a href="cpl.html#IF">IF</a>(<a href="cpl.html#ABS">ABS</a>(f1) &lt; <a href="cpl.html#ABS">ABS</a>(f2)) <a href="cpl.html#IF">THEN</a>
      <a href="cpl.html#RESULT">RESULT</a> =z1
    <a href="cpl.html#ELSE">ELSE</a>
      <a href="cpl.html#RESULT">RESULT</a> =z2
    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
    <a href="cpl.html#EXIT">EXIT</a> vertz
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  z1c=z1
  z2c=z2
  <a href="cpl.html#DO">DO</a>
    zm=(f2&lowast;z1c-f1&lowast;z2c)/(f2-f1)   
    fm=fondo(xx,zm)-yy
    <a href="cpl.html#IF">IF</a> (fm&lowast;f1 &gt; 0) <a href="cpl.html#IF">THEN</a>
      z1c=zm
      f1=fm
    <a href="cpl.html#ELSE">ELSE</a>
      z2c=zm
      f2=fm
    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#UNTIL">UNTIL</a> (<a href="cpl.html#ABS">ABS</a>(fm) &lt; 0.0001) <a href="cpl.html#OR">OR</a> (<a href="cpl.html#ABS">ABS</a>(z2c-z1c)) &lt;0.00005 
  <a href="cpl.html#RESULT">RESULT</a>=zm
<a href="cpl.html#END">END</a> vertz



<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> delta(<a href="cpl.html#REAL">REAL</a> xx,zz,calf,salf)
  <a href="cpl.html#REAL">REAL</a> dz,dzp,xv,talfa,fp,gp,pv
  <a href="cpl.html#IF">IF</a> xx &lt;0.25 <a href="cpl.html#IF">THEN</a>
    xv=0
    pv=1
  <a href="cpl.html#ELSE">ELSE</a> 
    xv=0.5
    pv=-1
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#IF">IF</a> calf = 0   <a href="cpl.html#IF">THEN</a>
    talfa=100000000000000.
  <a href="cpl.html#ELSE">ELSE</a>
    talfa=salf/calf
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  fp=(fondo(xv,zz)-fondo(xv+pv&lowast;eps,zz))/eps
  <a href="cpl.html#IF">IF</a> xx=0 <a href="cpl.html#IF">THEN</a>
    gp=0
  <a href="cpl.html#ELSE">ELSE</a>
    gp=(fondo(xv,zz+eps)-fondo(xv,zz))/eps
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#IF">IF</a> rapp=0 <a href="cpl.html#IF">THEN</a>
    <a href="cpl.html#RESULT">RESULT</a>=pi/2
  <a href="cpl.html#ELSE">ELSE</a>
    <a href="cpl.html#RESULT">RESULT</a>=<a href="cpl.html#Builtin">ATAN</a>(fx0/rapp&lowast;(1-gp&lowast;talfa)<a href="cpl.html#compound-index">**</a>0.5)
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <span class=comment>!(   caso lamina     
    RESULT=0.
    !)</span> 
<a href="cpl.html#END">END</a> delta


<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> kappa(<a href="cpl.html#REAL">REAL</a> xx, zz,calf,salf) 
  <a href="cpl.html#REAL">REAL</a> cot,s,e,kv,kn
  <a href="cpl.html#IF">IF</a> <a href="cpl.html#ABS">ABS</a>(delta(xx,zz,calf,salf))  = 0 <a href="cpl.html#IF">THEN</a>
    <a href="cpl.html#RESULT">RESULT</a>=0.5
  <a href="cpl.html#ELSE">ELSE</a>
    kn=0.5
    s=<a href="cpl.html#Builtin">SIN</a>(2.&lowast;delta(xx,zz,calf,salf))
    <a href="cpl.html#DO">DO</a>
      kv=kn
      <a href="cpl.html#IF">IF</a> wp = 1 <a href="cpl.html#IF">THEN</a>
        cot=((1.-s<a href="cpl.html#compound-index">**</a>2&lowast;kv<a href="cpl.html#compound-index">**</a>2)<a href="cpl.html#compound-index">**</a>0.5-1.)/s/kv 
        kn=(<a href="cpl.html#Builtin">ATAN</a>(1./cot)+pi)/(pi-delta(xx,zz,calf,salf))
      <a href="cpl.html#ELSE">ELSE</a>
        cot=(1-(1.-s<a href="cpl.html#compound-index">**</a>2&lowast;kv<a href="cpl.html#compound-index">**</a>2)<a href="cpl.html#compound-index">**</a>0.5)/s/kv 
        kn=<a href="cpl.html#Builtin">ATAN</a>(1./cot)/(pi-delta(xx,zz,calf,salf))
      <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
    <a href="cpl.html#WHILE">WHILE</a>  <a href="cpl.html#ABS">ABS</a>(kv-kn) &gt; 0.0001 
    <a href="cpl.html#RESULT">RESULT</a>=kn
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
<a href="cpl.html#END">END</a> kappa


<a href="cpl.html#FUNCTION">SUBROUTINE</a> catalogo
  
  <a href="cpl.html#REAL">REAL</a> xx,yy,zz,dis,zve,znu,zno,z1,z2,d1,d2,dm,xv,yv,calf,salf,dpm,z3,norma
  <a href="cpl.html#INTEGER">INTEGER</a> kv,kvm,kid
  kid=0
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  ica=0 <a href="cpl.html#TO">TO</a> nid.<a href="cpl.html#HI">HI</a>
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jca=0 <a href="cpl.html#TO">TO</a> nid(0).<a href="cpl.html#HI">HI</a>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  kca=0 <a href="cpl.html#TO">TO</a> nid(0,0).<a href="cpl.html#HI">HI</a>
        nid(ica,jca,kca)=0
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  ica=0 <a href="cpl.html#TO">TO</a> nx
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  kca=0 <a href="cpl.html#TO">TO</a>  nz
      
      <a href="cpl.html#IF">IF</a> ica &lt; 2   <a href="cpl.html#OR">OR</a>  ica &gt; nx-2   <a href="cpl.html#IF">THEN</a>
        <span class=comment>! &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast; btm(0,0) max btm &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;</span>
        
        <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jca=btm(ica,kca) <a href="cpl.html#TO">TO</a>  btm(0,0)+2
          
          xx=ica&lowast;h
          yy=jca&lowast;h
          zz=kca&lowast;h
          <a href="cpl.html#IF">IF</a> ica&lowast;h &lt; 0.25 <a href="cpl.html#IF">THEN</a>
            xv=0.
          <a href="cpl.html#ELSE">ELSE</a>
            xv=0.5
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#IF">IF</a> kca &gt; 0   <a href="cpl.html#IF">THEN</a>
            z1=0.
            z2=2.&lowast;nz&lowast;h
            d1=(xx-xv)<a href="cpl.html#compound-index">**</a>2+(yy-fondo(xv,z1))<a href="cpl.html#compound-index">**</a>2+(zz-z1)<a href="cpl.html#compound-index">**</a>2
            d2=(xx-xv)<a href="cpl.html#compound-index">**</a>2+(yy-fondo(xv,z2))<a href="cpl.html#compound-index">**</a>2+(zz-z2)<a href="cpl.html#compound-index">**</a>2
            <a href="cpl.html#DO">DO</a>
              <span class=comment>!   WRITE 'z1,z2',z1,z2</span>
              zno=0.5&lowast;z1+0.5&lowast;z2
              dm=(xx-xv)<a href="cpl.html#compound-index">**</a>2+(yy-fondo(xv,zno))<a href="cpl.html#compound-index">**</a>2+(zz-zno)<a href="cpl.html#compound-index">**</a>2
              dpm=(xx-xv)<a href="cpl.html#compound-index">**</a>2+(yy-fondo(xv,zno+eps))<a href="cpl.html#compound-index">**</a>2+(zz-zno-eps)<a href="cpl.html#compound-index">**</a>2-
      ((xx-xv)<a href="cpl.html#compound-index">**</a>2+(yy-fondo(xv,zno-eps))<a href="cpl.html#compound-index">**</a>2+(zz-zno+eps)<a href="cpl.html#compound-index">**</a>2)
              <span class=comment>!   WRITE 'xx,yy,zz,d1,d2,dm,zno,dpm',xx,yy,zz,d1,d2,dm,zno,dpm</span>
              <a href="cpl.html#IF">IF</a> dpm &gt; 0 <a href="cpl.html#IF">THEN</a>
                z2=zno 
                d2=dm
              <a href="cpl.html#ELSE">ELSE</a>
                z1=zno 
                d1=dm
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <span class=comment>!  WRITE 'z1,z2,d1,d2',z1,z2,d1,d2</span>
            <a href="cpl.html#WHILE">WHILE</a>  <a href="cpl.html#ABS">ABS</a>(z1-z2) &gt; h/1000000
          <a href="cpl.html#ELSE">ELSE</a>
            
            zno=0.
            calf=1.0
            salf=0.
            dis=((xx-xv)<a href="cpl.html#compound-index">**</a>2+(yy-fondo(xv,0.))<a href="cpl.html#compound-index">**</a>2)<a href="cpl.html#compound-index">**</a>0.5
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          yv=fondo(xv,zno)
          dis=((xx-xv)<a href="cpl.html#compound-index">**</a>2+(yy-yv)<a href="cpl.html#compound-index">**</a>2+(zz-zno)<a href="cpl.html#compound-index">**</a>2)<a href="cpl.html#compound-index">**</a>0.5
          
          <a href="cpl.html#IF">IF</a> yv &gt; 1.05&lowast;h <a href="cpl.html#AND">AND</a> jca&gt;1 <a href="cpl.html#IF">THEN</a> 
            <span class=comment>!    IF  dis &lt; dcor    THEN</span>
            <a href="cpl.html#IF">IF</a>  dis &lt; dcor    <a href="cpl.html#IF">THEN</a>
              norma=((yy-yv)<a href="cpl.html#compound-index">**</a>2+(zz-zno)<a href="cpl.html#compound-index">**</a>2)<a href="cpl.html#compound-index">**</a>0.5
              <a href="cpl.html#IF">IF</a> yy &lt; yv <a href="cpl.html#IF">THEN</a> norma=-norma
              <a href="cpl.html#IF">IF</a> <a href="cpl.html#ABS">ABS</a>(norma) &lt; 0.001 <a href="cpl.html#IF">THEN</a>
                calf=1.
                salf=0.
              <a href="cpl.html#ELSE">ELSE</a>
                calf=<a href="cpl.html#ABS">ABS</a>((yy-yv)/norma)
                salf=(zz-zno)/norma
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              z3=(zz-zno)&lowast;calf-(yy-yv)&lowast;salf 
              <span class=comment>!   IF ABS(z3) &lt;  0.9&lowast;h  THEN  </span>
              kid=kid+1
              vzn(kid)=zno
              vsalfa(kid)=salf
              vcalfa(kid)=calf
              nid(ica,jca,kca)=kid
              vdel(kid)=delta(xx,zno,calf,salf)
              vk1(kid)=kappa(xx,zno,calf,salf)
              vk2(kid)=pi/(pi-vdel(kid))&lowast;(5.+wp)/4.
              
              <span class=comment>!   END IF</span>
            <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#WRITE">WRITE</a> 'punti da correggere',kid                     
<a href="cpl.html#END">END</a> catalogo


<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> derc(<a href="cpl.html#REAL">REAL</a> fc,fs,fd,ds,dd,den)
  <a href="cpl.html#RESULT">RESULT</a>=(fd&lowast;ds<a href="cpl.html#compound-index">**</a>2-fs&lowast;dd<a href="cpl.html#compound-index">**</a>2+fc&lowast;(dd<a href="cpl.html#compound-index">**</a>2-ds<a href="cpl.html#compound-index">**</a>2))/den/h
<a href="cpl.html#END">END</a> derc

<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> ders(<a href="cpl.html#REAL">REAL</a> f0,f1,f2,d1,d2,den)
  <a href="cpl.html#RESULT">RESULT</a>=(f1&lowast;d2<a href="cpl.html#compound-index">**</a>2-f2&lowast;d1<a href="cpl.html#compound-index">**</a>2-f0&lowast;(d2<a href="cpl.html#compound-index">**</a>2-d1<a href="cpl.html#compound-index">**</a>2))/den/h
<a href="cpl.html#END">END</a> ders

<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> des(<a href="cpl.html#REAL">REAL</a> fl,fc,fr,frr,le,ri,rr)
  <a href="cpl.html#REAL">REAL</a> den,alr,alrr
  alr=le+ri
  alrr=alr+rr
  <a href="cpl.html#IF">IF</a> le&lt; pfo <a href="cpl.html#AND">AND</a> rr&gt;0  <a href="cpl.html#IF">THEN</a>
    den =alr&lowast;alrr&lowast;rr
    <a href="cpl.html#RESULT">RESULT</a>=(fr&lowast;alrr<a href="cpl.html#compound-index">**</a>2-frr&lowast;alr<a href="cpl.html#compound-index">**</a>2-fl&lowast;(alrr<a href="cpl.html#compound-index">**</a>2-alr<a href="cpl.html#compound-index">**</a>2))/h/den
  <a href="cpl.html#ELSE">ELSE</a>
    den=le&lowast;ri&lowast;alr
    <a href="cpl.html#RESULT">RESULT</a>=(fc&lowast;alr<a href="cpl.html#compound-index">**</a>2-fr&lowast;le<a href="cpl.html#compound-index">**</a>2-fl&lowast;(alr<a href="cpl.html#compound-index">**</a>2-le<a href="cpl.html#compound-index">**</a>2))/h/den
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
<a href="cpl.html#END">END</a> des



<span class=comment>! &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;</span>



<span class=comment>!     funzioni locali</span>

<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> teta(<a href="cpl.html#REAL">REAL</a> xx,yy)
  <a href="cpl.html#REAL">REAL</a> tet,rq
  <a href="cpl.html#INTEGER">INTEGER</a> si
  <a href="cpl.html#IF">IF</a>  xx = 0 <a href="cpl.html#IF">THEN</a> si=0
  <a href="cpl.html#IF">IF</a> xx &lt; 0  <a href="cpl.html#IF">THEN</a> si=-1
  <a href="cpl.html#IF">IF</a> xx &gt; 0  <a href="cpl.html#IF">THEN</a> si=1
  rq=xx&lowast;xx+yy&lowast;yy     
  <a href="cpl.html#IF">IF</a>  yy = 0   <a href="cpl.html#IF">THEN</a>
    tet=pi/2&lowast;si
  <a href="cpl.html#ELSE">ELSE</a>
    tet=<a href="cpl.html#Builtin">ATAN</a>(xx/yy)
    <a href="cpl.html#IF">IF</a> yy &lt; 0 <a href="cpl.html#IF">THEN</a> tet=tet+pi&lowast;si
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#RESULT">RESULT</a>=tet
<a href="cpl.html#END">END</a> teta


<a href="cpl.html#FUNCTION">SUBROUTINE</a> fun1(<a href="cpl.html#REAL">REAL</a> fi1<a href="cpl.html#REAL-operator">^</a>,m11<a href="cpl.html#REAL-operator">^</a>,m21<a href="cpl.html#REAL-operator">^</a>,xx,yy)
  <a href="cpl.html#REAL">REAL</a> tet,e,a,d,b,fil,fis,k3,es,cot,s,c,r
  r=(xx&lowast;xx+yy&lowast;yy)<a href="cpl.html#compound-index">**</a>0.5
  tet=teta(xx,yy)
  <a href="cpl.html#IF">IF</a> del &gt; 0 <a href="cpl.html#IF">THEN</a>
    s=<a href="cpl.html#Builtin">SIN</a>(2&lowast;del)
    c=<a href="cpl.html#Builtin">COS</a>(2&lowast;del)
    k3=(pi-del)&lowast;k1
    <a href="cpl.html#IF">IF</a> <a href="cpl.html#ABS">ABS</a>(pi/2-k3)  &lt; 0.005  <a href="cpl.html#IF">THEN</a>
      cot=0
    <a href="cpl.html#ELSE">ELSE</a>
      cot=1/<a href="cpl.html#Builtin">TAN</a>(k3)
    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
    <a href="cpl.html#IF">IF</a> wp = 1  <a href="cpl.html#IF">THEN</a>
      e=1-2&lowast;cot/(cot+<a href="cpl.html#Builtin">TAN</a>(del))
      <span class=comment>!    d=1./(1.-e&lowast;(1.+k1)-k1&lowast;(s&lowast;cot+c)) </span>
      d=cot/(cot&lowast;(1+e&lowast;(1+k1)+k1&lowast;c)-s&lowast;k1)
      b=1
      a=4&lowast;d-1
    <a href="cpl.html#ELSE">ELSE</a>
      e=2.&lowast;<a href="cpl.html#Builtin">TAN</a>(del)&lowast;cot/(1.-cot&lowast;<a href="cpl.html#Builtin">TAN</a>(del))+1.
      d=cot/(cot&lowast;(1-k1&lowast;c+e&lowast;(1+k1))+k1&lowast;s)
      a=1
      b=1-4&lowast;d
    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
    es=1.+k1
    <a href="cpl.html#IF">IF</a> (wp = 1) <a href="cpl.html#IF">THEN</a>
      fis=r<a href="cpl.html#compound-index">**</a>es&lowast;<a href="cpl.html#Builtin">COS</a>((1.-k1)&lowast;tet)
      fil=r<a href="cpl.html#compound-index">**</a>es&lowast;<a href="cpl.html#Builtin">COS</a>(es&lowast;tet)
      fi1=d&lowast;(fis+e&lowast;fil)
      m11=a&lowast;r<a href="cpl.html#compound-index">**</a>k1&lowast;<a href="cpl.html#Builtin">SIN</a>(k1&lowast;tet)
      m21=b&lowast;r<a href="cpl.html#compound-index">**</a>k1&lowast;<a href="cpl.html#Builtin">COS</a>(k1&lowast;tet)
    <a href="cpl.html#ELSE">ELSE</a>
      fis=r<a href="cpl.html#compound-index">**</a>es&lowast;<a href="cpl.html#Builtin">SIN</a>((1.-k1)&lowast;tet)
      fil=r<a href="cpl.html#compound-index">**</a>es&lowast;<a href="cpl.html#Builtin">SIN</a>(es&lowast;tet)
      fi1=d&lowast;(fis+e&lowast;fil)
      m11=a&lowast;r<a href="cpl.html#compound-index">**</a>k1&lowast;<a href="cpl.html#Builtin">COS</a>(k1&lowast;tet)
      m21=b&lowast;r<a href="cpl.html#compound-index">**</a>k1&lowast;<a href="cpl.html#Builtin">SIN</a>(k1&lowast;tet)
    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#ELSE">ELSE</a>
    <span class=comment>! Lamina</span>
    <a href="cpl.html#IF">IF</a> wp = -1 <a href="cpl.html#IF">THEN</a>
      m11=r<a href="cpl.html#compound-index">**</a>0.5&lowast;<a href="cpl.html#Builtin">COS</a>(tet/2.)
      m21=0.
      fis=r<a href="cpl.html#compound-index">**</a>1.5&lowast;<a href="cpl.html#Builtin">SIN</a>(tet&lowast;0.5)
      fil=r<a href="cpl.html#compound-index">**</a>1.5&lowast;<a href="cpl.html#Builtin">SIN</a>(tet&lowast;1.5)
      fi1=0.25&lowast;(fis+fil)
    <a href="cpl.html#ELSE">ELSE</a>
      <span class=comment>!    m11=0.</span>
      m11=-r<a href="cpl.html#compound-index">**</a>0.5&lowast;<a href="cpl.html#Builtin">SIN</a>(0.5&lowast;tet)/2
      m21=r<a href="cpl.html#compound-index">**</a>0.5&lowast;<a href="cpl.html#Builtin">COS</a>(0.5&lowast;tet)
      fis=r<a href="cpl.html#compound-index">**</a>1.5&lowast;<a href="cpl.html#Builtin">COS</a>(tet&lowast;0.5)
      fil=r<a href="cpl.html#compound-index">**</a>1.5&lowast;<a href="cpl.html#Builtin">COS</a>(tet&lowast;1.5)
      <span class=comment>!    fi1=.25&lowast;(fis+fil/3)</span>
      fi1=(fis+fil&lowast;3)/8
    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
<a href="cpl.html#END">END</a>  fun1 



<a href="cpl.html#FUNCTION">SUBROUTINE</a> fun2(<a href="cpl.html#REAL">REAL</a> fi2<a href="cpl.html#REAL-operator">^</a>,m12<a href="cpl.html#REAL-operator">^</a>,m22<a href="cpl.html#REAL-operator">^</a>,m32<a href="cpl.html#REAL-operator">^</a>,xx,yy)
  <a href="cpl.html#REAL">REAL</a> tet,es,k23,r
  k23=pi/2./(pi-del)
  r=(xx&lowast;xx+yy&lowast;yy)<a href="cpl.html#compound-index">**</a>0.5
  tet=teta(xx,yy)
  <a href="cpl.html#IF">IF</a> del &gt; 0 <a href="cpl.html#IF">THEN</a>
    es=k2-1.
    <a href="cpl.html#IF">IF</a> (wp = 1) <a href="cpl.html#IF">THEN</a>
      fi2=-r<a href="cpl.html#compound-index">**</a>k2&lowast;<a href="cpl.html#Builtin">COS</a>(k2&lowast;tet)/k2 
      m12=r<a href="cpl.html#compound-index">**</a>es&lowast;<a href="cpl.html#Builtin">SIN</a>(es&lowast;tet)
      m22=-r<a href="cpl.html#compound-index">**</a>es&lowast;<a href="cpl.html#Builtin">COS</a>(es&lowast;tet)
      m32=r<a href="cpl.html#compound-index">**</a>k23&lowast;<a href="cpl.html#Builtin">COS</a>(k23&lowast;tet)
    <a href="cpl.html#ELSE">ELSE</a>
      fi2=r<a href="cpl.html#compound-index">**</a>k2&lowast;<a href="cpl.html#Builtin">SIN</a>(k2&lowast;tet)/k2 
      m12=r<a href="cpl.html#compound-index">**</a>es&lowast;<a href="cpl.html#Builtin">COS</a>(es&lowast;tet)
      m22=r<a href="cpl.html#compound-index">**</a>es&lowast;<a href="cpl.html#Builtin">SIN</a>(es&lowast;tet)
      m32=r<a href="cpl.html#compound-index">**</a>k2&lowast;<a href="cpl.html#Builtin">SIN</a>(k2&lowast;tet)
    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
    <span class=comment>! Caso lamina</span>
  <a href="cpl.html#ELSE">ELSE</a>
    <a href="cpl.html#IF">IF</a>  wp = -1  <a href="cpl.html#IF">THEN</a>
      fi2=xx
      m12=1.
      m22=xx
      m32=xx
    <a href="cpl.html#ELSE">ELSE</a>
      fi2=-2./3.&lowast;r<a href="cpl.html#compound-index">**</a>1.5&lowast;<a href="cpl.html#Builtin">COS</a>(1.5&lowast;tet)
      m12=r<a href="cpl.html#compound-index">**</a>0.5&lowast;<a href="cpl.html#Builtin">SIN</a>(0.5&lowast;tet)
      m22=-r<a href="cpl.html#compound-index">**</a>0.5&lowast;<a href="cpl.html#Builtin">COS</a>(0.5&lowast;tet)
      m32=r<a href="cpl.html#compound-index">**</a>0.5&lowast;<a href="cpl.html#Builtin">COS</a>(0.5&lowast;tet)
    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
<a href="cpl.html#END">END</a> fun2




<a href="cpl.html#FUNCTION">SUBROUTINE</a> costanti( <a href="cpl.html#INTEGER">INTEGER</a> icor,jcor,kcor)
  <a href="cpl.html#INTEGER">INTEGER</a> ne,ive,kve,ke,n6,k6
  neq=120
  <a href="cpl.html#REAL">REAL</a> xv,yv,den1,den2,denc6,dc6
  <a href="cpl.html#REAL">REAL</a> m1a,m2a,m3a,den,xc,yc,zc,lun,er
  <a href="cpl.html#REAL">REAL</a> fia,fib,fic,m11,m12,m21,m22,m32,fi1,fi2
  <a href="cpl.html#REAL">REAL</a> b1,b2,b3,ai(1..neq,1..2),a6(1..neq),bi(1..neq)
  <a href="cpl.html#REAL">REAL</a> b6(1..neq),bl(1..neq),ail(1..neq),a11,a12,a21,a22
  <a href="cpl.html#REAL">REAL</a> f1l,f2l,fl,fip,fip1,fip2,xp,yp,erv
  <a href="cpl.html#IF">IF</a> icor&lowast;h &lt; 0.25  <a href="cpl.html#IF">THEN</a>
    xv=0
    ive=0
  <a href="cpl.html#ELSE">ELSE</a>
    xv=0.5
    ive=nx
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  yv=fondo(xv,zn)
  jve=btm(ive,kcor)
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  iv=1 <a href="cpl.html#TO">TO</a>  neq
    bi(iv)=0.
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jv=1 <a href="cpl.html#TO">TO</a> 2
      ai(iv,jv)=0.
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  iv=1 <a href="cpl.html#TO">TO</a> neq
    a6(iv)=0.
    ail(iv)=0.
    b6(iv)=0.
    bl(iv)=0.
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  ke=0
  k6=0
  
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  iv=-1 <a href="cpl.html#TO">TO</a> 1
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  kv=-1 <a href="cpl.html#TO">TO</a>  1
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jv=-1 <a href="cpl.html#TO">TO</a> 1
        
        <a href="cpl.html#IF">IF</a>  icor+iv &gt; -1 <a href="cpl.html#AND">AND</a> icor+iv &lt; nx+1     <a href="cpl.html#IF">THEN</a>
          <a href="cpl.html#IF">IF</a>   kcor+kv &lt; nz+1 <a href="cpl.html#AND">AND</a>  kcor+kv &gt; -1    <a href="cpl.html#IF">THEN</a>
            <a href="cpl.html#IF">IF</a>   jcor+jv &gt; btm(icor+iv,kcor+kv) -1 <a href="cpl.html#IF">THEN</a>
              xc=(icor+iv)&lowast;h-xv
              yc=((jcor+jv)&lowast;h-yv)&lowast;calfa+(h&lowast;kcor+kv&lowast;h-zn)&lowast;salfa
              zc=-((jcor+jv)&lowast;h-yv)&lowast;salfa+(h&lowast;kcor+kv&lowast;h-zn)&lowast;calfa
              lun=1
              m1a=m1(icor+iv,jcor+jv,kcor+kv)
              m2a=m2(icor+iv,jcor+jv,kcor+kv)
              m3a=m3(icor+iv,jcor+jv,kcor+kv)
              fic=fi(icor+iv,jcor+jv,kcor+kv)
              fun1(fi1,m11,m21,xc,yc)
              fun2(fi2,m12,m22,m32,xc,yc)
              ke=ke+1
              k6=k6+1
              ai(ke,1)=m11
              ai(ke,2)=m12
              bi(ke)=m1a
              ail(k6)=m22
              a6(k6)=m32
              b6(k6)=m3a&lowast;calfa-m2a&lowast;salfa
              bl(k6)=m2a&lowast;calfa+m3a&lowast;salfa
              ke=ke+1
              ai(ke,1)=fi1/lun
              ai(ke,2)=fi2/lun
              bi(ke)=fic/lun
              ke=ke+1
              ai(ke,1)=m21
              ai(ke,2)=m22
              bi(ke)=m2a&lowast;calfa+m3a&lowast;salfa
            <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  ne=ke
  n6=k6
  a11=0.
  a12=0.
  a21=0.
  a22=0.
  b1=0.
  b2=0.
  c6=0.
  denc6=0.
  dc6=0.
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  ke=1 <a href="cpl.html#TO">TO</a> n6
    denc6=denc6+a6(ke)<a href="cpl.html#compound-index">**</a>2
    dc6=dc6+a6(ke)&lowast;b6(ke)
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  c6=dc6/denc6
  
  denc6=0.
  dc6=0.
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  ke=1 <a href="cpl.html#TO">TO</a> n6
    denc6=denc6+ail(ke)<a href="cpl.html#compound-index">**</a>2
    dc6=dc6+ail(ke)&lowast;bl(ke)
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  c2l=dc6/denc6
  
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  iv=1 <a href="cpl.html#TO">TO</a>  ne
    a11=ai(iv,1)&lowast;ai(iv,1)+a11
    a12=ai(iv,2)&lowast;ai(iv,1)+a12
    a21=ai(iv,1)&lowast;ai(iv,2)+a21
    a22=ai(iv,2)&lowast;ai(iv,2)+a22
    b1=bi(iv)&lowast;ai(iv,1)+b1
    b2=bi(iv)&lowast;ai(iv,2)+b2
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  den=a11&lowast;a22-a12&lowast;a21
  den1=b1&lowast;a22-b2&lowast;a12
  den2=a11&lowast;b2-b1&lowast;a21
  c2=den1/den
  c4=den2/den
<a href="cpl.html#END">END</a> costanti


<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> m1loc(<a href="cpl.html#REAL">REAL</a> xx,yy)
  <a href="cpl.html#REAL">REAL</a> fi1,fi2,m11,m12,m21,m22,m32
  fun1(fi1,m11,m21,xx,yy)
  fun2(fi2,m12,m22,m32,xx,yy)
  <a href="cpl.html#RESULT">RESULT</a>=c2&lowast;m11+c4&lowast;m12
<a href="cpl.html#END">END</a> m1loc



<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> m2loc(<a href="cpl.html#REAL">REAL</a> xx,yy)
  <a href="cpl.html#REAL">REAL</a> fi1,fi2,m11,m12,m21,m22,m32
  fun1(fi1,m11,m21,xx,yy)
  fun2(fi2,m12,m22,m32,xx,yy)
  <a href="cpl.html#RESULT">RESULT</a>=c2&lowast;m21+c4&lowast;m22
<a href="cpl.html#END">END</a> m2loc



<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> m3loc(<a href="cpl.html#REAL">REAL</a> xx,yy)
  <a href="cpl.html#REAL">REAL</a> fi2,m12,m22,m32
  fun2(fi2,m12,m22,m32,xx,yy)
  <a href="cpl.html#RESULT">RESULT</a>=c6&lowast;m32
<a href="cpl.html#END">END</a> m3loc



<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> filoc(<a href="cpl.html#REAL">REAL</a> xx,yy)
  <a href="cpl.html#REAL">REAL</a> fi1,fi2,m11,m12,m21,m22,m32
  fun1(fi1,m11,m21,xx,yy)
  fun2(fi2,m12,m22,m32,xx,yy)
  <a href="cpl.html#RESULT">RESULT</a>=c2&lowast;fi1+c4&lowast;fi2
<a href="cpl.html#END">END</a> filoc


<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> fico(<a href="cpl.html#INTEGER">INTEGER</a> ic,jc,kc)
  <a href="cpl.html#REAL">REAL</a> xx,yy,xv
  <a href="cpl.html#IF">IF</a> ic&lowast;h &lt; 0.25 <a href="cpl.html#IF">THEN</a>
    xv=0
  <a href="cpl.html#ELSE">ELSE</a>
    xv=0.5
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  xx=ic&lowast;h-xv
  yy=(jc&lowast;h-fondo(xv,zn))&lowast;calfa+(kc&lowast;h-zn)&lowast;salfa
  <a href="cpl.html#RESULT">RESULT</a>=filoc(xx,yy)
<a href="cpl.html#END">END</a> fico




<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> m1co(<a href="cpl.html#INTEGER">INTEGER</a> ic,jc,kc)
  <a href="cpl.html#REAL">REAL</a> xx,yy,xv
  <a href="cpl.html#IF">IF</a> ic&lowast;h &lt; 0.25 <a href="cpl.html#IF">THEN</a>
    xv=0
  <a href="cpl.html#ELSE">ELSE</a>
    xv=0.5
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  xx=ic&lowast;h-xv
  yy=(jc&lowast;h-fondo(xv,zn))&lowast;calfa+(kc&lowast;h-zn)&lowast;salfa
  <a href="cpl.html#RESULT">RESULT</a>=m1loc(xx,yy)
<a href="cpl.html#END">END</a> m1co




<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> m2co(<a href="cpl.html#INTEGER">INTEGER</a> ic,jc,kc)
  <a href="cpl.html#REAL">REAL</a> xx,yy,xv
  <a href="cpl.html#IF">IF</a> ic&lowast;h &lt; 0.25 <a href="cpl.html#IF">THEN</a>
    xv=0
  <a href="cpl.html#ELSE">ELSE</a>
    xv=0.5
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  xx=ic&lowast;h-xv
  yy=(jc&lowast;h-fondo(xv,zn))&lowast;calfa+(kc&lowast;h-zn)&lowast;salfa
  <a href="cpl.html#RESULT">RESULT</a>=m2loc(xx,yy)&lowast;calfa-m3loc(xx,yy)&lowast;salfa
<a href="cpl.html#END">END</a> m2co




<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> m3co( <a href="cpl.html#INTEGER">INTEGER</a> ic,jc,kc)
  <a href="cpl.html#REAL">REAL</a> xx,yy,xv
  <a href="cpl.html#IF">IF</a> ic&lowast;h &lt; 0.25 <a href="cpl.html#IF">THEN</a>
    xv=0
  <a href="cpl.html#ELSE">ELSE</a>
    xv=0.5
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  xx=ic&lowast;h-xv
  yy=(jc&lowast;h-fondo(xv,zn))&lowast;calfa+(kc&lowast;h-zn)&lowast;salfa
  <a href="cpl.html#RESULT">RESULT</a>=m2loc(xx,yy)&lowast;salfa+m3loc(xx,yy)&lowast;calfa
  
<a href="cpl.html#END">END</a> m3co




<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> fxd(<a href="cpl.html#REAL">REAL</a> tang; <a href="cpl.html#INTEGER">INTEGER</a> i,j,k,tra,co)
  <a href="cpl.html#INTEGER">INTEGER</a> ile,ifu,kfu
  <a href="cpl.html#REAL">REAL</a> fr,fd,fu,fuu,ld
  <a href="cpl.html#IF">IF</a> tang&gt;0 <a href="cpl.html#IF">THEN</a>
    ile=1
  <a href="cpl.html#ELSE">ELSE</a>
    ile=-1
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  ifu=i+tra&lowast;ile
  kfu=k+(1-tra)&lowast;ile
  ld=ad(ifu,j,kfu)-ad(i,j,k)
  <a href="cpl.html#IF">IF</a> co=0 <a href="cpl.html#IF">THEN</a>
    fr=fi(ifu,j,kfu)
    <a href="cpl.html#IF">IF</a> btm(ifu,kfu)&gt; j <a href="cpl.html#IF">THEN</a> fr=0
    fd=fi(ifu,j-1,kfu)
    <a href="cpl.html#IF">IF</a> btm(ifu,kfu)&gt; j-1  <a href="cpl.html#IF">THEN</a> fd=0
    fu=fi(ifu,j+1,kfu)
    fuu=fi(ifu,j+2,kfu)
  <a href="cpl.html#ELSE">ELSE</a>
    fr=fico(ifu,j,kfu)
    <a href="cpl.html#IF">IF</a> btm(ifu,kfu)&gt; j <a href="cpl.html#IF">THEN</a> fr=0
    fd=fico(ifu,j-1,kfu)
    <a href="cpl.html#IF">IF</a> btm(ifu,kfu)&gt; j-1  <a href="cpl.html#IF">THEN</a> fd=0
    fu=fico(ifu,j+1,kfu)
    fuu=fico(ifu,j+2,kfu)
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#RESULT">RESULT</a> =(fd/h+des(fd,fr,fu,fuu,ad(ifu,j,kfu),1,1)&lowast;ld)&lowast;ile
<a href="cpl.html#END">END</a> fxd



<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> fyl( <a href="cpl.html#INTEGER">INTEGER</a> i,j,k,tra,co,leftside)
  <a href="cpl.html#INTEGER">INTEGER</a> ile,ifu,kfu
  <a href="cpl.html#REAL">REAL</a> fl,fc,fr,frr,ld,lrd
  ile=leftside
  <a href="cpl.html#IF">IF</a> ile=1 <a href="cpl.html#IF">THEN</a>
    ld=al(i,j+1,k)
    lrd=ld-al(i,j,k)
  <a href="cpl.html#ELSE">ELSE</a>
    ld=ar(i,j+1,k)
    lrd=ld-ar(i,j,k)
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  ifu=i-tra&lowast;ile
  kfu=k-(1-tra)&lowast;ile
  <a href="cpl.html#IF">IF</a> co=0 <a href="cpl.html#IF">THEN</a>
    fr=fi(i+tra&lowast;ile,j+1,k+(1-tra)&lowast;ile)
    <a href="cpl.html#IF">IF</a> btm(i+tra&lowast;ile,k+(1-tra&lowast;ile))&gt; j+1 <a href="cpl.html#IF">THEN</a> fr=0
    frr=fi(i+2&lowast;tra&lowast;ile,j+1,k+2&lowast;(1-tra)&lowast;ile)
    <a href="cpl.html#IF">IF</a> btm(i+2&lowast;tra&lowast;ile,k+2&lowast;(1-tra&lowast;ile))&gt; j+1 <a href="cpl.html#IF">THEN</a> frr=0
    fl=fi(ifu,j+1,kfu)
    <a href="cpl.html#IF">IF</a> btm(ifu,kfu)&gt; j+1  <a href="cpl.html#IF">THEN</a> fl=0
    fc=fi(i,j+1,k)
  <a href="cpl.html#ELSE">ELSE</a>
    fr=fico(i+tra&lowast;ile,j+1,k+(1-tra)&lowast;ile)
    <a href="cpl.html#IF">IF</a> btm(i+tra&lowast;ile,k+(1-tra&lowast;ile))&gt; j+1 <a href="cpl.html#IF">THEN</a> fr=0
    frr=fico(i+2&lowast;tra&lowast;ile,j+1,k+2&lowast;(1-tra)&lowast;ile)
    <a href="cpl.html#IF">IF</a> btm(i+2&lowast;tra&lowast;ile,k+2&lowast;(1-tra&lowast;ile))&gt; j+1 <a href="cpl.html#IF">THEN</a> frr=0
    fl=fico(ifu,j+1,kfu)
    <a href="cpl.html#IF">IF</a> btm(ifu,kfu)&gt; j+1  <a href="cpl.html#IF">THEN</a> fl=0
    fc=fico(i,j+1,k)
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#RESULT">RESULT</a> =fl/h+des(fl,fc,fr,frr,ld,1,1)&lowast;lrd
<a href="cpl.html#END">END</a> fyl

<a href="cpl.html#FUNCTION">SUBROUTINE</a> notom1
  <a href="cpl.html#REAL">REAL</a> den,cl,cr,cd,cf,cb,ml,mr,md,mf,mb,fix,alr,rr,ll,
  tang,ficen,fl,fll,fr,frr,fb,fff,fd,fu,flad
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  ino=0 <a href="cpl.html#TO">TO</a> nx
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  kno=0 <a href="cpl.html#TO">TO</a> nz
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jno=btm(ino,kno) <a href="cpl.html#TO">TO</a>  btf(ino,kno)-1
        alr=al(ino,jno,kno)+ar(ino,jno,kno)
        den=al(ino,jno,kno)&lowast;ar(ino,jno,kno)&lowast;alr
        cl=0.
        cd=0.
        cr=0.
        cb=0.
        cf=0.
        mr=0.
        md=0.
        ml=0.
        mf=0.
        mb=0.
        fu=fi(ino,jno+1,kno)
        ficen=fi(ino,jno,kno)
        
        <a href="cpl.html#IF">IF</a> btm(ino-1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fl=0
          rr=0 
        <a href="cpl.html#ELSE">ELSE</a>
          fl=fi(ino-1,jno,kno)
          rr=al(ino-1,jno,kno)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        
        <a href="cpl.html#IF">IF</a> ino=0 <a href="cpl.html#IF">THEN</a>
          fll=wp&lowast;fi(ino+2,jno,kno)
          <a href="cpl.html#IF">IF</a> btm(ino+2,kno)&gt; jno <a href="cpl.html#IF">THEN</a> fll=0
        <a href="cpl.html#ELSE">ELSE</a>
          fll=fi(ino-2,jno,kno)
          <a href="cpl.html#IF">IF</a> btm(ino-2,kno)&gt; jno <a href="cpl.html#IF">THEN</a> fll=0
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino+1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fr=0
          ll=0
        <a href="cpl.html#ELSE">ELSE</a>
          fr=fi(ino+1,jno,kno)
          ll=ar(ino+1,jno,kno)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> ino=nx <a href="cpl.html#IF">THEN</a>
          frr=wp&lowast;fi(ino-2,jno,kno)
          <a href="cpl.html#IF">IF</a> btm(ino-2,kno)&gt; jno <a href="cpl.html#IF">THEN</a> frr=0
        <a href="cpl.html#ELSE">ELSE</a>
          frr=fi(ino+2,jno,kno)
          <a href="cpl.html#IF">IF</a> btm(ino+2,kno)&gt; jno <a href="cpl.html#IF">THEN</a> frr=0
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno-1) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fb=0
        <a href="cpl.html#ELSE">ELSE</a>
          fb=fi(ino,jno,kno-1)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno+1) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fff=0
        <a href="cpl.html#ELSE">ELSE</a>
          fff=fi(ino,jno,kno+1)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a>  al(ino,jno,kno) &lt; pfo   <a href="cpl.html#IF">THEN</a>
          fix=ders(ficen,fr,frr,1,2,2)
        <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a>  ar(ino,jno,kno) &lt; pfo   <a href="cpl.html#IF">THEN</a>
          fix=-ders(ficen,fl,fll,1,2,2)
        <a href="cpl.html#ELSE">ELSE</a>
          fix=derc(ficen,fl,fr,al(ino,jno,kno),ar(ino,jno,kno),den) 
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino-1,kno) &gt; jno <a href="cpl.html#IF">THEN</a>
          cl=bcl(ino,jno,kno)
          <a href="cpl.html#IF">IF</a>  al(ino,jno,kno) &lt; pfo   <a href="cpl.html#IF">THEN</a>
            ml=ders(0,fr,frr,alr,alr+1,alr&lowast;(alr+1))
          <a href="cpl.html#ELSE">ELSE</a>
            ml=ders(0,ficen,fr,al(ino,jno,kno),alr,den)
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <span class=comment>!    ml=des(fl,ficen,fr,frr,al(ino,jno,kno),ar(ino,jno,kno),rr)</span>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a>  btm(ino+1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a>
          cr=bcr(ino,jno,kno)
          <a href="cpl.html#IF">IF</a>  ar(ino,jno,kno) &lt; pfo   <a href="cpl.html#IF">THEN</a>
            mr=-ders(0,fl,fll,alr,alr+1,alr&lowast;(alr+1))
          <a href="cpl.html#ELSE">ELSE</a>
            mr=-ders(0,ficen,fl,ar(ino,jno,kno),alr,den)
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <span class=comment>! calcolo md</span>
        <a href="cpl.html#IF">IF</a> jno = btm(ino,kno)  <a href="cpl.html#IF">THEN</a>
          cd=bcd(ino,jno,kno)
          tang=(fondo(ino&lowast;h-eps,kno&lowast;h)-fondo(ino&lowast;h+eps,h&lowast;kno))/2/eps
          <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
            md=fix
          <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
            <a href="cpl.html#IF">IF</a> ino=0 <a href="cpl.html#OR">OR</a> ino= nx <a href="cpl.html#IF">THEN</a>
              md=fix
            <a href="cpl.html#ELSE">ELSE</a>
              <a href="cpl.html#IF">IF</a> tang=0 <a href="cpl.html#IF">THEN</a> 
                md=0
              <a href="cpl.html#ELSE">ELSE</a>
                md=fxd(tang,ino,jno,kno,1,0)    
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
            <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <span class=comment>! fine calcolo md</span>
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno-1) &gt; jno  <a href="cpl.html#IF">THEN</a>
          cb=bcb(ino,jno,kno)
          
          mb=fix        
          
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno+1) &gt; jno  <a href="cpl.html#IF">THEN</a>
          cf=bcf(ino,jno,kno)
          mf=fix        
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        rhs(ino,jno,kno)=cl&lowast;ml+cr&lowast;mr+cd&lowast;md+cf&lowast;mf+cb&lowast;mb
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jno=btf(ino,kno) <a href="cpl.html#TO">TO</a>  ny-1
        rhs(ino,jno,kno)=0.
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      rhs(ino,ny,kno)=h/3&lowast;(1-wp)/2
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
<a href="cpl.html#END">END</a> notom1




<a href="cpl.html#FUNCTION">SUBROUTINE</a> notom2
  <a href="cpl.html#REAL">REAL</a> cl,cr,cf,cd,cb,ml,mr,md,mb,mf,den,fiy,fd,ad1,tang
  <a href="cpl.html#REAL">REAL</a> fir,ficen,fu,fl,fr,fb,fff
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  ino=0 <a href="cpl.html#TO">TO</a> nx
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  kno=0 <a href="cpl.html#TO">TO</a> nz
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jno=btm(ino,kno) <a href="cpl.html#TO">TO</a>  btf(ino,kno)-1
        cl=0.
        cd=0.
        cr=0.
        cf=0.
        cb=0.
        ml=0.
        md=0.
        mr=0.
        mf=0.
        mb=0.
        fu=fi(ino,jno+1,kno)
        ficen=fi(ino,jno,kno)
        
        <a href="cpl.html#IF">IF</a> btm(ino-1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fl=0
        <a href="cpl.html#ELSE">ELSE</a>
          fl=fi(ino-1,jno,kno)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino+1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fr=0
        <a href="cpl.html#ELSE">ELSE</a>
          fr=fi(ino+1,jno,kno)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno-1) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fb=0
        <a href="cpl.html#ELSE">ELSE</a>
          fb=fi(ino,jno,kno-1)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno+1) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fff=0
        <a href="cpl.html#ELSE">ELSE</a>
          fff=fi(ino,jno,kno+1)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        ad1=ad(ino,jno,kno)+1.
        den=ad(ino,jno,kno)&lowast;ad1
        <a href="cpl.html#IF">IF</a> ad(ino,jno,kno) &lt; pfo <a href="cpl.html#IF">THEN</a>
          fiy=ders(ficen,fu,fi(ino,jno+2,kno),1,2,2)
        <a href="cpl.html#ELSE">ELSE</a>
          fd=fi(ino,jno-1,kno)
          <a href="cpl.html#IF">IF</a> jno = btm(ino,kno) <a href="cpl.html#IF">THEN</a> fd=0.
          fiy=derc(ficen,fd,fu,ad(ino,jno,kno),1,den)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        tang=(fondo(ino&lowast;h-eps,kno&lowast;h)-fondo(ino&lowast;h+eps,h&lowast;kno))/2/eps
        <a href="cpl.html#IF">IF</a>  btm(ino-1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a>
          cl=bcl(ino,jno,kno)
          <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
            ml =fiy
          <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
            <a href="cpl.html#IF">IF</a> ino =1 <a href="cpl.html#AND">AND</a> jno = btm(ino-1,kno) <a href="cpl.html#IF">THEN</a>
              <span class=comment>!   ml =fiy</span>
              ml=0
              
            <a href="cpl.html#ELSE">ELSE</a>
              ml =fyl(ino,jno,kno,1,0,1)
            <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a>  btm(ino+1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a>
          cr=bcr(ino,jno,kno)
          <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
            mr =fiy
          <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
            <a href="cpl.html#IF">IF</a> ino =nx-1 <a href="cpl.html#AND">AND</a> jno = btm(ino+1,kno) <a href="cpl.html#IF">THEN</a>
              <span class=comment>!   mr =fiy</span>
              mr=0
            <a href="cpl.html#ELSE">ELSE</a>
              mr =fyl(ino,jno,kno,1,0,-1)
            <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a>  jno = btm(ino,kno)  <a href="cpl.html#IF">THEN</a>
          cd=bcd(ino,jno,kno)
          <a href="cpl.html#IF">IF</a>( ino=0 <a href="cpl.html#OR">OR</a> ino=nx) <a href="cpl.html#AND">AND</a> jno &gt;1 <a href="cpl.html#IF">THEN</a>
            md=0
          <a href="cpl.html#ELSE">ELSE</a> 
            <a href="cpl.html#IF">IF</a> ad(ino,jno,kno) &lt; pfo <a href="cpl.html#IF">THEN</a>
              md=ders(0,fu,fi(ino,jno+2,kno),ad1,ad1+1,ad1&lowast;(ad1+1))
            <a href="cpl.html#ELSE">ELSE</a>
              md=ders(0,ficen,fu,ad(ino,jno,kno),ad1,den)
            <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno-1) &gt; jno  <a href="cpl.html#IF">THEN</a>
          cb=bcb(ino,jno,kno)
          <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
            mb=fiy
          <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
            <span class=comment>!  mb=fiy</span>
            mb =fyl(ino,jno,kno,0,0,1)
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno+1) &gt; jno  <a href="cpl.html#IF">THEN</a>
          cf=bcf(ino,jno,kno)
          <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
            mf=fiy
          <a href="cpl.html#ELSE">ELSE</a>  <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
            <span class=comment>!  mf=fiy</span>
            mf =fyl(ino,jno,kno,0,0,-1)
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        rhs(ino,jno,kno)=cl&lowast;ml+cr&lowast;mr+cd&lowast;md+mb&lowast;cb+mf&lowast;cf
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jno=btf(ino,kno) <a href="cpl.html#TO">TO</a>  ny-1
        rhs(ino,jno,kno)=0.
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      rhs(ino,ny,kno)=0
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
<a href="cpl.html#END">END</a> notom2




<a href="cpl.html#FUNCTION">SUBROUTINE</a> notom3
  <a href="cpl.html#REAL">REAL</a> den,fiz,cf,cb,cl,cr,cd,ml,mr,md,mf,mb,abf,fiq,fit,
  tangz,fu,ficen,fl,fr,fb,fff,ffff,fbb
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  ino=0 <a href="cpl.html#TO">TO</a> nx
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  kno=0 <a href="cpl.html#TO">TO</a> nz
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jno=btm(ino,kno) <a href="cpl.html#TO">TO</a> btf(ino,kno)-1
        abf=ab(ino,jno,kno)+af(ino,jno,kno)
        den=ab(ino,jno,kno)&lowast;af(ino,jno,kno)&lowast;abf
        cb=0.
        cf=0.
        cl=0.
        cr=0.
        mf=0.
        mb=0.
        cd=0.
        md=0.
        ml=0.
        mr=0.
        fu=fi(ino,jno+1,kno)
        ficen=fi(ino,jno,kno)
        
        <a href="cpl.html#IF">IF</a> btm(ino-1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fl=0
        <a href="cpl.html#ELSE">ELSE</a>
          fl=fi(ino-1,jno,kno)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino+1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fr=0
        <a href="cpl.html#ELSE">ELSE</a>
          fr=fi(ino+1,jno,kno)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno-1) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fb=0
        <a href="cpl.html#ELSE">ELSE</a>
          fb=fi(ino,jno,kno-1)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno+1) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fff=0
        <a href="cpl.html#ELSE">ELSE</a>
          fff=fi(ino,jno,kno+1)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        ad1=ad(ino,jno,kno)+1.
        <a href="cpl.html#IF">IF</a>  ab(ino,jno,kno) &lt; pfo  <a href="cpl.html#AND">AND</a>  kno &lt;  nz  <a href="cpl.html#IF">THEN</a>
          fiz=ders(ficen,fff,fi(ino,jno,kno+2),1,2,2)
        <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a>  af(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>  kno &gt; 0  <a href="cpl.html#IF">THEN</a>
          fiz=-ders(ficen,fb,fi(ino,jno,kno-2),1,2,2)
        <a href="cpl.html#ELSE">ELSE</a>
          fiz=derc(ficen,fb,fff,ab(ino,jno,kno),af(ino,jno,kno),den)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a> (ab(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a> kno=nz) <a href="cpl.html#OR">OR</a> (af(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a> kno =0) <a href="cpl.html#IF">THEN</a> \
        fiz=(fff- fb)/abf/h
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno-1)   &gt; jno <a href="cpl.html#IF">THEN</a>
          cb=bcb(ino,jno,kno)
          <a href="cpl.html#IF">IF</a>  ab(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>  kno &lt; nz <a href="cpl.html#IF">THEN</a>
            mb=ders(0,fff,fi(ino,jno,kno+2),abf,abf+1,abf&lowast;(abf+1))
          <a href="cpl.html#ELSE">ELSE</a>
            mb=ders(0,ficen,fff,ab(ino,jno,kno),abf,den)
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#IF">IF</a>    ab(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>   kno=nz <a href="cpl.html#IF">THEN</a> mb=fiz 
          <a href="cpl.html#IF">IF</a> ino=0 <a href="cpl.html#OR">OR</a> ino=nx <a href="cpl.html#IF">THEN</a> mb=0
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino,kno+1)   &gt; jno <a href="cpl.html#IF">THEN</a>
          cf=bcf(ino,jno,kno)
          <a href="cpl.html#IF">IF</a>  af(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>  kno &gt; 0  <a href="cpl.html#IF">THEN</a>
            mf=-ders(0,fb,fi(ino,jno,kno-2),abf,abf+1,abf&lowast;(abf+1))
          <a href="cpl.html#ELSE">ELSE</a>
            mf=-ders(0,ficen,fb,af(ino,jno,kno),abf,den)
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#IF">IF</a> ino=0 <a href="cpl.html#OR">OR</a> ino=nx <a href="cpl.html#IF">THEN</a> mf=0
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a>    af(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>   kno=0  <a href="cpl.html#IF">THEN</a> mf=fiz 
        
        
        <a href="cpl.html#IF">IF</a>  jno = btm(ino,kno)  <a href="cpl.html#IF">THEN</a>
          cd=bcd(ino,jno,kno)
          tangz=(fondo(ino&lowast;h,kno&lowast;h-eps)-fondo(ino&lowast;h,h&lowast;kno+eps))/2/eps
          <a href="cpl.html#IF">IF</a> pbc =1 <a href="cpl.html#IF">THEN</a>
            md=fiz
          <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc =2 <a href="cpl.html#IF">THEN</a>
            <span class=comment>!  md=fiz</span>
            md=fxd(tangz,ino,jno,kno,0,0)
            <a href="cpl.html#IF">IF</a> ino=0 <a href="cpl.html#OR">OR</a> ino=nx <a href="cpl.html#IF">THEN</a> md=0
            <span class=comment>!(   IF ino=0 OR ino=nx THEN
                IF tangz&gt;0 THEN
                  md=(tangz/ad(ino,jno,kno+1))&lowast;&lowast;1.5/h&lowast;fff
                ELSE IF tangz&lt;0 THEN
                  md=-(-tangz/ad(ino,jno,kno-1))&lowast;&lowast;1.5/h&lowast;fb
                ELSE
                  md=0
                END IF
              END IF
              !)</span>
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#IF">IF</a> tangz=0 <a href="cpl.html#IF">THEN</a> md=0
          <a href="cpl.html#IF">IF</a> kno=0 <a href="cpl.html#AND">AND</a> wp=-1 <a href="cpl.html#IF">THEN</a> md=0
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <span class=comment>! fine calcolo md</span>
        
        <a href="cpl.html#IF">IF</a> btm(ino-1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a>
          cl=bcl(ino,jno,kno)
          <a href="cpl.html#IF">IF</a> pbc =1 <a href="cpl.html#IF">THEN</a>
            ml=fiz
            <span class=comment>!   ml=0</span>
          <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc =2 <a href="cpl.html#IF">THEN</a>
            <span class=comment>!  ml=fiz</span>
            ml=0
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino+1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a>
          cr=bcr(ino,jno,kno)
          <a href="cpl.html#IF">IF</a> pbc =1 <a href="cpl.html#IF">THEN</a>
            mr=fiz
            <span class=comment>!    mr=0</span>
          <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc =2 <a href="cpl.html#IF">THEN</a>
            <span class=comment>!  mr=fiz</span>
            mr=0
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        rhs(ino,jno,kno)=cd&lowast;md+cb&lowast;mb+cf&lowast;mf+cl&lowast;ml+cr&lowast;mr
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jno=btf(ino,kno) <a href="cpl.html#TO">TO</a> ny-1
        rhs(ino,jno,kno)=0.
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      rhs(ino,ny,kno)=h/3&lowast;(wp+1)/2
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
<a href="cpl.html#END">END</a> notom3





<a href="cpl.html#FUNCTION">SUBROUTINE</a> notofia
  <a href="cpl.html#REAL">REAL</a> den1,den2,den3,m1x,m2y,m3z,alr,abf,fff,fb,md,ml,mr,mb,mf,ad1
  <a href="cpl.html#REAL">REAL</a> ficen,fu,fl,fr,fll,frr
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  ino=0 <a href="cpl.html#TO">TO</a> nx
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  kno=0 <a href="cpl.html#TO">TO</a> nz
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jno=btm(ino,kno) <a href="cpl.html#TO">TO</a> btf(ino,kno)-1
        alr=al(ino,jno,kno)+ar(ino,jno,kno)
        abf=ab(ino,jno,kno)+af(ino,jno,kno)
        ad1=ad(ino,jno,kno)+1.
        den1=al(ino,jno,kno)&lowast;ar(ino,jno,kno)&lowast;alr
        den2=ad(ino,jno,kno)&lowast;ad1
        den3=af(ino,jno,kno)&lowast;ab(ino,jno,kno)&lowast;abf
        ficen=fi(ino,jno,kno)
        fu=fi(ino,jno+1,kno)
        ml=m1(ino-1,jno,kno)
        mr=m1(ino+1,jno,kno)
        md=m2(ino,jno-1,kno)
        mb=m3(ino,jno,kno-1)
        mf=m3(ino,jno,kno+1)
        fb=fi(ino,jno,kno-1)
        fff=fi(ino,jno,kno+1)
        <a href="cpl.html#IF">IF</a> btm(ino,kno-1) &gt; jno  <a href="cpl.html#IF">THEN</a> fb=0. 
        <a href="cpl.html#IF">IF</a> btm(ino,kno+1) &gt; jno  <a href="cpl.html#IF">THEN</a> fff=0. 
        
        <a href="cpl.html#IF">IF</a> btm(ino-1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fl=0
        <a href="cpl.html#ELSE">ELSE</a>
          fl=fi(ino-1,jno,kno)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        
        <a href="cpl.html#IF">IF</a> ino=0 <a href="cpl.html#IF">THEN</a>
          fll=wp&lowast;fi(ino+2,jno,kno)
          <a href="cpl.html#IF">IF</a> btm(ino+2,kno)&gt; jno <a href="cpl.html#IF">THEN</a> fll=0
        <a href="cpl.html#ELSE">ELSE</a>
          fll=fi(ino-2,jno,kno)
          <a href="cpl.html#IF">IF</a> btm(ino-2,kno)&gt; jno <a href="cpl.html#IF">THEN</a> fll=0
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> btm(ino+1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a> 
          fr=0
        <a href="cpl.html#ELSE">ELSE</a>
          fr=fi(ino+1,jno,kno)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a> ino=nx <a href="cpl.html#IF">THEN</a>
          frr=wp&lowast;fi(ino-2,jno,kno)
          <a href="cpl.html#IF">IF</a> btm(ino-2,kno)&gt; jno <a href="cpl.html#IF">THEN</a> frr=0
        <a href="cpl.html#ELSE">ELSE</a>
          frr=fi(ino+2,jno,kno)
          <a href="cpl.html#IF">IF</a> btm(ino+2,kno)&gt; jno <a href="cpl.html#IF">THEN</a> frr=0
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a>   jno = btm(ino,kno) <a href="cpl.html#IF">THEN</a>    
          <a href="cpl.html#IF">IF</a> ad(ino,jno,kno) &lt; pfo <a href="cpl.html#IF">THEN</a>
            md=ders(0,fu,fi(ino,jno+2,kno),ad1,ad1+1,ad1&lowast;(ad1+1))
          <a href="cpl.html#ELSE">ELSE</a>
            md=ders(0,ficen,fu,ad(ino,jno,kno),ad1,den2)
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#IF">IF</a> (ino=0 <a href="cpl.html#OR">OR</a> ino= nx) <a href="cpl.html#AND">AND</a> jno &gt;1 <a href="cpl.html#IF">THEN</a> md=0
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a>  btm(ino+1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a>
          <a href="cpl.html#IF">IF</a>  ar(ino,jno,kno) &lt; pfo    <a href="cpl.html#IF">THEN</a>
            mr=-ders(0,fl,fll,alr,alr+1,alr&lowast;(alr+1))
          <a href="cpl.html#ELSE">ELSE</a>
            mr=-ders(0,ficen,fl,ar(ino,jno,kno),alr,den1)
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a>  btm(ino-1,kno) &gt; jno  <a href="cpl.html#IF">THEN</a>
          <a href="cpl.html#IF">IF</a> al(ino,jno,kno) &lt; pfo   <a href="cpl.html#IF">THEN</a>
            ml=ders(0,fr,frr,alr,alr+1,alr&lowast;(alr+1))
          <a href="cpl.html#ELSE">ELSE</a>
            ml=ders(0,ficen,fr,al(ino,jno,kno),alr,den1)
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a>  btm(ino,kno+1) &gt; jno  <a href="cpl.html#IF">THEN</a>
          <a href="cpl.html#IF">IF</a>  af(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>  kno &gt; 0  <a href="cpl.html#IF">THEN</a>
            mf=-ders(0,fi(ino,jno,kno-1),fi(ino,jno,kno-2),abf,abf+1,abf&lowast;(abf+1))
          <a href="cpl.html#ELSE">ELSE</a>
            mf=-ders(0,fi(ino,jno,kno),fi(ino,jno,kno-1),af(ino,jno,kno),abf,den3)
            <a href="cpl.html#IF">IF</a> af(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>  kno=0  <a href="cpl.html#IF">THEN</a> mf=(fff-fb)/abf/h
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#IF">IF</a> ino=0 <a href="cpl.html#OR">OR</a> ino= nx  <a href="cpl.html#IF">THEN</a> mf=0
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a>  btm(ino,kno-1) &gt; jno  <a href="cpl.html#IF">THEN</a>
          <a href="cpl.html#IF">IF</a>  ab(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>  kno &lt;  nz  <a href="cpl.html#IF">THEN</a>
            mb=ders(0,fi(ino,jno,kno+1),fi(ino,jno,kno+2),abf,abf+1,abf&lowast;(abf+1))
          <a href="cpl.html#ELSE">ELSE</a>
            mb=ders(0,fi(ino,jno,kno),fi(ino,jno,kno+1),ab(ino,jno,kno),abf,den3)
            <a href="cpl.html#IF">IF</a>  ab(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>  kno =nz  <a href="cpl.html#IF">THEN</a> mb=(fff-fb)/abf/h
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#IF">IF</a> ino=0 <a href="cpl.html#OR">OR</a> ino= nx  <a href="cpl.html#IF">THEN</a> mb=0
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a>  al(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>  ino &lt;  nx  <a href="cpl.html#IF">THEN</a>
          m1x=ders(m1(ino,jno,kno),mr,m1(ino+2,jno,kno),1,2,2)
        <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a>  ar(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>  ino &gt; 0  <a href="cpl.html#IF">THEN</a>
          m1x=-ders(m1(ino,jno,kno),ml,m1(ino-2,jno,kno),1,2,2)
        <a href="cpl.html#ELSE">ELSE</a>
          m1x=derc(m1(ino,jno,kno),ml,mr,al(ino,jno,kno),ar(ino,jno,kno),den1)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a> ad(ino,jno,kno) &lt; pfo <a href="cpl.html#IF">THEN</a> 
          m2y=ders(m2(ino,jno,kno),m2(ino,jno+1,kno),m2(ino,jno+2,kno),1,2,2)
        <a href="cpl.html#ELSE">ELSE</a>
          m2y=derc(m2(ino,jno,kno),md,m2(ino,jno+1,kno),ad(ino,jno,kno),1,den2)
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a>  ab(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>  kno &lt;  nz  <a href="cpl.html#IF">THEN</a>
          m3z=ders(m3(ino,jno,kno),mf,m3(ino,jno,kno+2),1,2,2)
        <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a>  af(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a>  kno &gt; 0  <a href="cpl.html#IF">THEN</a>
          m3z=-ders(m3(ino,jno,kno),mb,m3(ino,jno,kno-2),1,2,2)
        <a href="cpl.html#ELSE">ELSE</a>
          m3z=derc(m3(ino,jno,kno),mb,mf,ab(ino,jno,kno),af(ino,jno,kno),den3)
          <a href="cpl.html#IF">IF</a>(af(ino,jno,kno) &lt; pfo <a href="cpl.html#AND">AND</a> kno=0) <a href="cpl.html#OR">OR</a> (ab(ino,jno,kno) &lt; pfo  <a href="cpl.html#AND">AND</a> kno=nz ) <a href="cpl.html#IF">THEN</a>  m3z=(mf-mb)/abf/h  
          
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        rhs(ino,jno,kno)=-(m1x+m2y+m3z)&lowast;coenoto(ino,jno,kno)&lowast;h&lowast;h
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  jno=btf(ino,kno) <a href="cpl.html#TO">TO</a>  ny-1
        rhs(ino,jno,kno)=-(m1(ino+1,jno,kno)-m1(ino-1,jno,kno)+m2(ino,jno+1,kno)-m2(ino,jno-1,kno)+m3(ino,jno,kno+1)-m3(ino,jno,kno-1))&lowast;h/12
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      rhs(ino,ny,kno)=-(m1(ino+1,ny,kno)-m1(ino-1,ny,kno)-2.&lowast;m2(ino,ny-1,kno)+m3(ino,ny,kno+1)-m3(ino,ny,kno-1))&lowast;h/12
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
<a href="cpl.html#END">END</a>  notofia

<span class=comment>! &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;</span>





<a href="cpl.html#FUNCTION">SUBROUTINE</a> corm1
  <a href="cpl.html#REAL">REAL</a> ficen,ml,mr,md,mf,mb,fix,alr,rhs1,cen,lef,rig,u,d,ba,fo,xv
  <a href="cpl.html#REAL">REAL</a> den,cl,cr,cd,cf,cb,fl,fll,fr,fb,fff,fu,fd,frr,tang,ll,rr
  <a href="cpl.html#INTEGER">INTEGER</a> ndis
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=0 <a href="cpl.html#TO">TO</a> nz
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  i=0 <a href="cpl.html#TO">TO</a> nx
      <a href="cpl.html#IF">IF</a>  i &lt; 2  <a href="cpl.html#OR">OR</a>  i &gt; nx-2 <a href="cpl.html#IF">THEN</a>
        <a href="cpl.html#IF">IF</a> i&lowast;h &lt; 0.25 <a href="cpl.html#IF">THEN</a>
          xv=0.
        <a href="cpl.html#ELSE">ELSE</a>
          xv=0.5
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        
        <a href="cpl.html#IF">IF</a>  fondo(xv,k&lowast;h)&gt;2&lowast;h <a href="cpl.html#IF">THEN</a>  
          <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  j=btm(i,k) <a href="cpl.html#TO">TO</a> btm(0,0)+2
            ndis=nid(i,j,k)
            <a href="cpl.html#IF">IF</a>  ndis &gt; 0  <a href="cpl.html#IF">THEN</a> 
              del=vdel(ndis)
              k1=vk1(ndis)
              k2=vk2(ndis)
              zn=vzn(ndis)
              calfa=vcalfa(ndis)
              salfa=vsalfa(ndis)
              costanti(i,j,k)
              alr=al(i,j,k)+ar(i,j,k)
              den=al(i,j,k)&lowast;ar(i,j,k)&lowast;alr
              u=m1co(i,j+1,k)
              cen=m1co(i,j,k)
              ba=0.
              fo=0.
              lef=0.
              rig=0.
              mr=0.
              md=0.
              ml=0.
              mf=0.
              mb=0.
              cr=0.
              cl=0.
              cd=0.
              cb=0.
              cf=0.
              d=0
              ficen=fico(i,j,k)
              fu=fico(i,j+1,k)
              <a href="cpl.html#IF">IF</a> btm(i-1,k) &gt; j <a href="cpl.html#IF">THEN</a>
                fl=0
                rr=0
              <a href="cpl.html#ELSE">ELSE</a>
                fl=fico(i-1,j,k)
                rr=al(i-1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> i=0 <a href="cpl.html#IF">THEN</a>
                fll=wp&lowast;fico(i+2,j,k)
                <a href="cpl.html#IF">IF</a> btm(i+2,k)&gt; j <a href="cpl.html#IF">THEN</a> fll=0
              <a href="cpl.html#ELSE">ELSE</a>
                fll=fico(i-2,j,k)
                <a href="cpl.html#IF">IF</a> btm(i-2,k)&gt; j <a href="cpl.html#IF">THEN</a> fll=0
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> btm(i+1,k) &gt; j <a href="cpl.html#IF">THEN</a>
                fr=0
                ll=0
              <a href="cpl.html#ELSE">ELSE</a>
                fr=fico(i+1,j,k)
                ll=al(i+1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> i=nx <a href="cpl.html#IF">THEN</a>
                frr=wp&lowast;fico(i-2,j,k)
                <a href="cpl.html#IF">IF</a> btm(i-2,k)&gt; j <a href="cpl.html#IF">THEN</a> frr=0
              <a href="cpl.html#ELSE">ELSE</a>
                frr=fico(i+2,j,k)
                <a href="cpl.html#IF">IF</a> btm(i+2,k)&gt; j <a href="cpl.html#IF">THEN</a> frr=0
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> btm(i,k-1) &gt; j <a href="cpl.html#IF">THEN</a>
                fb=0
              <a href="cpl.html#ELSE">ELSE</a>
                fb=fico(i,j,k-1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a> btm(i,k+1) &gt; j <a href="cpl.html#IF">THEN</a>
                fff=0
              <a href="cpl.html#ELSE">ELSE</a>
                fff=fico(i,j,k+1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a> btm(i,k)=j <a href="cpl.html#IF">THEN</a>
                fd=0
              <a href="cpl.html#ELSE">ELSE</a>
                fd=fico(i,j-1,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a>  al(i,j,k) &lt; pfo   <a href="cpl.html#IF">THEN</a>
                fix=ders(ficen,fr,frr,1,2,2)
              <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a>  ar(i,j,k) &lt; pfo   <a href="cpl.html#IF">THEN</a>
                fix=-ders(ficen,fl,fll,1,2,2)
              <a href="cpl.html#ELSE">ELSE</a>
                fix=derc(ficen,fl,fr,al(i,j,k),ar(i,j,k),den) 
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a>  btm(i-1,k) &gt;  j  <a href="cpl.html#IF">THEN</a>
                cl=bcl(i,j,k)
                lef=0.
                <a href="cpl.html#IF">IF</a>  al(i,j,k)  &lt; pfo   <a href="cpl.html#IF">THEN</a>
                  ml=ders(0,fr,frr,alr,alr+1,alr&lowast;(alr+1))
                <a href="cpl.html#ELSE">ELSE</a>
                  ml=ders(0,ficen,fr,al(i,j,k),alr,den)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#ELSE">ELSE</a>
                lef=m1co(i-1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a>  btm(i+1,k) &gt;  j  <a href="cpl.html#IF">THEN</a>
                cr=bcr(i,j,k)
                rig=0.
                <a href="cpl.html#IF">IF</a>  ar(i,j,k) &lt; pfo   <a href="cpl.html#IF">THEN</a>
                  mr=-ders(0,fl,fll,alr,alr+1.,alr&lowast;(alr+1.))
                <a href="cpl.html#ELSE">ELSE</a>
                  mr=-ders(0,ficen,fl,ar(i,j,k),alr,den)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#ELSE">ELSE</a>
                rig=m1co(i+1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> j &gt; btm(i,k)  <a href="cpl.html#IF">THEN</a>
                d=m1co(i,j-1,k)
              <a href="cpl.html#ELSE">ELSE</a>
                <span class=comment>! calcolo md  &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;</span>
                cd=bcd(i,j,k)
                d=0.
                tang=(fondo(i&lowast;h-eps,k&lowast;h)-fondo(i&lowast;h+eps,h&lowast;k))/2/eps
                <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
                  md=fix
                <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
                  <a href="cpl.html#IF">IF</a> i=0 <a href="cpl.html#OR">OR</a> i= nx <a href="cpl.html#IF">THEN</a>
                    md=fix
                  <a href="cpl.html#ELSE">ELSE</a>
                    <a href="cpl.html#IF">IF</a> tang=0 <a href="cpl.html#IF">THEN</a> 
                      md=0
                    <a href="cpl.html#ELSE">ELSE</a>
                      md=fxd(tang,i,j,k,1,1)    
                    <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
                  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> btm(i,k-1) &gt; j  <a href="cpl.html#IF">THEN</a>
                cb=bcb(i,j,k)
                ba=0.
                <a href="cpl.html#IF">IF</a> pbc =1 <a href="cpl.html#IF">THEN</a>
                  mb=fix
                <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc =2 <a href="cpl.html#IF">THEN</a>
                  mb=fix
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#ELSE">ELSE</a>
                ba=m1co(i,j,k-1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> btm(i,k+1) &gt; j  <a href="cpl.html#IF">THEN</a>
                cf=bcf(i,j,k)
                fo=0
                <a href="cpl.html#IF">IF</a> pbc =1 <a href="cpl.html#IF">THEN</a>
                  mf=fix
                <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc =2 <a href="cpl.html#IF">THEN</a>
                  mf=fix
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
                
              <a href="cpl.html#ELSE">ELSE</a>
                fo=m1co(i,j,k+1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              rhs1=cl&lowast;ml+cd&lowast;md+cb&lowast;mb+cf&lowast;mf+cr&lowast;mr
              rhs(i,j,k)=rhs(i,j,k)-left(i,j,k)&lowast;lef-right(i,j,k)&lowast;rig-
      down(i,j,k)&lowast;d-up(i,j,k)&lowast;u-back(i,j,k)&lowast;ba-forw(i,j,k)&lowast;fo+cen-rhs1
            <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
      <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
<a href="cpl.html#END">END</a> corm1



<a href="cpl.html#FUNCTION">SUBROUTINE</a> corm2
  <a href="cpl.html#REAL">REAL</a> ficen,ml,mr,md,mf,mb,fiy,fd,rhs1,cen,lef,rig,u,d,ba,fo,xv
  <a href="cpl.html#REAL">REAL</a> den,cl,cr,cd,cf,cb,tang,fiy0,fir,fu,fl,fr,fb,fff
  <a href="cpl.html#INTEGER">INTEGER</a> ndis
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=0 <a href="cpl.html#TO">TO</a> nz
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  i=0 <a href="cpl.html#TO">TO</a> nx
      <a href="cpl.html#IF">IF</a>  i &lt; 2  <a href="cpl.html#OR">OR</a>  i &gt; nx-2 <a href="cpl.html#IF">THEN</a>
        <a href="cpl.html#IF">IF</a> i&lowast;h &lt; 0.25 <a href="cpl.html#IF">THEN</a>
          xv=0.
        <a href="cpl.html#ELSE">ELSE</a>
          xv=0.5
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a> fondo(xv,k&lowast;h)&gt;2&lowast;h <a href="cpl.html#IF">THEN</a> 
          <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  j=btm(i,k) <a href="cpl.html#TO">TO</a> btm(0,0)+2
            ndis=nid(i,j,k)
            <a href="cpl.html#IF">IF</a>  ndis &gt; 0  <a href="cpl.html#IF">THEN</a> 
              del=vdel(ndis)
              k1=vk1(ndis)
              k2=vk2(ndis)
              zn=vzn(ndis)
              calfa=vcalfa(ndis)
              salfa=vsalfa(ndis)
              costanti(i,j,k)
              ad1=ad(i,j,k)+1.
              den=ad(i,j,k)&lowast;ad1
              cl=0.
              cd=0.
              cr=0.
              cf=0.
              cb=0.
              ml=0.
              md=0.
              mr=0.
              mf=0.
              mb=0.
              ba=0
              fo=0
              lef=0
              rig=0
              d=0
              u=m2co(i,j+1,k)
              cen=m2co(i,j,k)
              ficen=fico(i,j,k)
              fu=fico(i,j+1,k)
              <a href="cpl.html#IF">IF</a> btm(i-1,k) &gt; j <a href="cpl.html#IF">THEN</a>
                fl=0
              <a href="cpl.html#ELSE">ELSE</a>
                fl=fico(i-1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a> btm(i+1,k) &gt; j <a href="cpl.html#IF">THEN</a>
                fr=0
              <a href="cpl.html#ELSE">ELSE</a>
                fr=fico(i+1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> btm(i,k-1) &gt; j <a href="cpl.html#IF">THEN</a>
                fb=0
              <a href="cpl.html#ELSE">ELSE</a>
                fb=fico(i,j,k-1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a> btm(i,k+1) &gt; j <a href="cpl.html#IF">THEN</a>
                fff=0
              <a href="cpl.html#ELSE">ELSE</a>
                fff=fico(i,j,k+1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a> btm(i,k)=j <a href="cpl.html#IF">THEN</a>
                fd=0
              <a href="cpl.html#ELSE">ELSE</a>
                fd=fico(i,j-1,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> ad(i,j,k) &lt; pfo <a href="cpl.html#IF">THEN</a>
                fiy=ders(ficen,fu,fico(i,j+2,k),1,2,2)
              <a href="cpl.html#ELSE">ELSE</a>
                fiy=derc(ficen,fd,fu,ad(i,j,k),1,den)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> j=btm(i,k) <a href="cpl.html#IF">THEN</a>
                <a href="cpl.html#IF">IF</a> ad(i,j,k) &lt; pfo <a href="cpl.html#IF">THEN</a>
                  fiy0=ders(0,fu,fico(i,j+2,k),ad1,ad1+1,ad1&lowast;(ad1+1))
                <a href="cpl.html#ELSE">ELSE</a>
                  fiy0=ders(0,ficen,fu,ad(i,j,k),ad1,den)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              tang=(fondo(i&lowast;h-eps,k&lowast;h)-fondo(i&lowast;h+eps,h&lowast;k))/2/eps
              
              <a href="cpl.html#IF">IF</a>  btm(i-1,k) &gt; j  <a href="cpl.html#IF">THEN</a>
                cl=bcl(i,j,k)
                lef=0.
                <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
                  ml=fiy
                <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
                  <a href="cpl.html#IF">IF</a> i=1 <a href="cpl.html#AND">AND</a> j= btm(i-1,k) <a href="cpl.html#IF">THEN</a>
                    <span class=comment>!   ml=fiy</span>
                    ml=0
                  <a href="cpl.html#ELSE">ELSE</a>
                    ml=fyl(i,j,k,1,1,1)
                  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#ELSE">ELSE</a>
                lef=m2co(i-1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a>  btm(i+1,k) &gt;  j  <a href="cpl.html#IF">THEN</a>
                cr=bcr(i,j,k)
                rig=0.
                <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
                  mr=fiy
                <a href="cpl.html#ELSE">ELSE</a>  <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
                  <a href="cpl.html#IF">IF</a> i=nx-1 <a href="cpl.html#AND">AND</a> j= btm(i+1,k) <a href="cpl.html#IF">THEN</a>
                    <span class=comment>!   mr=fiy</span>
                    mr=0
                  <a href="cpl.html#ELSE">ELSE</a>
                    mr=fyl(i,j,k,1,1,-1)
                  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#ELSE">ELSE</a>
                rig=m2co(i+1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a>  j &gt; btm(i,k)  <a href="cpl.html#IF">THEN</a>
                d=m2co(i,j-1,k)
              <a href="cpl.html#ELSE">ELSE</a>
                cd=bcd(i,j,k)
                d=0.
                <a href="cpl.html#IF">IF</a> (i=0 <a href="cpl.html#OR">OR</a> i=nx) <a href="cpl.html#AND">AND</a> j &gt;1 <a href="cpl.html#IF">THEN</a>
                  md=0
                <a href="cpl.html#ELSE">ELSE</a>
                  md=fiy0
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> btm(i,k-1) &gt;  j  <a href="cpl.html#IF">THEN</a>
                cb=bcb(i,j,k)
                ba=0
                <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
                  mb=fiy
                <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
                  <span class=comment>!  mb=fiy</span>
                  mb=fyl(i,j,k,0,1,1)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#ELSE">ELSE</a>
                ba=m2co(i,j,k-1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a> btm(i,k+1) &gt;  j  <a href="cpl.html#IF">THEN</a>
                cf=bcf(i,j,k)
                fo=0
                <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
                  mf=fiy
                <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
                  <span class=comment>!  mf=fiy</span>
                  mf=fyl(i,j,k,0,1,-1)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#ELSE">ELSE</a>
                fo=m2co(i,j,k+1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              rhs1=cl&lowast;ml+cd&lowast;md+cb&lowast;mb+cf&lowast;mf+cr&lowast;mr
              rhs(i,j,k)=rhs(i,j,k)-left(i,j,k)&lowast;lef-right(i,j,k)&lowast;rig-down(i,j,k) \
              &lowast;d-up(i,j,k)&lowast;u-back(i,j,k)&lowast;ba-forw(i,j,k)&lowast;fo+cen-rhs1
            <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
      <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
<a href="cpl.html#END">END</a> corm2

<a href="cpl.html#FUNCTION">SUBROUTINE</a> corm3
  <a href="cpl.html#REAL">REAL</a> ficen,ml,mr,md,mf,mb,fiz,rhs1,cen,lef,rig,u,d,ba,fo,abf,xv
  <a href="cpl.html#REAL">REAL</a> den,cl,cr,cd,cf,cb,fiq,fit,tangz,fl,fr,fb,fff,fu,ffff,fbb
  <a href="cpl.html#INTEGER">INTEGER</a> ndis
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=0 <a href="cpl.html#TO">TO</a> nz
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  i=0 <a href="cpl.html#TO">TO</a> nx
      <a href="cpl.html#IF">IF</a>  i &lt; 2  <a href="cpl.html#OR">OR</a>  i &gt; nx-2 <a href="cpl.html#IF">THEN</a>
        <a href="cpl.html#IF">IF</a> i&lowast;h &lt; 0.25 <a href="cpl.html#IF">THEN</a>
          xv=0.
        <a href="cpl.html#ELSE">ELSE</a>
          xv=0.5
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a> fondo(xv,h&lowast;k)&gt;2&lowast;h <a href="cpl.html#IF">THEN</a>  
          <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  j=btm(i,k) <a href="cpl.html#TO">TO</a> btm(0,0)+2
            ndis=nid(i,j,k)
            
            <a href="cpl.html#IF">IF</a>  ndis &gt; 0  <a href="cpl.html#IF">THEN</a> 
              del=vdel(ndis)
              k1=vk1(ndis)
              k2=vk2(ndis)
              zn=vzn(ndis)
              calfa=vcalfa(ndis)
              salfa=vsalfa(ndis)
              costanti(i,j,k)
              <span class=comment>!   WRITE 'c6,i,j,k',c6,i,j,k</span>
              <span class=comment>!    IF (i=0 AND j=btm(0,0)) OR (i=nx AND j=btm(nx,0))THEN WRITE i,j,c6</span>
              abf=ab(i,j,k)+af(i,j,k)
              den=ab(i,j,k)&lowast;af(i,j,k)&lowast;abf
              ad1=ad(i,j,k)+1
              cb=0.
              cf=0.
              cl=0.
              cr=0.
              cd=0.
              mf=0.
              mb=0.
              md=0.
              ml=0.
              mr=0.
              u=m3co(i,j+1,k)
              cen=m3co(i,j,k)
              ficen=fico(i,j,k)
              fu=fico(i,j+1,k)
              <a href="cpl.html#IF">IF</a> btm(i-1,k) &gt; j <a href="cpl.html#IF">THEN</a>
                fl=0
              <a href="cpl.html#ELSE">ELSE</a>
                fl=fico(i-1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a> btm(i+1,k) &gt; j <a href="cpl.html#IF">THEN</a>
                fr=0
              <a href="cpl.html#ELSE">ELSE</a>
                fr=fico(i+1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> btm(i,k-1) &gt; j <a href="cpl.html#IF">THEN</a>
                fb=0
              <a href="cpl.html#ELSE">ELSE</a>
                fb=fico(i,j,k-1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a> btm(i,k+1) &gt; j <a href="cpl.html#IF">THEN</a>
                fff=0
              <a href="cpl.html#ELSE">ELSE</a>
                fff=fico(i,j,k+1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <span class=comment>! calcolo fiz</span>
              <a href="cpl.html#IF">IF</a>  ab(i,j,k) &lt; pfo  <a href="cpl.html#AND">AND</a>  k &lt;  nz  <a href="cpl.html#IF">THEN</a>
                fiz=ders(ficen,fff,fico(i,j,k+2),1,2,2)
              <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a>  af(i,j,k) &lt; pfo <a href="cpl.html#AND">AND</a>  k &gt; 0  <a href="cpl.html#IF">THEN</a>
                fiz=-ders(ficen,fb,fico(i,j,k-2),1,2,2)
              <a href="cpl.html#ELSE">ELSE</a>
                fiz=derc(ficen,fb,fff,ab(i,j,k),af(i,j,k),den)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <span class=comment>! fine calcolo fiz</span>
              <a href="cpl.html#IF">IF</a>(ab(i,j,k) &lt; pfo <a href="cpl.html#AND">AND</a> k=nz) <a href="cpl.html#OR">OR</a> (af(i,j,k)&lt;pfo <a href="cpl.html#AND">AND</a> k=0) <a href="cpl.html#IF">THEN</a> fiz=(fff-fb)/abf/h
              
              <a href="cpl.html#IF">IF</a>  btm(i,k-1) &gt;  j  <a href="cpl.html#IF">THEN</a>
                ba=0.
                cb=bcb(i,j,k)
                <a href="cpl.html#IF">IF</a>  ab(i,j,k) &lt; pfo <a href="cpl.html#AND">AND</a>  k &lt; nz  <a href="cpl.html#IF">THEN</a>
                  mb=ders(0,fff,fico(i,j,k+2),abf,abf+1,abf&lowast;(abf+1))
                <a href="cpl.html#ELSE">ELSE</a>
                  mb=ders(0,ficen,fff,ab(i,j,k),abf,den)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
                <a href="cpl.html#IF">IF</a> i=0 <a href="cpl.html#OR">OR</a> i=nx <a href="cpl.html#IF">THEN</a> mb=0
              <a href="cpl.html#ELSE">ELSE</a>
                ba=m3co(i,j,k-1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <span class=comment>!   IF  ab(i,j,k) &lt; pfo  AND  k = nz  THEN  mb=fiz</span>
              
              <a href="cpl.html#IF">IF</a>  btm(i,k+1) &gt;  j  <a href="cpl.html#IF">THEN</a>
                fo=0.
                cf=bcf(i,j,k)
                <a href="cpl.html#IF">IF</a>  af(i,j,k) &lt; pfo <a href="cpl.html#AND">AND</a>  k &gt; 0  <a href="cpl.html#IF">THEN</a>
                  mf=-ders(0,fb,fico(i,j,k-2),abf,abf+1,abf&lowast;(abf+1))
                <a href="cpl.html#ELSE">ELSE</a>
                  mf=-ders(0,ficen,fb,af(i,j,k),abf,den)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
                <a href="cpl.html#IF">IF</a> i=0 <a href="cpl.html#OR">OR</a> i=nx <a href="cpl.html#IF">THEN</a> mf=0
              <a href="cpl.html#ELSE">ELSE</a>
                fo=m3co(i,j,k+1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <span class=comment>!  IF      af(i,j,k) &lt; pfo AND   k=0  THEN mf=fiz</span>
              
              <span class=comment>! calcolo md  &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;</span>
              <a href="cpl.html#IF">IF</a> j &gt; btm(i,k)  <a href="cpl.html#IF">THEN</a>
                d=m3co(i,j-1,k)
              <a href="cpl.html#ELSE">ELSE</a>
                d=0
                cd=bcd(i,j,k)
                tangz=(fondo(i&lowast;h,k&lowast;h-eps)-fondo(i&lowast;h,h&lowast;k+eps))/2/eps
                <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
                  md=fiz
                <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
                  <span class=comment>!   md=fiz</span>
                  md=fxd(tangz,i,j,k,0,1)
                  <a href="cpl.html#IF">IF</a> i=0 <a href="cpl.html#OR">OR</a> i=nx <a href="cpl.html#IF">THEN</a> md=0
                  <span class=comment>!(    IF i=0 OR i=nx THEN
                      IF tangz&gt;0 THEN
                        md=(tangz/ad(i,j,k+1))&lowast;&lowast;1.5/h&lowast;fff
                      ELSE IF tangz&lt;0 THEN
                        md=-(-tangz/ad(i,j,k-1))&lowast;&lowast;1.5/h&lowast;fb
                      ELSE
                        md=0
                      END IF
                    END IF
                    !)</span>
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
                <a href="cpl.html#IF">IF</a> tangz=0 <a href="cpl.html#IF">THEN</a> md=0
                <a href="cpl.html#IF">IF</a> k=0 <a href="cpl.html#AND">AND</a> wp=-1 <a href="cpl.html#IF">THEN</a> md=0
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <span class=comment>!   fine calcolo md &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;</span>
              
              <a href="cpl.html#IF">IF</a> btm(i-1,k) &gt; j  <a href="cpl.html#IF">THEN</a>
                cl=bcl(i,j,k)
                lef=0
                <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
                  ml=fiz
                  <span class=comment>!   ml=0</span>
                <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
                  <span class=comment>!   ml=fiz</span>
                  ml=0
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#ELSE">ELSE</a>
                lef=m3co(i-1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> btm(i+1,k) &gt; j  <a href="cpl.html#IF">THEN</a>
                cr=bcr(i,j,k)
                rig=0
                <a href="cpl.html#IF">IF</a> pbc=1 <a href="cpl.html#IF">THEN</a>
                  mr=fiz
                  <span class=comment>!   mr=0</span>
                <a href="cpl.html#ELSE">ELSE</a>  <a href="cpl.html#IF">IF</a> pbc=2 <a href="cpl.html#IF">THEN</a>
                  <span class=comment>!  mr=fiz</span>
                  mr=0
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#ELSE">ELSE</a>
                rig=m3co(i+1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              rhs1=cl&lowast;ml+cd&lowast;md+cb&lowast;mb+cf&lowast;mf+mr&lowast;cr
              rhs(i,j,k)=rhs(i,j,k)-left(i,j,k)&lowast;lef-right(i,j,k)&lowast;rig-down(i,j,k) \
              &lowast;d-up(i,j,k)&lowast;u-back(i,j,k)&lowast;ba-forw(i,j,k)&lowast;fo+cen-rhs1
            <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
      <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a> 
<a href="cpl.html#END">END</a> corm3




<span class=comment>! &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;</span>


<a href="cpl.html#FUNCTION">SUBROUTINE</a> corfi
  
  
  <a href="cpl.html#REAL">REAL</a> den1,den2,den3
  <a href="cpl.html#REAL">REAL</a> m1x,m2y,m3z,alr,abf,ml,mr,mb,mf,ad1,md,ficen,lef,rig,d,fu,ba,xv,fo
  <a href="cpl.html#REAL">REAL</a> fl,fr,fb,fff,fll,frr
  <a href="cpl.html#INTEGER">INTEGER</a> ndis
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=0 <a href="cpl.html#TO">TO</a> nz
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  i=0 <a href="cpl.html#TO">TO</a> nx
      <a href="cpl.html#IF">IF</a>  i &lt; 2  <a href="cpl.html#OR">OR</a>  i &gt; nx-2 <a href="cpl.html#IF">THEN</a>
        <a href="cpl.html#IF">IF</a> i&lowast;h &lt; 0.25 <a href="cpl.html#IF">THEN</a>
          xv=0.
        <a href="cpl.html#ELSE">ELSE</a>
          xv=0.5
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
        <a href="cpl.html#IF">IF</a> fondo(xv,h&lowast;k)&gt;2&lowast;h <a href="cpl.html#IF">THEN</a>
          <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  j=btm(i,k) <a href="cpl.html#TO">TO</a> btm(0,0)+2
            ndis=nid(i,j,k)
            <a href="cpl.html#IF">IF</a>  ndis &gt; 0  <a href="cpl.html#IF">THEN</a> 
              del=vdel(ndis)
              k1=vk1(ndis)
              k2=vk2(ndis)
              zn=vzn(ndis)
              calfa=vcalfa(ndis)
              salfa=vsalfa(ndis)
              costanti(i,j,k)
              alr=al(i,j,k)+ar(i,j,k)
              abf=ab(i,j,k)+af(i,j,k)
              ad1=ad(i,j,k)+1.
              den1=al(i,j,k)&lowast;ar(i,j,k)&lowast;alr
              den2=ad(i,j,k)&lowast;ad1
              den3=af(i,j,k)&lowast;ab(i,j,k)&lowast;abf
              mr=m1co(i+1,j,k)
              rig=fico(i+1,j,k)
              fu=fico(i,j+1,k)
              fff=fico(i,j,k+1)
              <a href="cpl.html#IF">IF</a> btm(i,k+1) &gt; j  <a href="cpl.html#IF">THEN</a>  fff=0.
              fb=fico(i,j,k-1)
              <a href="cpl.html#IF">IF</a> btm(i,k-1) &gt; j  <a href="cpl.html#IF">THEN</a>  fb=0.
              ficen=fico(i,j,k)
              <a href="cpl.html#IF">IF</a> btm(i-1,k) &gt; j <a href="cpl.html#IF">THEN</a>
                fl=0
              <a href="cpl.html#ELSE">ELSE</a>
                fl=fico(i-1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> i=0 <a href="cpl.html#IF">THEN</a>
                fll=wp&lowast;fico(i+2,j,k)
                <a href="cpl.html#IF">IF</a> btm(i+2,k)&gt; j <a href="cpl.html#IF">THEN</a> fll=0
              <a href="cpl.html#ELSE">ELSE</a>
                fll=fico(i-2,j,k)
                <a href="cpl.html#IF">IF</a> btm(i-2,k)&gt; j <a href="cpl.html#IF">THEN</a> fll=0
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> btm(i+1,k) &gt; j <a href="cpl.html#IF">THEN</a>
                fr=0
              <a href="cpl.html#ELSE">ELSE</a>
                fr=fico(i+1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a> i=nx <a href="cpl.html#IF">THEN</a>
                frr=wp&lowast;fico(i-2,j,k)
                <a href="cpl.html#IF">IF</a> btm(i-2,k)&gt; j <a href="cpl.html#IF">THEN</a> frr=0
              <a href="cpl.html#ELSE">ELSE</a>
                frr=fico(i+2,j,k)
                <a href="cpl.html#IF">IF</a> btm(i+2,k)&gt; j <a href="cpl.html#IF">THEN</a> frr=0
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              
              <a href="cpl.html#IF">IF</a>   j &gt; btm(i,k)  <a href="cpl.html#IF">THEN</a>    
                d=fico(i,j-1,k)
                md=m2co(i,j-1,k)
              <a href="cpl.html#ELSE">ELSE</a>
                d=0.
                <a href="cpl.html#IF">IF</a> ad(i,j,k) &lt; pfo <a href="cpl.html#IF">THEN</a>
                  md=ders(0,fu,fico(i,j+2,k),ad1,ad1+1,ad1&lowast;(ad1+1))
                <a href="cpl.html#ELSE">ELSE</a>
                  md=ders(0,ficen,fu,ad(i,j,k),ad1,den2)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
                <a href="cpl.html#IF">IF</a> (i=0 <a href="cpl.html#OR">OR</a> i=nx) <a href="cpl.html#AND">AND</a> j&gt;1 <a href="cpl.html#IF">THEN</a> md=0
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a>  btm(i+1,k) &gt; j  <a href="cpl.html#IF">THEN</a>
                rig=0.
                <a href="cpl.html#IF">IF</a> ar(i,j,k) &lt; pfo <a href="cpl.html#IF">THEN</a>
                  mr=-ders(0,fl,fll,alr,alr+1,alr&lowast;(alr+1))
                <a href="cpl.html#ELSE">ELSE</a>
                  mr=-ders(0,ficen,fl,ar(i,j,k),alr,den1)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#ELSE">ELSE</a>
                rig=fico(i+1,j,k)
                mr=m1co(i+1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a>  btm(i-1,k) &gt; j <a href="cpl.html#IF">THEN</a>
                lef=0.
                <a href="cpl.html#IF">IF</a>  al(i,j,k) &lt; pfo   <a href="cpl.html#IF">THEN</a>
                  ml=ders(0,fr,frr,alr,alr+1,alr&lowast;(alr+1))
                <a href="cpl.html#ELSE">ELSE</a>
                  ml=ders(0,ficen,fr,al(i,j,k),alr,den1)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#ELSE">ELSE</a>
                lef=fico(i-1,j,k)
                ml=m1co(i-1,j,k)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a>  btm(i,k+1) &gt; j <a href="cpl.html#IF">THEN</a>
                fo=0.
                <a href="cpl.html#IF">IF</a>  af(i,j,k) &lt; pfo <a href="cpl.html#AND">AND</a>  k &gt; 0  <a href="cpl.html#IF">THEN</a>
                  mf=-ders(0.,fico(i,j,k-1),fico(i,j,k-2),abf,abf+1,abf&lowast;(abf+1))
                <a href="cpl.html#ELSE">ELSE</a>
                  mf=-ders(0.,fico(i,j,k),fico(i,j,k-1),af(i,j,k),abf,den3)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
                <a href="cpl.html#IF">IF</a>  (af(i,j,k) &lt; pfo <a href="cpl.html#OR">OR</a>  ab(i,j,k) &lt; pfo)  <a href="cpl.html#AND">AND</a> (k=nz <a href="cpl.html#OR">OR</a> k=0)  <a href="cpl.html#IF">THEN</a>   mf=(fff-fb)/abf/h
                <a href="cpl.html#IF">IF</a> i=0 <a href="cpl.html#OR">OR</a> i=nx  <a href="cpl.html#IF">THEN</a> mf=0
              <a href="cpl.html#ELSE">ELSE</a>
                fo=fico(i,j,k+1)
                mf=m3co(i,j,k+1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a> btm(i,k-1) &gt;  j  <a href="cpl.html#IF">THEN</a>
                ba=0.
                <a href="cpl.html#IF">IF</a>  ab(i,j,k) &lt; pfo <a href="cpl.html#AND">AND</a>  k &lt; nz  <a href="cpl.html#IF">THEN</a>
                  mb=ders(0.,fico(i,j,k+1),fico(i,j,k+2),abf,abf+1,abf&lowast;(abf+1))
                <a href="cpl.html#ELSE">ELSE</a>
                  mb=ders(0.,fico(i,j,k),fico(i,j,k+1),ab(i,j,k),abf,den3)
                <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
                <a href="cpl.html#IF">IF</a>(af(i,j,k) &lt; pfo <a href="cpl.html#OR">OR</a>  ab(i,j,k) &lt; pfo)  <a href="cpl.html#AND">AND</a> (k=nz <a href="cpl.html#OR">OR</a> k=0 ) <a href="cpl.html#IF">THEN</a> mb=(fff-fb)/abf/h
                <a href="cpl.html#IF">IF</a> i=0 <a href="cpl.html#OR">OR</a> i=nx  <a href="cpl.html#IF">THEN</a> mb=0
              <a href="cpl.html#ELSE">ELSE</a>
                ba=fico(i,j,k-1)
                mb=m3co(i,j,k-1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a>  al(i,j,k) &lt; pfo <a href="cpl.html#AND">AND</a>  i &lt;  nx  <a href="cpl.html#IF">THEN</a>
                m1x=ders(m1co(i,j,k),mr,m1co(i+2,j,k),1.,2.,2.)
              <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a>  ar(i,j,k) &lt; pfo <a href="cpl.html#AND">AND</a>  i &gt; 0  <a href="cpl.html#IF">THEN</a>
                m1x=-ders(m1co(i,j,k),ml,m1co(i-2,j,k),1.,2.,2.)
              <a href="cpl.html#ELSE">ELSE</a>
                m1x=derc(m1co(i,j,k),ml,mr,al(i,j,k),ar(i,j,k),den1)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a> ad(i,j,k) &lt; pfo <a href="cpl.html#IF">THEN</a> 
                m2y=ders(m2co(i,j,k),m2co(i,j+1,k),m2co(i,j+2,k),1,2,2)
              <a href="cpl.html#ELSE">ELSE</a>
                m2y=derc(m2co(i,j,k),md,m2co(i,j+1,k),ad(i,j,k),1,den2)
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              <a href="cpl.html#IF">IF</a>  ab(i,j,k) &lt; pfo  <a href="cpl.html#AND">AND</a>  k  &lt; nz  <a href="cpl.html#IF">THEN</a>
                m3z=ders(m3co(i,j,k),mf,m3co(i,j,k+2),1.,2.,2.)
              <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a>  af(i,j,k) &lt; pfo <a href="cpl.html#AND">AND</a>  k &gt; 0  <a href="cpl.html#IF">THEN</a>
                m3z=-ders(m3co(i,j,k),mb,m3co(i,j,k-2),1.,2.,2.)
              <a href="cpl.html#ELSE">ELSE</a>
                m3z=derc(m3co(i,j,k),mb,mf,ab(i,j,k),af(i,j,k),den3)
                <a href="cpl.html#IF">IF</a>  ( af(i,j,k) &lt; pfo <a href="cpl.html#OR">OR</a> ab(i,j,k) &lt; pfo)  <a href="cpl.html#AND">AND</a> (k = nz <a href="cpl.html#OR">OR</a> k=0) <a href="cpl.html#IF">THEN</a> m3z=(mf-mb)/abf/h
              <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
              rhs(i,j,k)=rhs(i,j,k)+(m1x+m2y+m3z)&lowast;coenoto(i,j,k)&lowast;h&lowast;h+ficen-lef&lowast; \
              left(i,j,k)-rig&lowast;right(i,j,k)-d&lowast;down(i,j,k)-fu&lowast;up(i,j,k)-fo&lowast; \
              forw(i,j,k)-ba&lowast;back(i,j,k)
            <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
            
          <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
      <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
<a href="cpl.html#END">END</a> corfi

<span class=comment>! &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;  FINE  SUBROUTINES  &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;</span>

<a href="cpl.html#LOOP">LOOP</a> kapp <a href="cpl.html#FOR">FOR</a>  fk=k0 <a href="cpl.html#TO">TO</a> numk 
  ka=fk
  rapp=rap0
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  fr=1 <a href="cpl.html#TO">TO</a> numh
    rapp=rapp+delth
    <a href="cpl.html#LOOP">LOOP</a>  <a href="cpl.html#FOR">FOR</a>   ff=1 <a href="cpl.html#TO">TO</a> numf
      fill=fil0+deltf&lowast;ff
      
      <a href="cpl.html#WRITE">WRITE</a> 'ly,lz.fill,rapp,rapp/h',ly,lz,fill,rapp,rapp/h
      <a href="cpl.html#WRITE">WRITE</a>'kappa',ka
      
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   i=-1 <a href="cpl.html#TO">TO</a> nx+1
        <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=-1 <a href="cpl.html#TO">TO</a> nz+1
          btm(i,k)=0
        <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   i=0 <a href="cpl.html#TO">TO</a> nx
        <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=0 <a href="cpl.html#TO">TO</a> nz
          btf(i,k)=0
        <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   i=-1 <a href="cpl.html#TO">TO</a> nx+1
        <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   j=0 <a href="cpl.html#TO">TO</a> ny
          <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=-1 <a href="cpl.html#TO">TO</a> nz+1
            fi(i,j,k)=0.
            m1(i,j,k)=0.
            m2(i,j,k)=0.
            m3(i,j,k)=0.
          <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   i=0 <a href="cpl.html#TO">TO</a> nx
        <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   j=0 <a href="cpl.html#TO">TO</a> ny0  
          <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=0 <a href="cpl.html#TO">TO</a> nz
            ad(i,j,k)=1.
            al(i,j,k)=1.
            ar(i,j,k)=1.
            af(i,j,k)=1.
            ab(i,j,k)=1.
            left(i,j,k)=0.
            right(i,j,k)=0.
            up(i,j,k)=0.
            down(i,j,k)=0.
            back(i,j,k)=0.
            forw(i,j,k)=0.
            bcl(i,j,k)=0.
            bcr(i,j,k)=0.
            bcd(i,j,k)=0. 
            bcu(i,j,k)=0.
            bcb(i,j,k)=0.
            bcf(i,j,k)=0.
            coenoto(i,j,k)=0.
          <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   i=0 <a href="cpl.html#TO">TO</a> nx
        <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   j=0 <a href="cpl.html#TO">TO</a> ny  
          <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=0 <a href="cpl.html#TO">TO</a> nz
            rhs(i,j,k)=0
          <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   i=0 <a href="cpl.html#TO">TO</a> nx
        x=i&lowast;h
        <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=0 <a href="cpl.html#TO">TO</a> nz
          z=k&lowast;h
          btm(i,k)=1+<a href="cpl.html#FLOOR">FLOOR</a>(fondo(x,z)/h)
          
          <a href="cpl.html#IF">IF</a> <a href="cpl.html#ABS">ABS</a>(1+fondo(x,z)/h- btm(i,k))&gt; 1-h/100 <a href="cpl.html#IF">THEN</a> btm(i,k)=btm(i,k)+1
          
        <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=-1 <a href="cpl.html#TO">TO</a> nz+1
        btm(nx+1,k)=btm(nx-1,k) 
        btm(-1,k)=btm(1,k)
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  i=-1 <a href="cpl.html#TO">TO</a> nx+1
        btm(i,-1)=btm(i,1)
        btm(i,nz+1)=btm(nx-i,nz-1)
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <span class=comment>!      calcolo di btf                       </span>
      <span class=comment>! &lowast;&lowast;&lowast;&lowast;&lowast;o&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;     </span>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=0 <a href="cpl.html#TO">TO</a> nz
        <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  i=0 <a href="cpl.html#TO">TO</a> nx
          btf(i,k)=<a href="cpl.html#MAX">MAX</a>(btm(i,k)+1,btm(i-1,k),btm(i+1,k))
          btf(i,k)=<a href="cpl.html#MAX">MAX</a>(btf(i,k),btm(i,k-1),btm(i,k+1))
        <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a> 
      <a href="cpl.html#WRITE">WRITE</a> 'fine calcolo btf '  
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=0 <a href="cpl.html#TO">TO</a> nz
        z=k&lowast;h
        <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   i=0 <a href="cpl.html#TO">TO</a> nx
          x=h&lowast;i
          <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   j=btm(i,k) <a href="cpl.html#TO">TO</a> btf(i,k)-1
            y=h&lowast;j
            <a href="cpl.html#IF">IF</a> j =btm(i,k) <a href="cpl.html#IF">THEN</a>  ad(i,j,k)=j-fondo(x,z)/h
            <a href="cpl.html#IF">IF</a> btm(i-1,k) &gt; j <a href="cpl.html#IF">THEN</a> al(i,j,k)=(x-vert(y,x,x-h,z))/h
            <a href="cpl.html#IF">IF</a> btm(i+1,k)  &gt; j <a href="cpl.html#IF">THEN</a> ar(i,j,k)=(vert(y,x,x+h,z)-x)/h
            <a href="cpl.html#IF">IF</a>  i = nx  <a href="cpl.html#IF">THEN</a> ar(i,j,k)=al(i,j,k)
            <span class=comment>!       WRITE'condizione di simmmetria rispetto ad x',i,j,k</span>
            <a href="cpl.html#IF">IF</a>  btm(i,k-1) &gt; j  <a href="cpl.html#IF">THEN</a> ab(i,j,k)=(z-vertz(y,z,z-h,x))/h
            <a href="cpl.html#IF">IF</a> btm(i,k+1) &gt; j <a href="cpl.html#IF">THEN</a> af(i,j,k)=(vertz(y,z,z+h,x)-z)/h
            <span class=comment>! condizione di simmetria rispetto all'asse x</span>
            <a href="cpl.html#IF">IF</a> z=0 <a href="cpl.html#IF">THEN</a> ab(i,j,k)=af(i,j,k)
            
            deny=ad(i,j,k)&lowast;(1.+ad(i,j,k))
            denx=al(i,j,k)&lowast;ar(i,j,k)&lowast;(al(i,j,k)+ar(i,j,k))
            denz=af(i,j,k)&lowast;ab(i,j,k)&lowast;(af(i,j,k)+ab(i,j,k))
            dud=deny/2.
            dlr=denx/2.
            dbf=denz/2.
            axr=al(i,j,k)
            axl=ar(i,j,k)
            ax0=axl+axr
            ayu=ad(i,j,k)
            ayd=1.
            ay0=ayu+ayd 
            azf=ab(i,j,k)
            azb=af(i,j,k)
            az0=azf+azb
            deno=ax0&lowast;dbf&lowast;dud+ay0&lowast;dbf&lowast;dlr+az0&lowast;dlr&lowast;dud
            bcl(i,j,k)=axl&lowast;dud&lowast;dbf/deno
            bcd(i,j,k)=ayd&lowast;dlr&lowast;dbf/deno
            bcr(i,j,k)=axr&lowast;dud&lowast;dbf/deno
            bcu(i,j,k)=ayu&lowast;dlr&lowast;dbf/deno
            bcb(i,j,k)=azb&lowast;dud&lowast;dlr/deno
            bcf(i,j,k)=azf&lowast;dlr&lowast;dud/deno
            coenoto(i,j,k)=dud&lowast;dlr&lowast;dbf/deno
          <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
          <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  j= btf(i,k) <a href="cpl.html#TO">TO</a> ny0
            bcl(i,j,k)=1./6.
            bcd(i,j,k)=1./6.
            bcr(i,j,k)=1./6.
            bcu(i,j,k)=1./6.
            bcf(i,j,k)=1./6.
            bcb(i,j,k)=1./6.
            coenoto(i,j,k)=1./6.
          <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  i=0 <a href="cpl.html#TO">TO</a> nx
        <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=0 <a href="cpl.html#TO">TO</a> nz
          <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  j=btm(i,k) <a href="cpl.html#TO">TO</a> ny0
            left(i,j,k)=bcl(i,j,k)
            <a href="cpl.html#IF">IF</a> btm(i-1,k) &gt; j <a href="cpl.html#IF">THEN</a> left(i,j,k)=0.
            right(i,j,k)=bcr(i,j,k)
            <a href="cpl.html#IF">IF</a> btm(i+1,k) &gt; j <a href="cpl.html#IF">THEN</a> right(i,j,k)=0.
            back(i,j,k)=bcb(i,j,k)
            <a href="cpl.html#IF">IF</a> btm(i,k-1) &gt; j <a href="cpl.html#IF">THEN</a> back(i,j,k)=0.
            forw(i,j,k)=bcf(i,j,k)
            <a href="cpl.html#IF">IF</a> btm(i,k+1) &gt; j <a href="cpl.html#IF">THEN</a> forw(i,j,k)=0.
            down(i,j,k)=bcd(i,j,k)
            <a href="cpl.html#IF">IF</a> btm(i,k)= j <a href="cpl.html#IF">THEN</a> down(i,j,k)=0.
            up(i,j,k)=bcu(i,j,k)
            
          <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <span class=comment>!   WRITE 'al1,ar,ad1,ad,,bcl,bcr',al(1,btm(0,0)-1,0),ar(nx-1,btm(nx,0)-1,0),ad(0,</span>
      <span class=comment>!    btm(0,0),0),ad(nx,btm(nx,0),0),bcl(1,btm(0,0)-1,0),bcr(nx-1,btm(nx,0)-1,0)</span>
      <span class=comment>!    READ datof</span>
      
      <span class=comment>!(        calcolo diagramma
        LOOP FOR k=0 TO 32
          <span class=comment>!    LOOP FOR k=0 TO 100</span>
          <span class=comment>!   ALTEZZE k/100&lowast;lz/2&lowast;5/8, fondo(0,k/100&lowast;lz/2&lowast;5/8),btm(0,k).</span>
          ALTEZZE k, fondo(0,k&lowast;h)/h,btm(0,k).
        REPEAT LOOP
        STOP
        !)</span>
      <span class=comment>!&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;</span>
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   fw=0 <a href="cpl.html#TO">TO</a> 1
        wp=-1+fw&lowast;2 
        <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   i=-1 <a href="cpl.html#TO">TO</a> nx+1
          <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>   j=0 <a href="cpl.html#TO">TO</a> ny
            <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a>  k=-1 <a href="cpl.html#TO">TO</a> nz+1
              fi(i,j,k)=0.
              m1(i,j,k)=0.
              m2(i,j,k)=0.
              m3(i,j,k)=0.
            <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
          <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
        <span class=comment>!     calcolo di dati per correzioni</span>
        <a href="cpl.html#IF">IF</a> inco=1 <a href="cpl.html#IF">THEN</a>  catalogo
        <span class=comment>!( 
          LOOP FOR k=0 TO nz-3
            it=nid(0,btm(0,k),k)
            WRITE 'it,z,zn',it,k&lowast;h,vzn(it),
            'sa,ca,de,k1,k2',vsalfa(it),vcalfa(it),vdel(it),vk1(it),vk2(it)
            ALTEZZE k,vzn(it),vsalfa(it)
          REPEAT LOOP
          STOP
          !)</span>
        <a href="cpl.html#WRITE">WRITE</a>'inizio ciclo,btm(0,0),btm(0,1),btm(0,-1)',btm(0,0),btm(0,1),btm(0,-1)
        js=0
        it=1
        <a href="cpl.html#DO">DO</a>
          
          <a href="cpl.html#IF">IF</a> js=0 <a href="cpl.html#IF">THEN</a> prec=((wp+1)&lowast;m3(0,ny,0)+(1-wp)&lowast;m1(0,ny,0))/2
          <a href="cpl.html#IF">IF</a> it&lt;jsta <a href="cpl.html#IF">THEN</a> prec= 1000
          
          notom1
          <a href="cpl.html#IF">IF</a> it &gt;  10 <a href="cpl.html#AND">AND</a> inco=1  <a href="cpl.html#IF">THEN</a>    corm1
          vbmg(m1,btm,btf,left,down,right,up,back,forw,rhs,nx,ny,nz,-wp,-wp)
          
          notofia
          <a href="cpl.html#IF">IF</a> it &gt;  10 <a href="cpl.html#AND">AND</a> inco=1 <a href="cpl.html#IF">THEN</a>   corfi
          vbmg(fi,btm,btf,left,down,right,up,back,forw,rhs,nx,ny,nz,wp,-wp)
          notom2
          <a href="cpl.html#IF">IF</a> it &gt; 10 <a href="cpl.html#AND">AND</a> inco=1  <a href="cpl.html#IF">THEN</a>  corm2
          vbmg(m2,btm,btf,left,down,right,up,back,forw,rhs,nx,ny,nz,wp,-wp)
          
          notom3
          <a href="cpl.html#IF">IF</a> it &gt;  10 <a href="cpl.html#AND">AND</a> inco=1   <a href="cpl.html#IF">THEN</a>    corm3
          vbmg(m3,btm,btf,left,down,right,up,back,forw,rhs,nx,ny,nz,wp,wp)
          <span class=comment>!    vbrb(m3,btm,btf,left,down,right,up,back,forw,rhs,nx,ny,nz,wp,wp)</span>
          
          <a href="cpl.html#IF">IF</a>  js =jsta   <a href="cpl.html#IF">THEN</a>
            <a href="cpl.html#WRITE">WRITE</a>'m1c,m2c,m3c,fi',m1(0,ny,0):9.9,m2(0,ny,0),m3(0,ny,0):9.11,fi(0,ny,0),it
            js=0
          <a href="cpl.html#ELSE">ELSE</a>
            js=js+1
          <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
          it=it+1
          <a href="cpl.html#IF">IF</a> wp  = 1 <a href="cpl.html#IF">THEN</a> hlon=m3(0,ny,0)-ny&lowast;h+fondo(0.,0.)
          <a href="cpl.html#IF">IF</a> wp =  -1 <a href="cpl.html#IF">THEN</a> htra=m1(0,ny,0)-ny&lowast;h+fondo(0.,0.)
        <a href="cpl.html#UNTIL">UNTIL</a> <a href="cpl.html#ABS">ABS</a>(prec-((wp+1)&lowast;m3(0,ny,0)+(1-wp)&lowast;m1(0,ny,0))/2) &lt; 0.000001
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      <span class=comment>! &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast; fine ciclo parita' &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;</span>
      
      dh=hlon-htra
      <a href="cpl.html#WRITE">WRITE</a> 'hlon,htra,dh',hlon,htra,dh
      fillm=fill
      fils=fill
      <a href="cpl.html#IF">IF</a> prolo =3 <a href="cpl.html#IF">THEN</a> 
        fillm=(fill +rapp/2 +0.144074)&lowast;2/lz
        fils=(fill+0.144074)&lowast;2/lz 
      <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
      
      <span class=comment>! ALTEZZE rapp:15.10,fillm:15.10,dh:15.10,hlon:15.10,htra:15.10</span>
      ALTEZZE rapp:10.6,fils:10.6,fillm:10.6,dh:15.10,hlon:15.10,htra:15.10
      &lt;&lowast; fflush(ALTEZZE_); &lowast;&gt;
      
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
    <span class=comment>! &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;   fine ciclo fill  &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast; </span>
  <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
  <span class=comment>! &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;  fine ciclo rapporto &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;      </span>
<a href="cpl.html#LOOP">REPEAT</a> kapp 
<span class=comment>! &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;  fine ciclo kappa &lowast;&lowast;&lowast;&lowast;&lowast;&lowast;&lowast;      </span>





</pre></body></html>
