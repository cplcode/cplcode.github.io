<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>FluidMechanics/Spectral-CompactDiff-DNS/OpenMP/tsfft.cpl</title><meta name="description" content="CPL listing"><base href="https://CPLcode.net/Documentation/"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/singlecol.css"><style>pre{margin-left:0.5em;margin-right:0.5em} .comment{color:HotPink} a:link,a:visited{color:MediumBlue;text-decoration:none} a:hover,a:active{text-decoration:underline}</style>
<script type="application/ld+json">{
"@context":"http://schema.org",
"@type":"SoftwareSourceCode",
"name":"FluidMechanics/Spectral-CompactDiff-DNS/OpenMP/tsfft.cpl",
"programmingLanguage":{
"@type":"ComputerLanguage",
"name":"CPL",
"disambiguatingDescription":"Compiler and Programming Language Conceived by Paolo Luchini",
"url":"https://cplcode.net"}
}</script></head>
<body translate="no"><pre>
<span class=comment>! Fast-Fourier transform library (actually INCLUDed from fft.cmn)   <span class=comment>!</span></span>
<span class=comment>! and utilities to read the REAL values encoded in a COMPLEX array. <span class=comment>!</span></span>
<span class=comment>! For usage see fft.info.                                           <span class=comment>!</span></span>
<span class=comment>!                                                                   <span class=comment>!</span></span>
<span class=comment>! Copyright 1997-2021 Paolo Luchini http://CPLcode.net              <span class=comment>!</span></span>
<span class=comment>! Released under the attached LICENSE.                              <span class=comment>!</span></span>
<span class=comment>!                                                                   <span class=comment>!</span></span>
<span class=comment>! Code maturity: green.                                             <span class=comment>!</span></span>
<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!<span class=comment>!</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>

<a href="cpl.html#USE">USE</a> <a href="complex.html#Top">complex</a>
type=<a href="complex.html#Top">COMPLEX</a>

<a href="cpl.html#FUNCTION">SUBROUTINE</a> FFTSETUP(<a href="cpl.html#INTEGER">INTEGER</a> N) <a href="cpl.html#FOLLOWS">FOLLOWS</a>
<a href="cpl.html#INLINE">INLINE</a> <a href="cpl.html#FUNCTION">SUBROUTINE</a> IFT(type R<a href="cpl.html#REAL-operator">^</a>(&lowast;)) = IFT(R,R)
<a href="cpl.html#FUNCTION">SUBROUTINE</a> IFT(type Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;)) <a href="cpl.html#FOLLOWS">FOLLOWS</a>
<a href="cpl.html#INLINE">INLINE</a> <a href="cpl.html#FUNCTION">SUBROUTINE</a> FFT(type R<a href="cpl.html#REAL-operator">^</a>(&lowast;)) = FFT(R,R)
<a href="cpl.html#FUNCTION">SUBROUTINE</a> FFT(type Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;)) <a href="cpl.html#FOLLOWS">FOLLOWS</a>
<a href="cpl.html#INLINE">INLINE</a> <a href="cpl.html#FUNCTION">SUBROUTINE</a> RFT(type R<a href="cpl.html#REAL-operator">^</a>(&lowast;)) = RFT(R,R)
<a href="cpl.html#FUNCTION">SUBROUTINE</a> RFT(type Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;)) <a href="cpl.html#FOLLOWS">FOLLOWS</a>
<a href="cpl.html#INLINE">INLINE</a> <a href="cpl.html#FUNCTION">SUBROUTINE</a> HFT(type R<a href="cpl.html#REAL-operator">^</a>(&lowast;)) = HFT(R,R)
<a href="cpl.html#FUNCTION">SUBROUTINE</a> HFT(type Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;)) <a href="cpl.html#FOLLOWS">FOLLOWS</a>
<a href="cpl.html#INLINE">INLINE</a> <a href="cpl.html#FUNCTION">SUBROUTINE</a> IFTU(type R<a href="cpl.html#REAL-operator">^</a>(&lowast;)) = IFTU(R,R)
<a href="cpl.html#FUNCTION">SUBROUTINE</a> IFTU(type Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;)) <a href="cpl.html#FOLLOWS">FOLLOWS</a>
<a href="cpl.html#INLINE">INLINE</a> <a href="cpl.html#FUNCTION">SUBROUTINE</a> FFTU(type R<a href="cpl.html#REAL-operator">^</a>(&lowast;)) = FFTU(R,R)
<a href="cpl.html#FUNCTION">SUBROUTINE</a> FFTU(type Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;)) <a href="cpl.html#FOLLOWS">FOLLOWS</a>
<a href="cpl.html#INLINE">INLINE</a> <a href="cpl.html#FUNCTION">SUBROUTINE</a> RFTU(type R<a href="cpl.html#REAL-operator">^</a>(&lowast;)) = RFTU(R,R)
<a href="cpl.html#FUNCTION">SUBROUTINE</a> RFTU(type Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;)) <a href="cpl.html#FOLLOWS">FOLLOWS</a>
<a href="cpl.html#INLINE">INLINE</a> <a href="cpl.html#FUNCTION">SUBROUTINE</a> HFTU(type R<a href="cpl.html#REAL-operator">^</a>(&lowast;)) = HFTU(R,R)
<a href="cpl.html#FUNCTION">SUBROUTINE</a> HFTU(type Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;)) <a href="cpl.html#FOLLOWS">FOLLOWS</a>

<a href="cpl.html#BOOLEAN">BOOLEAN</a> <a href="cpl.html#FUNCTION">FUNCTION</a> FFTfit(<a href="cpl.html#INTEGER">INTEGER</a> <a href="cpl.html#VARIABLE">VARIABLE</a> N)
  <a href="cpl.html#IF">IF</a> N&lt;8 <a href="cpl.html#IF">THEN</a> <a href="cpl.html#RESULT">RESULT</a>=FALSE <a href="cpl.html#ELSE">ELSE</a>
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#UNTIL">UNTIL</a> ODD(N); N = <a href="cpl.html#Assignment">~</a> <a href="cpl.html#Bitwise">RSHIFTED</a> 1; <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
    <a href="cpl.html#RESULT">RESULT</a> = (N=1 <a href="cpl.html#OR">OR</a> N=3)
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
<a href="cpl.html#END">END</a> FFTfit

<a href="cpl.html#MODULE">MODULE</a> fft

<a href="cpl.html#FUNCTION">SUBROUTINE</a> ReverseInc(<a href="cpl.html#INTEGER">INTEGER</a> K<a href="cpl.html#REAL-operator">^</a>, N)
  <a href="cpl.html#INTEGER">INTEGER</a> M=N&gt;&gt;1
  <a href="cpl.html#LOOP">LOOP</a> ri
    <a href="cpl.html#IF">IF</a> M&gt;K <a href="cpl.html#IF">THEN</a> K=<a href="cpl.html#Assignment">~</a>+M; <a href="cpl.html#EXIT">EXIT</a> ri
    K=<a href="cpl.html#Assignment">~</a>-M
    <a href="cpl.html#IF">IF</a> M <a href="cpl.html#Bitwise">BITAND</a> 1 # 0 <a href="cpl.html#IF">THEN</a> K=<a href="cpl.html#Assignment">~</a>+1; <a href="cpl.html#EXIT">EXIT</a> ri
    M =<a href="cpl.html#Assignment">~</a>&gt;&gt; 1
  <a href="cpl.html#LOOP">REPEAT</a> ri
<a href="cpl.html#END">END</a> ReverseInc

<a href="cpl.html#STRUCTURE">STRUCTURE</a>[
  <a href="cpl.html#INTEGER">INTEGER</a> LASTN=1
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(&lowast;) <a href="cpl.html#OF">OF</a> <a href="complex.html#Top">COMPLEX</a> CEXP
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(&lowast;) <a href="cpl.html#OF">OF</a> <a href="cpl.html#INTEGER">INTEGER</a> RI
] BUF

<a href="cpl.html#FUNCTION">SUBROUTINE</a> FFTSETUP(<a href="cpl.html#INTEGER">INTEGER</a> N)
  <a href="cpl.html#WITH">WITH</a> BUF
  <a href="cpl.html#IF">IF</a> LASTN&gt;1 <a href="cpl.html#IF">THEN</a> <a href="cpl.html#NEW">FREE</a> CEXP,RI
  <a href="cpl.html#IF">IF</a> N&gt;1 <a href="cpl.html#IF">THEN</a>
    <a href="cpl.html#IF">IF</a> N <a href="cpl.html#INTEGER-operator">MOD</a> 3 =0 <a href="cpl.html#IF">THEN</a> LASTN=N <a href="cpl.html#ELSE">ELSE</a> LASTN=3&lowast;N
    RI=<a href="cpl.html#NEW">NEW</a> <a href="cpl.html#ARRAY">ARRAY</a>(0..LASTN+LASTN <a href="cpl.html#DIV">DIV</a> 3-1) <a href="cpl.html#OF">OF</a> <a href="cpl.html#INTEGER">INTEGER</a>
    <a href="cpl.html#INTEGER">INTEGER</a> K=0; <a href="cpl.html#DO">DO</a> RI(J)=K; ReverseInc(K,LASTN) <a href="cpl.html#FOR">FOR</a> J=0 <a href="cpl.html#TO">TO</a> LASTN-1
    <a href="cpl.html#INTEGER">INTEGER</a> K=0; <a href="cpl.html#DO">DO</a> RI(LASTN+J)=K; ReverseInc(K,LASTN <a href="cpl.html#DIV">DIV</a> 3) <a href="cpl.html#FOR">FOR</a> J=0 <a href="cpl.html#TO">TO</a> LASTN <a href="cpl.html#DIV">DIV</a> 3 -1
    <a href="cpl.html#EXCEPT">EXCEPT</a> LASTN&lt;=0 <span class=comment>! To quench gcc-8 alloc-size-larger-than warning</span>
    CEXP=<a href="cpl.html#NEW">NEW</a> <a href="cpl.html#ARRAY">ARRAY</a>(0..3&lowast;LASTN <a href="cpl.html#DIV">DIV</a> 4 - 1) <a href="cpl.html#OF">OF</a> <a href="complex.html#Top">COMPLEX</a>
    <a href="cpl.html#DO">DO</a> CEXP(K)=<a href="cpl.html#Builtin">EXP</a>(I&lowast;K&lowast;2&lowast;PI/LASTN) <a href="cpl.html#FOR">FOR</a> <a href="cpl.html#ALL">ALL</a> K
  <a href="cpl.html#ELSE">ELSE</a> LASTN=N
<a href="cpl.html#END">END</a> FFTSETUP

C3=<a href="cpl.html#Builtin">SIN</a>(PI/3)

<a href="cpl.html#INLINE">INLINE</a> <a href="cpl.html#FUNCTION">SUBROUTINE</a> BT4(<a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(&lowast;) <a href="cpl.html#OF">OF</a> type R; type R0,R1,R2,R3)
<span class=comment>!          R(J)=R(J)+R(J+M)+R(J+2&lowast;M)+R(J+3&lowast;M)</span>
<span class=comment>!          R(J+2&lowast;M)=R(J)-R(J+M)+R(J+2&lowast;M)-R(J+3&lowast;M)</span>
<span class=comment>!          R(J+M)=R(J)+I&lowast;R(J+M)-R(J+2&lowast;M)-I&lowast;R(J+3&lowast;M)</span>
<span class=comment>!          R(J+3&lowast;M)=R(J)-I&lowast;R(J+M)-R(J+2&lowast;M)+I&lowast;R(J+3&lowast;M)</span>
<span class=comment>!(
  A=R0+R1; B=R0-R1
  C=I&lowast;(R2-R3); D=R2+R3
  R(-1)=A+D
  R(0)=B+C
  R(1)=A-D
  R(2)=B-C
!)</span>
  A0P2R=R0.<a href="cpl.html#REAL">REAL</a>+R1.<a href="cpl.html#REAL">REAL</a>
  A0M2R=R0.<a href="cpl.html#REAL">REAL</a>-R1.<a href="cpl.html#REAL">REAL</a>
  A1M3R=R2.<a href="cpl.html#REAL">REAL</a>-R3.<a href="cpl.html#REAL">REAL</a>
  A1P3R=R2.<a href="cpl.html#REAL">REAL</a>+R3.<a href="cpl.html#REAL">REAL</a>
  A1M3I=R2.<a href="complex.html#Top">IMAG</a>-R3.<a href="complex.html#Top">IMAG</a>
  R(-1).<a href="cpl.html#REAL">REAL</a>=A0P2R+A1P3R
  R(1).<a href="cpl.html#REAL">REAL</a>=A0P2R-A1P3R
  R(2).<a href="cpl.html#REAL">REAL</a>=A0M2R+A1M3I
  R(0).<a href="cpl.html#REAL">REAL</a>=A0M2R-A1M3I
  A0P2I=R0.<a href="complex.html#Top">IMAG</a>+R1.<a href="complex.html#Top">IMAG</a>
  A0M2I=R0.<a href="complex.html#Top">IMAG</a>-R1.<a href="complex.html#Top">IMAG</a>
  A1P3I=R2.<a href="complex.html#Top">IMAG</a>+R3.<a href="complex.html#Top">IMAG</a>
  R(-1).<a href="complex.html#Top">IMAG</a>=A0P2I+A1P3I
  R(1).<a href="complex.html#Top">IMAG</a>=A0P2I-A1P3I
  R(2).<a href="complex.html#Top">IMAG</a>=A0M2I-A1M3R
  R(0).<a href="complex.html#Top">IMAG</a>=A0M2I+A1M3R
<a href="cpl.html#END">END</a> BT4

<a href="cpl.html#FUNCTION">SUBROUTINE</a> BTFLY(<a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(&lowast;) <a href="cpl.html#OF">OF</a> type tv; <a href="cpl.html#INTEGER">INTEGER</a> N; <a href="cpl.html#INTEGER">INTEGER</a> <a href="cpl.html#VARIABLE">VARIABLE</a> M)
  <a href="cpl.html#WITH">WITH</a> BUF
  <a href="cpl.html#INTEGER">INTEGER</a> K1=LASTN <a href="cpl.html#DIV">DIV</a> M
  <a href="cpl.html#DO">DO</a>
    <a href="cpl.html#IF">IF</a> N <a href="cpl.html#INTEGER-operator">MOD</a> (M<a href="cpl.html#STRING">&lt;&lt;</a>2) = 0 <a href="cpl.html#IF">THEN</a>
      M1=N <a href="cpl.html#DIV">DIV</a>(M<a href="cpl.html#STRING">&lt;&lt;</a>2)
      K1=K1&gt;&gt;2
      <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tv(M&lowast;(&lowast;)) Rj=1
      <a href="cpl.html#DO">DO</a>
        BT4{Rj(&lowast;),Rj(-1),Rj(0),Rj(1),Rj(2)}
        <a href="cpl.html#Builtin">INC</a> Rj,4
      <a href="cpl.html#FOR">FOR</a> M1 <a href="cpl.html#TIMES">TIMES</a>
      <a href="cpl.html#INTEGER">INTEGER</a> K=0
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a> H=1 <a href="cpl.html#TO">TO</a> M-1
        K=K+K1
        C1=<a href="cpl.html#REAL-operator">^</a>CEXP(2&lowast;K+K&lowast;(&lowast;))
        <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tv(H+M&lowast;(&lowast;)) RR=1
        <a href="cpl.html#DO">DO</a>
          RR(0)=<a href="cpl.html#Assignment">~</a>&lowast;C1(0)
          RR(1)=<a href="cpl.html#Assignment">~</a>&lowast;C1(-1)
          RR(2)=<a href="cpl.html#Assignment">~</a>&lowast;C1(1)
          BT4(RR(&lowast;),RR(-1),RR(0),RR(1),RR(2))
          <a href="cpl.html#Builtin">INC</a> RR,4
        <a href="cpl.html#FOR">FOR</a> M1 <a href="cpl.html#TIMES">TIMES</a>
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      M=M<a href="cpl.html#STRING">&lt;&lt;</a>2
    <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> N <a href="cpl.html#INTEGER-operator">MOD</a> (M<a href="cpl.html#STRING">&lt;&lt;</a>1) = 0 <a href="cpl.html#IF">THEN</a>
      M1=N <a href="cpl.html#DIV">DIV</a> (M<a href="cpl.html#STRING">&lt;&lt;</a>1)
      K1=K1&gt;&gt;1
      <a href="cpl.html#INTEGER">INTEGER</a> K=0
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a> H=0 <a href="cpl.html#TO">TO</a> M-1
        <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tv(H+M&lowast;(&lowast;)) RR=1
        <a href="cpl.html#DO">DO</a>
          A=CEXP(K)&lowast;RR(0)
          RR(0)=RR(-1)-A
          RR(-1)=<a href="cpl.html#Assignment">~</a>+A
          <span class=comment>!(
          AR=CEXP(K).REAL&lowast;RR(0).REAL-CEXP(K).IMAG&lowast;RR(0).IMAG
          AI=CEXP(K).REAL&lowast;RR(0).IMAG+CEXP(K).IMAG&lowast;RR(0).REAL
          RR(0).REAL=RR(-1).REAL-AR
          RR(0).IMAG=RR(-1).IMAG-AI
          RR(-1).REAL=~+AR
          RR(-1).IMAG=~+AI
          !)</span>
          <a href="cpl.html#Builtin">INC</a> RR,2
        <a href="cpl.html#FOR">FOR</a> M1 <a href="cpl.html#TIMES">TIMES</a>
        K=K+K1
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
      M=M<a href="cpl.html#STRING">&lt;&lt;</a>1
<span class=comment>!    ELSE IF N MOD (3&lowast;M) = 0 THEN</span>
    <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#IF">IF</a> N=3&lowast;M <a href="cpl.html#IF">THEN</a>
<span class=comment>!      M3=3&lowast;M</span>
      K1=K1 <a href="cpl.html#DIV">DIV</a> 3
      <a href="cpl.html#INTEGER">INTEGER</a> K=0
      <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a> H=0 <a href="cpl.html#TO">TO</a> M-1
        C1=<a href="cpl.html#REAL-operator">^</a>CEXP(K+K&lowast;(&lowast;))
        <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tv(H+M&lowast;(&lowast;)) RR=1
<span class=comment>!      DO</span>
          AR=C1(0).<a href="cpl.html#REAL">REAL</a>&lowast;RR(0).<a href="cpl.html#REAL">REAL</a>-C1(0).<a href="complex.html#Top">IMAG</a>&lowast;RR(0).<a href="complex.html#Top">IMAG</a>
          AI=C1(0).<a href="cpl.html#REAL">REAL</a>&lowast;RR(0).<a href="complex.html#Top">IMAG</a>+C1(0).<a href="complex.html#Top">IMAG</a>&lowast;RR(0).<a href="cpl.html#REAL">REAL</a>
          BR=C1(1).<a href="cpl.html#REAL">REAL</a>&lowast;RR(1).<a href="cpl.html#REAL">REAL</a>-C1(1).<a href="complex.html#Top">IMAG</a>&lowast;RR(1).<a href="complex.html#Top">IMAG</a>
          BI=C1(1).<a href="cpl.html#REAL">REAL</a>&lowast;RR(1).<a href="complex.html#Top">IMAG</a>+C1(1).<a href="complex.html#Top">IMAG</a>&lowast;RR(1).<a href="cpl.html#REAL">REAL</a>
          CR=RR(-1).<a href="cpl.html#REAL">REAL</a>-(AR+BR)&lowast;0.5
          RR(-1).<a href="cpl.html#REAL">REAL</a>=<a href="cpl.html#Assignment">~</a>+AR+BR
          DR=(AR-BR)&lowast;C3
          CI=RR(-1).<a href="complex.html#Top">IMAG</a>-(AI+BI)&lowast;0.5
          RR(-1).<a href="complex.html#Top">IMAG</a>=<a href="cpl.html#Assignment">~</a>+AI+BI
          DI=(AI-BI)&lowast;C3
          RR(0).<a href="cpl.html#REAL">REAL</a>=CR-DI
          RR(1).<a href="cpl.html#REAL">REAL</a>=CR+DI
          RR(1).<a href="complex.html#Top">IMAG</a>=CI-DR
          RR(0).<a href="complex.html#Top">IMAG</a>=CI+DR
<span class=comment>!          INC RR,3</span>
<span class=comment>!        FOR M1 TIMES</span>
        K=K+K1
      <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
<span class=comment>!      M=M3</span>
       M=N
    <a href="cpl.html#ELSE">ELSE</a> <a href="cpl.html#ERROR">ERROR</a> "This FFT cannot handle " N " points"
  <a href="cpl.html#UNTIL">UNTIL</a> M&gt;=N
<a href="cpl.html#END">END</a> BTFLY

<a href="cpl.html#INLINE">INLINE</a> <a href="cpl.html#FUNCTION">SUBROUTINE</a> BT4I(<a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(&lowast;) <a href="cpl.html#OF">OF</a> type Rin,Rout) 
<span class=comment>!(
  A=R(-1)+R(1); B=R(-1)-R(1)
  C=I&lowast;(R(0)-R(2)); D=R(0)+R(2)
  R(-1)=A+D
  R(0)=A-D
  R(1)=B-C
  R(2)=B+C
!)</span>  
  A0P2R=Rin(-1).<a href="cpl.html#REAL">REAL</a>+Rin(1).<a href="cpl.html#REAL">REAL</a>
  A0M2R=Rin(-1).<a href="cpl.html#REAL">REAL</a>-Rin(1).<a href="cpl.html#REAL">REAL</a>
  A1M3R=Rin(0).<a href="cpl.html#REAL">REAL</a>-Rin(2).<a href="cpl.html#REAL">REAL</a>
  A1P3R=Rin(0).<a href="cpl.html#REAL">REAL</a>+Rin(2).<a href="cpl.html#REAL">REAL</a>
  A1M3I=Rin(0).<a href="complex.html#Top">IMAG</a>-Rin(2).<a href="complex.html#Top">IMAG</a>
  Rout(-1).<a href="cpl.html#REAL">REAL</a>=A0P2R+A1P3R
  Rout(0).<a href="cpl.html#REAL">REAL</a>=A0P2R-A1P3R
  Rout(1).<a href="cpl.html#REAL">REAL</a>=A0M2R+A1M3I
  Rout(2).<a href="cpl.html#REAL">REAL</a>=A0M2R-A1M3I
  A0P2I=Rin(-1).<a href="complex.html#Top">IMAG</a>+Rin(1).<a href="complex.html#Top">IMAG</a>
  A0M2I=Rin(-1).<a href="complex.html#Top">IMAG</a>-Rin(1).<a href="complex.html#Top">IMAG</a>
  A1P3I=Rin(0).<a href="complex.html#Top">IMAG</a>+Rin(2).<a href="complex.html#Top">IMAG</a>
  Rout(-1).<a href="complex.html#Top">IMAG</a>=A0P2I+A1P3I
  Rout(0).<a href="complex.html#Top">IMAG</a>=A0P2I-A1P3I
  Rout(1).<a href="complex.html#Top">IMAG</a>=A0M2I-A1M3R
  Rout(2).<a href="complex.html#Top">IMAG</a>=A0M2I+A1M3R
<a href="cpl.html#END">END</a> BT4I

<a href="cpl.html#FUNCTION">SUBROUTINE</a> BTFLYI(<a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(&lowast;) <a href="cpl.html#OF">OF</a> type tv; <a href="cpl.html#INTEGER">INTEGER</a> N)
  <a href="cpl.html#WITH">WITH</a> BUF
  <a href="cpl.html#INTEGER">INTEGER</a> M=N
  <a href="cpl.html#INTEGER">INTEGER</a> K1=LASTN <a href="cpl.html#DIV">DIV</a> M
  <a href="cpl.html#IF">IF</a> M <a href="cpl.html#INTEGER-operator">MOD</a> 3 = 0 <a href="cpl.html#IF">THEN</a>
    M=M <a href="cpl.html#DIV">DIV</a> 3
    <a href="cpl.html#INTEGER">INTEGER</a> K=0
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a> H=0 <a href="cpl.html#TO">TO</a> M-1
      <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tv(H+M&lowast;(&lowast;)) RR=1
      C=RR(0)+RR(1)
      AMB=I&lowast;C3&lowast;(RR(1)-RR(0))
      APB=RR(-1)-C&lowast;0.5
      RR(-1)=<a href="cpl.html#Assignment">~</a>+C
      C1=<a href="cpl.html#REAL-operator">^</a>CEXP(K+K&lowast;(&lowast;))
      RR(0)=(APB+AMB)&lowast;<a href="complex.html#Top">CONJG</a>(C1(0))
      RR(1)=(APB-AMB)&lowast;<a href="complex.html#Top">CONJG</a>(C1(1))
      K=K+K1
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
    K1=K1&lowast;3
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#INTEGER">INTEGER</a> MN=M; <a href="cpl.html#DO">DO</a> MN=MN &gt;&gt; 2 <a href="cpl.html#UNTIL">UNTIL</a> MN&lt;4; <a href="cpl.html#IF">IF</a> MN = 2 <a href="cpl.html#IF">THEN</a>
    M1=N <a href="cpl.html#DIV">DIV</a> M
    M=M&gt;&gt;1
    <a href="cpl.html#INTEGER">INTEGER</a> K=0
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a> H=0 <a href="cpl.html#TO">TO</a> M-1
      <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tv(H+M&lowast;(&lowast;)) RR=1
      <a href="cpl.html#DO">DO</a>
        A=RR(-1)-RR(0)
        RR(-1)=RR(-1)+RR(0)
        RR(0)=A&lowast;<a href="complex.html#Top">CONJG</a>(CEXP(K))
        <a href="cpl.html#Builtin">INC</a> RR,2
      <a href="cpl.html#FOR">FOR</a> M1 <a href="cpl.html#TIMES">TIMES</a>
      K=K+K1
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
    K1=K1<a href="cpl.html#STRING">&lt;&lt;</a>1
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#WHILE">WHILE</a> M <a href="cpl.html#Bitwise">BITAND</a> 15 =0
    M1=N <a href="cpl.html#DIV">DIV</a> M
    M=M&gt;&gt;2
    <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tv(M&lowast;(&lowast;)) Rj=1
    <a href="cpl.html#DO">DO</a>
      BT4I(Rj(&lowast;),Rj(&lowast;))
      <a href="cpl.html#Builtin">INC</a> Rj,4
    <a href="cpl.html#FOR">FOR</a> M1 <a href="cpl.html#TIMES">TIMES</a>
    <a href="cpl.html#INTEGER">INTEGER</a> K=0
    <a href="cpl.html#LOOP">LOOP</a> <a href="cpl.html#FOR">FOR</a> H=1 <a href="cpl.html#TO">TO</a> M-1
      K=K+K1
      C1=<a href="cpl.html#REAL-operator">^</a>CEXP(2&lowast;K+K&lowast;(&lowast;))
      <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tv(H+M&lowast;(&lowast;)) RR=1
      <a href="cpl.html#DO">DO</a>
        BT4I(RR(&lowast;),RR(&lowast;))
        RR(0)=<a href="cpl.html#Assignment">~</a>&lowast;<a href="complex.html#Top">CONJG</a>(C1(0))
        RR(1)=<a href="cpl.html#Assignment">~</a>&lowast;<a href="complex.html#Top">CONJG</a>(C1(-1))
        RR(2)=<a href="cpl.html#Assignment">~</a>&lowast;<a href="complex.html#Top">CONJG</a>(C1(1))
        <a href="cpl.html#Builtin">INC</a> RR,4
      <a href="cpl.html#FOR">FOR</a> M1 <a href="cpl.html#TIMES">TIMES</a>
    <a href="cpl.html#LOOP">REPEAT</a> <a href="cpl.html#LOOP">LOOP</a>
    K1=K1<a href="cpl.html#STRING">&lt;&lt;</a>2
  <a href="cpl.html#LOOP">REPEAT</a>
  <a href="cpl.html#IF">IF</a> M#4 <a href="cpl.html#IF">THEN</a> <a href="cpl.html#ERROR">ERROR</a> "This FFT cannot handle " N " points"
<a href="cpl.html#END">END</a> BTFLYI

<span class=comment>!(
SUBROUTINE BTFLY2(type R^(&lowast;))
  N=R.LENGTH
  INTEGER M=1
  COMPLEX C1=-1
  DO
    COMPLEX C=1
    M2=2&lowast;M
    LOOP FOR H=0 TO M-1
      C=C&lowast;C1
      DO
        A=C&lowast;R(J+M)
        R(J+M)=R(J)-A
        R(J)=R(J)+A
      FOR J=H TO N-1 BY M2
    REPEAT LOOP
    M=M2
    C1=SQRT(C1)
  UNTIL M=N
END BTFLY2

SUBROUTINE BTFLY2I(type R^(&lowast;))
  N=R.LENGTH
  INTEGER M2=2
  COMPLEX C1=-1
  DO
    M2=2&lowast;M2
    C1=SQRT(C1)
  UNTIL M2=N
  DO
    COMPLEX C=1
    INTEGER M=M2 DIV 2
    INTEGER H
    LOOP FOR H=0 TO M-1
      C=C&lowast;CONJG(C1)
      INTEGER J
      DO
        A=R(J)-R(J+M)
        R(J)=R(J)+R(J+M)
        R(J+M)=A&lowast;C
      FOR J=H TO N-1 BY M2
    REPEAT LOOP
    M2=M
    C1=C1&lowast;C1
  UNTIL M2=1
END BTFLY2I
!)</span>

<a href="cpl.html#FUNCTION">SUBROUTINE</a> IFT(type <a href="cpl.html#VARIABLE">VARIABLE</a> Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;))
  <a href="cpl.html#WITH">WITH</a> BUF
  N=Rin.<a href="cpl.html#LENGTH">LENGTH</a>
  <a href="cpl.html#IF">IF</a> LASTN <a href="cpl.html#INTEGER-operator">MOD</a> N # 0 <a href="cpl.html#IF">THEN</a> FFTSETUP(N)
  <a href="cpl.html#INTEGER">INTEGER</a> K1=LASTN <a href="cpl.html#DIV">DIV</a> N
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> RI((&lowast;)) K
  <a href="cpl.html#IF">IF</a> K1 <a href="cpl.html#INTEGER-operator">MOD</a> 3 #0 <a href="cpl.html#IF">THEN</a> K=0 <a href="cpl.html#ELSE">ELSE</a> K=LASTN; K1=K1 <a href="cpl.html#DIV">DIV</a> 3  
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(0..Rin.<a href="cpl.html#HI">HI</a>) <a href="cpl.html#OF">OF</a> type tempVEC
  tempVEC=alloca[<a href="cpl.html#TYPE">SIZEOF</a>(tempVEC<a href="cpl.html#REAL-operator">^</a>)]
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tempVEC(0..Rin.<a href="cpl.html#HI">HI</a>) R=1
  <a href="cpl.html#DO">DO</a>
    R0=<a href="cpl.html#REAL-operator">^</a>Rin(K(0)); <a href="cpl.html#Builtin">INC</a> K,K1; R1=<a href="cpl.html#REAL-operator">^</a>Rin(K(0)); <a href="cpl.html#Builtin">INC</a> K,K1; R2=<a href="cpl.html#REAL-operator">^</a>Rin(K(0)); <a href="cpl.html#Builtin">INC</a> K,K1; R3=<a href="cpl.html#REAL-operator">^</a>Rin(K(0)); <a href="cpl.html#Builtin">INC</a> K,K1
    BT4(R(&lowast;),R0,R1,R2,R3)
    R=R+4
  <a href="cpl.html#FOR">FOR</a> N&gt;&gt;2 <a href="cpl.html#TIMES">TIMES</a>
  <span class=comment>!(
  DO
      R(0)=Rin[K(0)]
      INC K
    FOR R INTO tempVEC(0..Rin.HI)
    !)</span>    
BTFLY(tempVEC,N,4)
  Rout(&lowast;)=tempVEC
<a href="cpl.html#END">END</a> IFT

<a href="cpl.html#FUNCTION">SUBROUTINE</a> FFT(type <a href="cpl.html#VARIABLE">VARIABLE</a> Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;))
  <a href="cpl.html#WITH">WITH</a> BUF
  N=Rin.<a href="cpl.html#LENGTH">LENGTH</a>
  <a href="cpl.html#IF">IF</a> LASTN <a href="cpl.html#INTEGER-operator">MOD</a> N # 0 <a href="cpl.html#IF">THEN</a> FFTSETUP(N)
  Ninv=1/N
  <a href="cpl.html#INTEGER">INTEGER</a> K1=LASTN <a href="cpl.html#DIV">DIV</a> N
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> RI((&lowast;)) K
  <a href="cpl.html#IF">IF</a> K1 <a href="cpl.html#INTEGER-operator">MOD</a> 3 #0 <a href="cpl.html#IF">THEN</a> K=0 <a href="cpl.html#ELSE">ELSE</a> K=LASTN; K1=K1 <a href="cpl.html#DIV">DIV</a> 3
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(0..Rin.<a href="cpl.html#HI">HI</a>) <a href="cpl.html#OF">OF</a> type tempVEC
  tempVEC=alloca[<a href="cpl.html#TYPE">SIZEOF</a>(tempVEC<a href="cpl.html#REAL-operator">^</a>)]
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tempVEC(0..Rin.<a href="cpl.html#HI">HI</a>) R=1
  <a href="cpl.html#MODULE">MODULE</a>
    <a href="cpl.html#Builtin">INC</a> K,K1; R11=<a href="cpl.html#REAL-operator">^</a>Rin(N-K(0)); <a href="cpl.html#Builtin">INC</a> K,K1; R22=<a href="cpl.html#REAL-operator">^</a>Rin(N-K(0)); <a href="cpl.html#Builtin">INC</a> K,K1; R33=<a href="cpl.html#REAL-operator">^</a>Rin(N-K(0)); <a href="cpl.html#Builtin">INC</a> K,K1
    BT4(R(&lowast;),Rin(0)&lowast;Ninv,R11&lowast;Ninv,R22&lowast;Ninv,R33&lowast;Ninv)
  <a href="cpl.html#END">END</a> <a href="cpl.html#MODULE">MODULE</a>
  <a href="cpl.html#DO">DO</a>
    R00=<a href="cpl.html#REAL-operator">^</a>Rin(N-K(0)); <a href="cpl.html#Builtin">INC</a> K,K1; R11=<a href="cpl.html#REAL-operator">^</a>Rin(N-K(0)); <a href="cpl.html#Builtin">INC</a> K,K1; R22=<a href="cpl.html#REAL-operator">^</a>Rin(N-K(0)); <a href="cpl.html#Builtin">INC</a> K,K1; R33=<a href="cpl.html#REAL-operator">^</a>Rin(N-K(0)); <a href="cpl.html#Builtin">INC</a> K,K1
    R=R+4
    BT4(R(&lowast;),R00&lowast;Ninv,R11&lowast;Ninv,R22&lowast;Ninv,R33&lowast;Ninv)
  <a href="cpl.html#FOR">FOR</a> N&gt;&gt;2 -1 <a href="cpl.html#TIMES">TIMES</a>
  BTFLY(tempVEC,N,4)
  Rout(&lowast;)=tempVEC
<a href="cpl.html#END">END</a> FFT

<a href="cpl.html#FUNCTION">SUBROUTINE</a> RFT(type Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;))
  <a href="cpl.html#WITH">WITH</a> BUF
  N=Rin.<a href="cpl.html#LENGTH">LENGTH</a> <a href="cpl.html#Bitwise">BITAND</a> -2
  <a href="cpl.html#IF">IF</a> LASTN <a href="cpl.html#INTEGER-operator">MOD</a> (2&lowast;N) # 0 <a href="cpl.html#IF">THEN</a> FFTSETUP(2&lowast;N)
  Rout(0).<a href="cpl.html#REAL">REAL</a>=Rin(0).<a href="cpl.html#REAL">REAL</a>
  Rout(0).<a href="complex.html#Top">IMAG</a>=Rin(0).<a href="cpl.html#REAL">REAL</a>
  <a href="cpl.html#IF">IF</a> Rin.<a href="cpl.html#LENGTH">LENGTH</a> <a href="cpl.html#Bitwise">BITAND</a> 1 # 0 <a href="cpl.html#IF">THEN</a>
    Rout(0).<a href="cpl.html#REAL">REAL</a>=<a href="cpl.html#Assignment">~</a>+Rin(N).<a href="cpl.html#REAL">REAL</a>
    Rout(0).<a href="complex.html#Top">IMAG</a>=<a href="cpl.html#Assignment">~</a>-Rin(N).<a href="cpl.html#REAL">REAL</a>
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> CEXP(LASTN <a href="cpl.html#DIV">DIV</a> (N<a href="cpl.html#STRING">&lt;&lt;</a>1)&lowast;(&lowast;)) C=0
  <a href="cpl.html#DO">DO</a>
    <a href="cpl.html#TYPE">TYPEOF</a>(Rin(0).<a href="cpl.html#REAL">REAL</a>) AR,AI
    AR=Rin(J).<a href="cpl.html#REAL">REAL</a>-Rin(N-J).<a href="cpl.html#REAL">REAL</a>
    AI=Rin(J).<a href="complex.html#Top">IMAG</a>+Rin(N-J).<a href="complex.html#Top">IMAG</a>
    C=C+1
    BR=-C(0).<a href="complex.html#Top">IMAG</a>&lowast;AR-C(0).<a href="cpl.html#REAL">REAL</a>&lowast;AI
    BI=C(0).<a href="cpl.html#REAL">REAL</a>&lowast;AR-C(0).<a href="complex.html#Top">IMAG</a>&lowast;AI
<span class=comment>!(    
    tempVEC(J).REAL=(Rin(J).REAL+Rin(N-J).REAL+BR)&lowast;0.5
    tempVEC(J).IMAG=(Rin(J).IMAG-Rin(N-J).IMAG+BI)&lowast;0.5
    tempVEC(N-J).REAL=tempVEC(J).REAL-BR
    tempVEC(N-J).IMAG=BI-tempVEC(J).IMAG
!)</span>    
    Rout(J).<a href="cpl.html#REAL">REAL</a>=Rin(J).<a href="cpl.html#REAL">REAL</a>+Rin(N-J).<a href="cpl.html#REAL">REAL</a>+BR
    Rout(J).<a href="complex.html#Top">IMAG</a>=Rin(J).<a href="complex.html#Top">IMAG</a>-Rin(N-J).<a href="complex.html#Top">IMAG</a>+BI
    Rout(N-J).<a href="cpl.html#REAL">REAL</a>=Rout(J).<a href="cpl.html#REAL">REAL</a>-BR-BR
    Rout(N-J).<a href="complex.html#Top">IMAG</a>=BI+BI-Rout(J).<a href="complex.html#Top">IMAG</a>
  <a href="cpl.html#FOR">FOR</a> J=1 <a href="cpl.html#TO">TO</a> N&gt;&gt;1
  IFT(Rout(0..N-1),Rout(0..N-1))
<a href="cpl.html#END">END</a> RFT

<a href="cpl.html#FUNCTION">SUBROUTINE</a> HFT(type <a href="cpl.html#VARIABLE">VARIABLE</a> Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;))
  <a href="cpl.html#WITH">WITH</a> BUF
  N=Rin.<a href="cpl.html#LENGTH">LENGTH</a> <a href="cpl.html#Bitwise">BITAND</a> -2
  <a href="cpl.html#IF">IF</a> LASTN <a href="cpl.html#INTEGER-operator">MOD</a> (2&lowast;N) # 0 <a href="cpl.html#IF">THEN</a> FFTSETUP(2&lowast;N)
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(0..Rin.<a href="cpl.html#HI">HI</a>) <a href="cpl.html#OF">OF</a> type tempVEC
  tempVEC=alloca[<a href="cpl.html#TYPE">SIZEOF</a>(tempVEC<a href="cpl.html#REAL-operator">^</a>)]
  FFT(Rin(0..N-1),tempVEC(0..N-1))
  Rout(0)=(tempVEC(0).<a href="cpl.html#REAL">REAL</a>+tempVEC(0).<a href="complex.html#Top">IMAG</a>)&lowast;0.5
  <a href="cpl.html#IF">IF</a> Rout.<a href="cpl.html#LENGTH">LENGTH</a> <a href="cpl.html#Bitwise">BITAND</a> 1 # 0 <a href="cpl.html#IF">THEN</a>
    Rout(N)=Rout(0).<a href="cpl.html#REAL">REAL</a>-tempVEC(0).<a href="complex.html#Top">IMAG</a>
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> CEXP(LASTN <a href="cpl.html#DIV">DIV</a> (N<a href="cpl.html#STRING">&lt;&lt;</a>1)&lowast;(&lowast;)) C=0
  <a href="cpl.html#DO">DO</a>
    AR=tempVEC(J).<a href="cpl.html#REAL">REAL</a>-tempVEC(N-J).<a href="cpl.html#REAL">REAL</a>
    AI=tempVEC(J).<a href="complex.html#Top">IMAG</a>+tempVEC(N-J).<a href="complex.html#Top">IMAG</a>
    C=C+1
    BR=-C(0).<a href="complex.html#Top">IMAG</a>&lowast;AR+C(0).<a href="cpl.html#REAL">REAL</a>&lowast;AI
    BI=-C(0).<a href="cpl.html#REAL">REAL</a>&lowast;AR-C(0).<a href="complex.html#Top">IMAG</a>&lowast;AI
<span class=comment>!(    
    Rout(J).REAL=(Rout(J).REAL+Rout(N-J).REAL+BR)&lowast;0.5
    Rout(J).IMAG=(Rout(J).IMAG-Rout(N-J).IMAG+BI)&lowast;0.5
    Rout(N-J).REAL=Rout(J).REAL-BR
    Rout(N-J).IMAG=BI-Rout(J).IMAG
!)</span>    
    Rout(J).<a href="cpl.html#REAL">REAL</a>=(tempVEC(J).<a href="cpl.html#REAL">REAL</a>+tempVEC(N-J).<a href="cpl.html#REAL">REAL</a>+BR)&lowast;0.25
    Rout(J).<a href="complex.html#Top">IMAG</a>=(tempVEC(J).<a href="complex.html#Top">IMAG</a>-tempVEC(N-J).<a href="complex.html#Top">IMAG</a>+BI)&lowast;0.25
    Rout(N-J).<a href="cpl.html#REAL">REAL</a>=Rout(J).<a href="cpl.html#REAL">REAL</a>-BR&lowast;0.5
    Rout(N-J).<a href="complex.html#Top">IMAG</a>=BI&lowast;0.5-Rout(J).<a href="complex.html#Top">IMAG</a>
  <a href="cpl.html#FOR">FOR</a> J=1 <a href="cpl.html#TO">TO</a> N&gt;&gt;1
<a href="cpl.html#END">END</a> HFT

<a href="cpl.html#FUNCTION">SUBROUTINE</a> IFTU(type <a href="cpl.html#VARIABLE">VARIABLE</a> Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;),Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;))
  <a href="cpl.html#WITH">WITH</a> BUF
  N=Rin.<a href="cpl.html#LENGTH">LENGTH</a>
  <a href="cpl.html#IF">IF</a> LASTN <a href="cpl.html#INTEGER-operator">MOD</a> N # 0 <a href="cpl.html#IF">THEN</a> FFTSETUP(N)
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(0..Rin.<a href="cpl.html#HI">HI</a>) <a href="cpl.html#OF">OF</a> type tempVEC
  tempVEC=alloca[<a href="cpl.html#TYPE">SIZEOF</a>(tempVEC<a href="cpl.html#REAL-operator">^</a>)]
  tempVEC(0..Rin.<a href="cpl.html#HI">HI</a>)=Rin
  BTFLYI(tempVEC,N)
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> Rout R=1
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tempVEC(0..Rin.<a href="cpl.html#HI">HI</a>) tv=1
  <a href="cpl.html#DO">DO</a>
    BT4I(tv(&lowast;),R(&lowast;))
    R=R+4
    tv=tv+4
  <a href="cpl.html#FOR">FOR</a> N&gt;&gt;2 <a href="cpl.html#TIMES">TIMES</a>
<a href="cpl.html#END">END</a> IFTU
  
<a href="cpl.html#FUNCTION">SUBROUTINE</a> FFTU(type <a href="cpl.html#VARIABLE">VARIABLE</a> Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;))
  <a href="cpl.html#WITH">WITH</a> BUF
  N=Rin.<a href="cpl.html#LENGTH">LENGTH</a>
  <a href="cpl.html#IF">IF</a> LASTN <a href="cpl.html#INTEGER-operator">MOD</a> N # 0 <a href="cpl.html#IF">THEN</a> FFTSETUP(N)
  Ninv=1/N
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> Rin R=1
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(0..Rin.<a href="cpl.html#HI">HI</a>) <a href="cpl.html#OF">OF</a> type tempVEC
  tempVEC=alloca[<a href="cpl.html#TYPE">SIZEOF</a>(tempVEC<a href="cpl.html#REAL-operator">^</a>)]
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tempVEC(0..Rin.<a href="cpl.html#HI">HI</a>) tv=1
  <a href="cpl.html#DO">DO</a>
    BT4(tv(&lowast;),R(-1)&lowast;Ninv,R(0)&lowast;Ninv,R(1)&lowast;Ninv,R(2)&lowast;Ninv)
    R=R+4
    tv=tv+4
  <a href="cpl.html#FOR">FOR</a> N&gt;&gt;2 <a href="cpl.html#TIMES">TIMES</a>
  BTFLY(tempVEC,N,4)
 Rout(&lowast;)=tempVEC
<a href="cpl.html#END">END</a> FFTU

<a href="cpl.html#FUNCTION">SUBROUTINE</a> RFTU(type <a href="cpl.html#VARIABLE">VARIABLE</a> Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;))
  <a href="cpl.html#WITH">WITH</a> BUF
  N=Rin.<a href="cpl.html#LENGTH">LENGTH</a> <a href="cpl.html#Bitwise">BITAND</a> -2
  <a href="cpl.html#IF">IF</a> LASTN <a href="cpl.html#INTEGER-operator">MOD</a> (2&lowast;N) # 0 <a href="cpl.html#IF">THEN</a> FFTSETUP(2&lowast;N)
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(0..Rin.<a href="cpl.html#HI">HI</a>) <a href="cpl.html#OF">OF</a> type tempVEC
  tempVEC=alloca[<a href="cpl.html#TYPE">SIZEOF</a>(tempVEC<a href="cpl.html#REAL-operator">^</a>)]
  tempVEC(0).<a href="cpl.html#REAL">REAL</a>=Rin(0).<a href="cpl.html#REAL">REAL</a>
  tempVEC(0).<a href="complex.html#Top">IMAG</a>=Rin(0).<a href="cpl.html#REAL">REAL</a>
  <a href="cpl.html#IF">IF</a> Rin.<a href="cpl.html#LENGTH">LENGTH</a> <a href="cpl.html#Bitwise">BITAND</a> 1 # 0 <a href="cpl.html#IF">THEN</a>
    tempVEC(0).<a href="cpl.html#REAL">REAL</a>=<a href="cpl.html#Assignment">~</a>+Rin(N).<a href="cpl.html#REAL">REAL</a>
    tempVEC(0).<a href="complex.html#Top">IMAG</a>=<a href="cpl.html#Assignment">~</a>-Rin(N).<a href="cpl.html#REAL">REAL</a>
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> CEXP(LASTN <a href="cpl.html#DIV">DIV</a> (N<a href="cpl.html#STRING">&lt;&lt;</a>1)&lowast;(&lowast;)) C=0
  <a href="cpl.html#DO">DO</a>
    <a href="cpl.html#TYPE">TYPEOF</a>(Rin(0).<a href="cpl.html#REAL">REAL</a>) AR,AI
    AR=Rin(J).<a href="cpl.html#REAL">REAL</a>-Rin(N-J).<a href="cpl.html#REAL">REAL</a>
    AI=Rin(J).<a href="complex.html#Top">IMAG</a>+Rin(N-J).<a href="complex.html#Top">IMAG</a>
    C=C+1
    BR=-C(0).<a href="complex.html#Top">IMAG</a>&lowast;AR-C(0).<a href="cpl.html#REAL">REAL</a>&lowast;AI
    BI=C(0).<a href="cpl.html#REAL">REAL</a>&lowast;AR-C(0).<a href="complex.html#Top">IMAG</a>&lowast;AI
    tempVEC(J).<a href="cpl.html#REAL">REAL</a>=Rin(J).<a href="cpl.html#REAL">REAL</a>+Rin(N-J).<a href="cpl.html#REAL">REAL</a>+BR
    tempVEC(J).<a href="complex.html#Top">IMAG</a>=Rin(J).<a href="complex.html#Top">IMAG</a>-Rin(N-J).<a href="complex.html#Top">IMAG</a>+BI
    tempVEC(N-J).<a href="cpl.html#REAL">REAL</a>=tempVEC(J).<a href="cpl.html#REAL">REAL</a>-BR-BR
    tempVEC(N-J).<a href="complex.html#Top">IMAG</a>=BI+BI-tempVEC(J).<a href="complex.html#Top">IMAG</a>
  <a href="cpl.html#FOR">FOR</a> J=1 <a href="cpl.html#TO">TO</a> N&gt;&gt;1
  BTFLYI(tempVEC,N)
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> Rout R=1
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> tempVEC(0..Rin.<a href="cpl.html#HI">HI</a>) tv=1
  <a href="cpl.html#DO">DO</a>
    BT4I(tv(&lowast;),R(&lowast;))
    R=R+4
    tv=tv+4
  <a href="cpl.html#FOR">FOR</a> N&gt;&gt;2 <a href="cpl.html#TIMES">TIMES</a>
<a href="cpl.html#END">END</a> RFTU

<a href="cpl.html#FUNCTION">SUBROUTINE</a> HFTU(type <a href="cpl.html#VARIABLE">VARIABLE</a> Rin<a href="cpl.html#REAL-operator">^</a>(&lowast;), Rout<a href="cpl.html#REAL-operator">^</a>(&lowast;))
  <a href="cpl.html#WITH">WITH</a> BUF
  N=Rin.<a href="cpl.html#LENGTH">LENGTH</a> <a href="cpl.html#Bitwise">BITAND</a> -2
  <a href="cpl.html#IF">IF</a> LASTN <a href="cpl.html#INTEGER-operator">MOD</a> (2&lowast;N) # 0 <a href="cpl.html#IF">THEN</a> FFTSETUP(2&lowast;N)
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(0..Rin.<a href="cpl.html#HI">HI</a>) <a href="cpl.html#OF">OF</a> type tempVEC
  tempVEC=alloca[<a href="cpl.html#TYPE">SIZEOF</a>(tempVEC<a href="cpl.html#REAL-operator">^</a>)]
  tempVEC(0..N-1)=Rin
  BTFLY(tempVEC,N,1)
  Ninv=0.25/N
  Rout(0)=(tempVEC(0).<a href="cpl.html#REAL">REAL</a>+tempVEC(0).<a href="complex.html#Top">IMAG</a>)&lowast;2&lowast;Ninv
  <a href="cpl.html#IF">IF</a> Rout.<a href="cpl.html#LENGTH">LENGTH</a> <a href="cpl.html#Bitwise">BITAND</a> 1 # 0 <a href="cpl.html#IF">THEN</a>
    Rout(N)=Rout(0).<a href="cpl.html#REAL">REAL</a>-tempVEC(0).<a href="complex.html#Top">IMAG</a>
  <a href="cpl.html#END">END</a> <a href="cpl.html#IF">IF</a>
  <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#INTO">INTO</a> CEXP(LASTN <a href="cpl.html#DIV">DIV</a> (N<a href="cpl.html#STRING">&lt;&lt;</a>1)&lowast;(&lowast;)) C=0
  <a href="cpl.html#DO">DO</a>
    AR=tempVEC(J).<a href="cpl.html#REAL">REAL</a>-tempVEC(N-J).<a href="cpl.html#REAL">REAL</a>
    AI=tempVEC(J).<a href="complex.html#Top">IMAG</a>+tempVEC(N-J).<a href="complex.html#Top">IMAG</a>
    C=C+1
    BR=-C(0).<a href="complex.html#Top">IMAG</a>&lowast;AR+C(0).<a href="cpl.html#REAL">REAL</a>&lowast;AI
    BI=-C(0).<a href="cpl.html#REAL">REAL</a>&lowast;AR-C(0).<a href="complex.html#Top">IMAG</a>&lowast;AI
    Rout(J).<a href="cpl.html#REAL">REAL</a>=(tempVEC(J).<a href="cpl.html#REAL">REAL</a>+tempVEC(N-J).<a href="cpl.html#REAL">REAL</a>+BR)&lowast;Ninv
    Rout(J).<a href="complex.html#Top">IMAG</a>=(tempVEC(J).<a href="complex.html#Top">IMAG</a>-tempVEC(N-J).<a href="complex.html#Top">IMAG</a>+BI)&lowast;Ninv
    Rout(N-J).<a href="cpl.html#REAL">REAL</a>=Rout(J).<a href="cpl.html#REAL">REAL</a>-BR&lowast;2&lowast;Ninv
    Rout(N-J).<a href="complex.html#Top">IMAG</a>=BI&lowast;2&lowast;Ninv-Rout(J).<a href="complex.html#Top">IMAG</a>
  <a href="cpl.html#FOR">FOR</a> J=1 <a href="cpl.html#TO">TO</a> N&gt;&gt;1
<a href="cpl.html#END">END</a> HFTU

<a href="cpl.html#END">END</a> fft

<a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#REAL">REAL</a> <a href="cpl.html#FUNCTION">FUNCTION</a> REALIFIED(<a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a>(&lowast;) <a href="cpl.html#OF">OF</a> <a href="complex.html#Top">COMPLEX</a> x; <a href="cpl.html#INTEGER">INTEGER</a> y)=
<a href="cpl.html#IF">IF</a> <a href="cpl.html#NOT">NOT</a> ODD(y) <a href="cpl.html#IF">THEN</a> x(y <a href="cpl.html#Bitwise">RSHIFTED</a> 1).<a href="cpl.html#REAL">REAL</a> <a href="cpl.html#ELSE">ELSE</a> x(y <a href="cpl.html#Bitwise">RSHIFTED</a> 1).<a href="complex.html#Top">IMAG</a>

<a href="cpl.html#FRI-SECTION">FRI SECTION</a>
function "REALIFIED"]= 1["," fullsep] =[argument -&gt; <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> &lowast; <a href="cpl.html#ARRAY">ARRAY</a> =[ &lowast;]= =[argument -&gt; <a href="cpl.html#INTEGER">INTEGER</a> value =[{<a href="cpl.html#INTEGER">INTEGER</a> value &lowast;]=<a href="cpl.html#REAL-operator">^</a>} -&gt; =[function <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> #2 <a href="cpl.html#ARRAY">ARRAY</a> #1 -&gt; function =[{ &lowast;]=<a href="cpl.html#REAL-operator">^</a>}]= &lowast;]= -&gt; =[function "REALIFIED" -&gt; function =[function &lowast;]=
function "REALIFIED"]= 1["," fullsep] =[argument -&gt; <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> &lowast; <a href="cpl.html#ARRAY">ARRAY</a> =[{<a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> &lowast;]=<a href="cpl.html#REAL-operator">^</a>} -&gt; =[function "REALIFIED" -&gt; function <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> =[function <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> #1 &lowast;]= ]=
function "REALIFIED"]= 1["," fullsep] =[argument -&gt; const <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> &lowast; <a href="cpl.html#ARRAY">ARRAY</a> =[{<a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> &lowast;]=<a href="cpl.html#REAL-operator">^</a>} -&gt; =[function "REALIFIED" -&gt; function <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> =[function const <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> #1 &lowast;]= ]=
function "REALIFIED"]= 1["," fullsep] =[argument -&gt; <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> { &lowast; } <a href="cpl.html#REAL-operator">^</a>"," { &lowast; } {"COMPLEX_s"} type "COMPLEX" -&gt; =[function <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> {: 1[const<a href="cpl.html#REAL-operator">^</a>const] <a href="cpl.html#REAL-operator">^</a>"(" [--"," do asis] "," =[")&lowast;2"}{]= 1[const<a href="cpl.html#REAL-operator">^</a>const] <a href="cpl.html#REAL-operator">^</a>"(" &lowast;]= =[")&lowast;2+1"}{"(signed)sizeof(double)"} <a href="cpl.html#REAL">REAL</a>]= &lowast;]=
function "REALIFIED"]= 1["," fullsep] =[argument -&gt; const <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> { &lowast; } <a href="cpl.html#REAL-operator">^</a>"," { &lowast; } {"COMPLEX_s)"} type "COMPLEX" -&gt; =[function const <a href="cpl.html#POINTER">POINTER</a> <a href="cpl.html#TO">TO</a> <a href="cpl.html#ARRAY">ARRAY</a> {: 1[const<a href="cpl.html#REAL-operator">^</a>const] <a href="cpl.html#REAL-operator">^</a>"(" [--"," do asis]"," =[")&lowast;2"}{]= 1[const<a href="cpl.html#REAL-operator">^</a>const] <a href="cpl.html#REAL-operator">^</a>"(" &lowast;]= =[")&lowast;2+1"}{"(signed)sizeof(double)"} <a href="cpl.html#REAL">REAL</a>]= &lowast;]=
<a href="cpl.html#END">END</a> <a href="cpl.html#FRI-SECTION">FRI SECTION</a>
</pre></body></html>
